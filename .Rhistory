ggsave(paste0(path_here,"barplotenergíacomparativa_medida.tiff"), device = "tiff", dpi=1200,width =8, height =7, units = 'in')
return(as.data.frame(colSums(tabla_energia_est)))
}
energia_anual_est<-barplot_energias_estandar()
energia_anual_med<-barplot_energias_medida()
library(here)
source(here('funciones_necesarias.R'),encoding = "UTF-8")
data_path<- here('data/')
archivos <- list.files(data_path, pattern = 'csv',
recursive = TRUE, full.names = TRUE)
r<-0.27/2 #radio del cacharro
lista_procesada<-lapply(archivos, procesador)
column_names <- names(lista_procesada[[1]])
df <- data.frame(matrix(unlist(lista_procesada),
nrow=length(lista_procesada),
byrow=T),stringsAsFactors=FALSE)
colnames(df) <- column_names
df<- cbind(archivos,df)
df<- df_mutate(df)
### para generar ploteos de rpm y omhnios. a ka vez que obtengo un data.frame cob los coeficientes de ajuste a y b
## los coeficientes se consiguen para la correlacion más alta, dado que estoy probando con dos regresiones
## siempre hay una más acertada que otra.
source(here('tratamiento_outliers.R'))
coeficientes_RPM<-ajuste_RPM_Resistencia_so(df,tablas_sin_outliers_ni_decreasing)
coeficientes_RPM<-data.frame(matrix(unlist(coeficientes_RPM), nrow=30, byrow=T))
names(coeficientes_RPM)<- c("Experimento","Angulo","Porcentaje","a","b")
df<-add_coef(df,coeficientes_RPM)
###obtencion de las graficas empleando la velocidad de giro aplicando la regresion para estandar,lectura y media
ploteo_experimento_estandar_RPM_regresion(df,3)
tabla_cpmax_tsr<-ploteo_experimento_estandar_RPM_regresion_CPmax(df,2)
ploteo_CPmax10(df,2)
limitex<- c(0,20)
limitey<- c(0,40)
coeficientes_Curva_P_V<- grafica_Potencia_V(df,limitex,limitey,2)
coeficientes_Curva_P_V_medida<- grafica_Potencia_V(df,limitex,limitey,1)
coeficientes_Curva_P_V_estandar<- grafica_Potencia_V(df,limitex,limitey,2)
##Representar las rpms en funcion de las resistencias de manera comparativa
## Para cada porcentaje
RPM_por_porcentaje(df)
ajuste_RPM_Resistencia<- function(df){
group_number<-length(attr(group_by(df,experimento,angulo,porcentaje), "group"))
lista_rpm_resistencia<- list()
nombres_lista<- vector()
titulos_grafico<- vector()
for (grupos in 1:group_number) {
grupos_rpm_resistencia<- df %>% group_by(.,experimento,angulo,porcentaje) %>% select_groups(grupos)
tabla_resistencia_rpm<- as.data.frame(cbind(as.numeric(grupos_rpm_resistencia$RPM),as.data.frame(grupos_rpm_resistencia$resistencia)))
colnames(tabla_resistencia_rpm)<- c("RPM", "Omhnios")
nombre_tabla<- unique(paste(grupos_rpm_resistencia$experimento,grupos_rpm_resistencia$angulo,grupos_rpm_resistencia$porcentaje,sep = "_"))
if(is.na(grupos_rpm_resistencia$angulo)){
titulo_graph<- unique(paste0(grupos_rpm_resistencia$experimento,"-",grupos_rpm_resistencia$porcentaje,"%"))
}else{
titulo_graph<- unique(paste0(grupos_rpm_resistencia$experimento,"-",grupos_rpm_resistencia$angulo,"º-",grupos_rpm_resistencia$porcentaje,"%"))
}
titulos_grafico[grupos]<- titulo_graph
lista_rpm_resistencia[[grupos]]<- tabla_resistencia_rpm
nombres_lista[grupos]<- nombre_tabla
}
ordenando<- function(ordenando){
return(ordenando[order(as.numeric(as.character(ordenando$Omhnios))),] )
}
lista_rpm_resistencia_ordenada<-lapply(lista_rpm_resistencia, ordenando)
for (pruebas in 1:length(lista_rpm_resistencia_ordenada)) {
dir.create(paste0(here(),"/graficos_RPM_Resistencia/"))
#jpeg(paste0(here(),"/graficos_RPM_Resistencia/",nombres_lista[pruebas],".jpeg"))
tiff(paste0(here(),"/graficos_RPM_Resistencia/",nombres_lista[pruebas],".tiff"), width = 7, height =7, units = 'in', res = 300)
x<-as.numeric(as.character(lista_rpm_resistencia_ordenada[[pruebas]][,2]))
y<- as.numeric(as.character(lista_rpm_resistencia_ordenada[[pruebas]][,1]))
m<-nls(y~a*x/(b+x))
#get some estimation of goodness of fit
cor(y,predict(m))
plot(NULL,xlim=c(0,max(x)),
ylim = c(0,max(y)),cex=0.005, yaxt ="n",
xlab = "Omhnios", ylab = "RPM", bty='L')
par(new=T)
lines(x,predict(m),lty=2,col="red",lwd=1)
points(x,y, pch= 1)
par(new=T)
text(max(x)/2,max(y)/2,labels=paste("Correlación = ",as.character(round(cor(y,predict(m)),3))))
axis(2, at=seq(0,max(y), by=round(max(y)/10,1)),las=2)
title(main = "Gráfica RPM-Resistencia", sub = paste0("Experimento = ",titulos_grafico[pruebas]))
dev.off()
}
return(lista_rpm_resistencia_ordenada)
}
coeficientes_RPM<-ajuste_RPM_Resistencia_so(df,tablas_sin_outliers_ni_decreasing)
ajuste_RPM_Resistencia_so<- function(df,tabla_sinout){
group_number<-length(attr(group_by(df,experimento,angulo,porcentaje), "group"))
r<- (-2)
lista_rpm_resistencia<- list()
nombres_lista<- vector()
titulos_grafico<- vector()
tabladenombres<- matrix(-31,ncol = 3, nrow = group_number)
for (grupos in 1:group_number) {
grupos_rpm_resistencia<- df %>% group_by(.,experimento,angulo,porcentaje) %>% select_groups(grupos)
tabla_resistencia_rpm<- as.data.frame(cbind(as.numeric(grupos_rpm_resistencia$RPM),as.data.frame(grupos_rpm_resistencia$resistencia)))
colnames(tabla_resistencia_rpm)<- c("RPM", "Omhnios")
nombre_tabla<- unique(paste(grupos_rpm_resistencia$experimento,grupos_rpm_resistencia$angulo,grupos_rpm_resistencia$porcentaje,sep = "_"))
if(is.na(grupos_rpm_resistencia$angulo)){
titulo_graph<- unique(paste0(grupos_rpm_resistencia$experimento,"-",grupos_rpm_resistencia$porcentaje,"%"))
}else{
titulo_graph<- unique(paste0(grupos_rpm_resistencia$experimento,"-",grupos_rpm_resistencia$angulo,"º-",grupos_rpm_resistencia$porcentaje,"%"))
}
titulos_grafico[grupos]<- titulo_graph
lista_rpm_resistencia[[grupos]]<- tabla_resistencia_rpm
nombres_lista[grupos]<- nombre_tabla
tabladenombres[grupos,1]<-as.character(grupos_rpm_resistencia$experimento[1])
tabladenombres[grupos,2]<- as.character(grupos_rpm_resistencia$angulo[1])
tabladenombres[grupos,3]<- as.character(grupos_rpm_resistencia$porcentaje[1])
}
ordenando<- function(ordenando){
return(ordenando[order(as.numeric(as.character(ordenando$Omhnios))),] )
}
lista_rpm_resistencia_ordenada<-lapply(lista_rpm_resistencia, ordenando)
lista_coef<-list()
for (pruebas in 1:length(lista_rpm_resistencia_ordenada)) {
dir.create(paste0(here(),"/graficos_RPM_Resistencia_sinout/"))
#jpeg(paste0(here(),"/graficos_RPM_Resistencia/",nombres_lista[pruebas],".jpeg"))
tiff(paste0(here(),"/graficos_RPM_Resistencia/",nombres_lista[pruebas],".tiff"), width = 7, height =7, units = 'in', res = 300)
x<-as.numeric(as.character(lista_rpm_resistencia_ordenada[[pruebas]][,2]))
x_so<-tabla_sinout[[pruebas]][,2]
y<- as.numeric(as.character(lista_rpm_resistencia_ordenada[[pruebas]][,1]))
y_so<-tabla_sinout[[pruebas]][,1]
#dat<-as.data.frame(cbind(tabla_sinout[[pruebas]][,2],tabla_sinout[[pruebas]][,1]))
#names(dat)<- c("x","y")
#f <- function(x,a,b) {a * exp(b * x)}
#fm0 <- nls(log(y) ~ log(f(x, a, b)),dat, start = c(a = 1, b = 1))
#nls(y_so ~ f(x_so, a, b), start = coef(fm0))
m<-nls(y~a*x/(b+x))
m_so_1<-function(y_so,x_so){
return(nls(y_so~a*x_so/(b+x_so)))
}
m_so_2<-function(y_so,x_so){
return(nlsLM(y_so~a*x_so/(b+x_so)))
}
m_so<-tryCatch(m_so_1(y_so,x_so), error=function(e) m_so_2(y_so,x_so))
coefa_so<-coef(m_so)[1]
coefb_so<- coef(m_so)[2]
x_so_seq<- seq(0,8000,by=1)
y_so_seq<- coefa_so*x_so_seq/(coefb_so+x_so_seq)
coefa <-coef(m)[1]
coefb <- coef(m)[2]
x_seq<- seq(0,8000,by=1)
y_seq<- coefa*x_seq/(coefb+x_seq)
plot(NULL,xlim=c(0,8000),
ylim = c(0,(max(y_so_seq)+(max(y_so_seq))/5)),cex=0.005, yaxt ="n",
xlab =  expression(paste("Resistencia (",Omega,")")), ylab = "Velocidad Angular (RPM)", bty='L')
par(new=T)
#lines(x,predict(m),lty=2,col="red",lwd=1)
lines(x_seq,y_seq,lty=2, col="red",lwd=1)
par(new=T)
#lines(x_so,predict(m_so),lty=2,col="blue",lwd=1)
lines(x_so_seq,y_so_seq,lty=2,col="blue",lwd=1)
points(x_so,y_so, pch= 4, col="blue")
x_dif<-length(setdiff(x, x_so))
y_dif<-length(setdiff(round(y,r),round(y_so,r)))
while(x_dif != y_dif){
y_dif<-length(setdiff(round(y,r),round(y_so,r)))
r<-r+1}
if(x_dif==y_dif){
points(setdiff(x, x_so),setdiff(round(y,r),round(y_so,r)), pch=20, col="red", cex=1.5)
}
subtitle_nom<- paste0("Experimento = ",titulos_grafico[pruebas])
maintitle<- paste0("Gráfica Velocidad Angular-Resistencia \n",subtitle_nom)
par(new=T)
axis(2, at=seq(0,(max(y_so_seq)+(max(y_so_seq))/5), by=round((max(y_so_seq)+(max(y_so_seq))/5)/10,-1)),las=2)
title(main = maintitle)
R_sinVA<- paste0("Regresión sin VA"," (Correlación= ",as.character(round(cor(y_so,predict(m_so)),3)),")")
R_conVA<- paste0("Regresión con VA"," (Correlación= ",as.character(round(cor(y,predict(m)),3)),")")
legend("right", inset=c(0,0),
legend = c(R_sinVA,R_conVA,"Valores comunes", "Valores atípicos "),
pch = c(NA,NA, 4,20),
lty = c(2,2,NA,NA),
col = c("blue","red","black","red"),ncol = 1,cex = 1)
dev.off()
correlacion_sino<-cor(y_so,predict(m_so))
correlacion_cono<-cor(y,predict(m))
if(correlacion_sino>= correlacion_cono){
aa<- coefa_so
bb<- coefb_so
}else{
aa<- coefa
bb<-coefb
}
coef_tabla<- cbind(as.character(tabladenombres[pruebas,1]),as.character(tabladenombres[pruebas,2]),
as.character(tabladenombres[pruebas,3]),aa,bb)
names(coef_tabla)<-c("Experimento","Angulo","Porcentaje","a","b")
lista_coef[[pruebas]]<-coef_tabla
}
return(lista_coef)
}
coeficientes_RPM<-ajuste_RPM_Resistencia_so(df,tablas_sin_outliers_ni_decreasing)
source('~/ProyectoRoseo1/Procesado_datos_ploteos.R', encoding = 'UTF-8')
ploteo_experimento_lectura_RPM_regresion(df,3)
##funcion para plotear todas las graficas de Cp a todas las velocidades, comparando experimentos
ploteo_CPmax10<- function(datos,grados){
df<-datos
select_groups <- function(data, groups) {
data[sort(unlist(attr(data, "indices")[ groups ])) + 1, ]
}
lista_Cpmax_total<-list()
lista_Cps_nueva<-list()
nombres_gra<- vector()
group_number<-length(attr(group_by(df,experimento,angulo), "group"))
for (groups_ind in 1:group_number) {
xx<- df %>% group_by(.,experimento,angulo) %>% select_groups(groups_ind)
percentaje_number<-length(attr(group_by(xx,porcentaje), "group") )
nombre_1<-as.character(xx$experimento[1])
nombre_2<-as.character(xx$angulo[1])
nombre<-paste(nombre_1,nombre_2,sep = "_")
if(is.na(nombre_2)){
nombre_grafica<- nombre_1
}else{
nombre_grafica<-paste(nombre_1," ",nombre_2,"º",sep = "")
}
xx_percentaje<-list()
for (per in 1:percentaje_number) {
xx_perc<- xx %>% group_by(.,porcentaje) %>% select_groups(per)
xx_perc<-cbind(xx_perc$cp_est,xx_perc$TSR_regresion_est,xx_perc$Vviento_estandar)
colnames(xx_perc)<- c("cp","TSR", "`m/s`")
xx_percentaje[[per]]<- xx_perc
}
##lambda_cp es una tabla de dos columnas (cp,lambda)
lambda_Cp<- xx_percentaje
lambda_Cp_clean<-list()
for(j in 1:length(lambda_Cp)){
cp_lmb<- lambda_Cp[[j]]
cp_lmb<-cp_lmb[order(cp_lmb[,2]),]
TSR_1<-cp_lmb[,2]
Cp_1<-cp_lmb[,1]
V_tsr<- seq(0.05,max(TSR_1),by=max(TSR_1)/8)
TSR_2<- vector()
Cp_2<- vector()
for(i in 1:length(V_tsr)){
Cp_2[i]<- Cp_1[which.min(abs(TSR_1-V_tsr[i]))]
TSR_2[i]<-TSR_1[which.min(abs(TSR_1-V_tsr[i]))]
}
validacion<-cbind(unique(Cp_2),unique(TSR_2))
validacion_1<- validacion[1:which.max(validacion[,1]),]
validacion_2<- validacion[(which.max(validacion[,1])+1):length(validacion[,1]),]
indeeex<- vector()
rr<- 1
if(length(validacion_2)==2){
validacion_2<- validacion_2
}else{
for (i in 1:length(validacion_2[,1])) {
if(i==length(validacion_2[,1])){break}else{
if(validacion_2[i,1] < validacion_2[(i+1),1]){
indeeex[rr]<- as.numeric(i)
rr<-rr+1
}
}
}
}
if(length(indeeex)==0){
validacion_2<- validacion_2
}else{
validacion_2<-validacion_2[-indeeex,]
}
clean_table<-rbind(validacion_1,validacion_2)
lambda_Cp_clean[[j]]<- clean_table
}
lista_Cps_nueva[[groups_ind]]<- lambda_Cp_clean
nombres_gra[groups_ind]<- nombre_grafica
}
vector_nombre_vel<- c(10.34,5.47,6.04,7.29,8.33,9.36)
for (porcentaje in 1:length(lista_Cps_nueva[[1]])) {
lista_cpmsVmax<- lapply(lista_Cps_nueva,"[[",porcentaje)
x_max<-max(sapply(lista_cpmsVmax, function(x) max(x[,2])))
y_max<-max(sapply(lista_cpmsVmax, function(x) max(x[,1])))
dir.create(paste0(here(),"/graficos_Cp_juntos/"))
#jpeg(paste0(here(),"/graficos_Cp_juntos/",porcentaje,".jpeg"))
tiff(paste0(here(),"/graficos_Cp_juntos/",porcentaje,".tiff"), width = 7, height =7, units = 'in', res = 300)
colores<- c("orange","red","blue","dodgerblue4","purple")
pch_dif<-c(0:5)
for(i in 1:(length(lista_cpmsVmax))){
x<- lista_cpmsVmax[[i]][,2]
y<- lista_cpmsVmax[[i]][,1]
fit5<-lm(y~poly(x,grados,raw=TRUE))
xx <- seq(min(x),max(x), by=0.01)
plot(NULL,xlim=c(0,(x_max+0.2)),
ylim = c(0,(y_max+0.01)),cex=0.005, yaxt ="n",
xlab = "TSR", ylab = "Cp", bty='L')
par(new=T)
lines(xx, predict(fit5, data.frame(x=xx)), col=colores[i],lwd=2)
tabla_maxcp<-cbind(xx,predict(fit5, data.frame(x=xx)))
par(new=T)
}
axis(2, at=unique(round(seq(0,(y_max+0.02), by=round((y_max/10),digits = 4)),digits = 2)),las=2)
leyenda<-paste0(nombres_gra)
legend("topright", inset=c(0,0),leyenda,
text.col = colores,ncol = 1,cex = 1)
titulo<- paste0("Comparación de gráficas Cp-TSR a ",vector_nombre_vel[porcentaje],"m/s")
title(main = titulo)
dev.off()
}
}
ploteo_CPmax10(df,2)
##funcion para plotear todas las graficas de Cp a todas las velocidades, comparando experimentos
ploteo_CPmax10<- function(datos,grados){
df<-datos
select_groups <- function(data, groups) {
data[sort(unlist(attr(data, "indices")[ groups ])) + 1, ]
}
lista_Cpmax_total<-list()
lista_Cps_nueva<-list()
nombres_gra<- vector()
group_number<-length(attr(group_by(df,experimento,angulo), "group"))
for (groups_ind in 1:group_number) {
xx<- df %>% group_by(.,experimento,angulo) %>% select_groups(groups_ind)
percentaje_number<-length(attr(group_by(xx,porcentaje), "group") )
nombre_1<-as.character(xx$experimento[1])
nombre_2<-as.character(xx$angulo[1])
nombre<-paste(nombre_1,nombre_2,sep = "_")
if(is.na(nombre_2)){
nombre_grafica<- nombre_1
}else{
nombre_grafica<-paste(nombre_1," ",nombre_2,"º",sep = "")
}
xx_percentaje<-list()
for (per in 1:percentaje_number) {
xx_perc<- xx %>% group_by(.,porcentaje) %>% select_groups(per)
xx_perc<-cbind(xx_perc$cp_est,xx_perc$TSR_regresion_est,xx_perc$`m/s`)
colnames(xx_perc)<- c("cp","TSR", "Vviento")
xx_percentaje[[per]]<- xx_perc
}
##lambda_cp es una tabla de dos columnas (cp,lambda)
lambda_Cp<- xx_percentaje
lambda_Cp_clean<-list()
for(j in 1:length(lambda_Cp)){
cp_lmb<- lambda_Cp[[j]]
cp_lmb<-cp_lmb[order(cp_lmb[,2]),]
TSR_1<-cp_lmb[,2]
Cp_1<-cp_lmb[,1]
V_tsr<- seq(0.05,max(TSR_1),by=max(TSR_1)/8)
TSR_2<- vector()
Cp_2<- vector()
for(i in 1:length(V_tsr)){
Cp_2[i]<- Cp_1[which.min(abs(TSR_1-V_tsr[i]))]
TSR_2[i]<-TSR_1[which.min(abs(TSR_1-V_tsr[i]))]
}
validacion<-cbind(unique(Cp_2),unique(TSR_2))
validacion_1<- validacion[1:which.max(validacion[,1]),]
validacion_2<- validacion[(which.max(validacion[,1])+1):length(validacion[,1]),]
indeeex<- vector()
rr<- 1
if(length(validacion_2)==2){
validacion_2<- validacion_2
}else{
for (i in 1:length(validacion_2[,1])) {
if(i==length(validacion_2[,1])){break}else{
if(validacion_2[i,1] < validacion_2[(i+1),1]){
indeeex[rr]<- as.numeric(i)
rr<-rr+1
}
}
}
}
if(length(indeeex)==0){
validacion_2<- validacion_2
}else{
validacion_2<-validacion_2[-indeeex,]
}
clean_table<-rbind(validacion_1,validacion_2)
lambda_Cp_clean[[j]]<- clean_table
}
lista_Cps_nueva[[groups_ind]]<- lambda_Cp_clean
nombres_gra[groups_ind]<- nombre_grafica
}
vector_nombre_vel<- c(10.34,5.47,6.04,7.29,8.33,9.36)
for (porcentaje in 1:length(lista_Cps_nueva[[1]])) {
lista_cpmsVmax<- lapply(lista_Cps_nueva,"[[",porcentaje)
x_max<-max(sapply(lista_cpmsVmax, function(x) max(x[,2])))
y_max<-max(sapply(lista_cpmsVmax, function(x) max(x[,1])))
dir.create(paste0(here(),"/graficos_Cp_juntos/"))
#jpeg(paste0(here(),"/graficos_Cp_juntos/",porcentaje,".jpeg"))
tiff(paste0(here(),"/graficos_Cp_juntos/",porcentaje,".tiff"), width = 7, height =7, units = 'in', res = 300)
colores<- c("orange","red","blue","dodgerblue4","purple")
pch_dif<-c(0:5)
for(i in 1:(length(lista_cpmsVmax))){
x<- lista_cpmsVmax[[i]][,2]
y<- lista_cpmsVmax[[i]][,1]
fit5<-lm(y~poly(x,grados,raw=TRUE))
xx <- seq(min(x),max(x), by=0.01)
plot(NULL,xlim=c(0,(x_max+0.2)),
ylim = c(0,(y_max+0.01)),cex=0.005, yaxt ="n",
xlab = "TSR", ylab = "Cp", bty='L')
par(new=T)
lines(xx, predict(fit5, data.frame(x=xx)), col=colores[i],lwd=2)
tabla_maxcp<-cbind(xx,predict(fit5, data.frame(x=xx)))
par(new=T)
}
axis(2, at=unique(round(seq(0,(y_max+0.02), by=round((y_max/10),digits = 4)),digits = 2)),las=2)
leyenda<-paste0(nombres_gra)
legend("topright", inset=c(0,0),leyenda,
text.col = colores,ncol = 1,cex = 1)
titulo<- paste0("Comparación de gráficas Cp-TSR a ",vector_nombre_vel[porcentaje],"m/s")
title(main = titulo)
dev.off()
}
}
ploteo_CPmax10(df,2)
##funcion para plotear todas las graficas de Cp a todas las velocidades, comparando experimentos
ploteo_CPmax10<- function(datos,grados){
df<-datos
select_groups <- function(data, groups) {
data[sort(unlist(attr(data, "indices")[ groups ])) + 1, ]
}
lista_Cpmax_total<-list()
lista_Cps_nueva<-list()
nombres_gra<- vector()
group_number<-length(attr(group_by(df,experimento,angulo), "group"))
for (groups_ind in 1:group_number) {
xx<- df %>% group_by(.,experimento,angulo) %>% select_groups(groups_ind)
percentaje_number<-length(attr(group_by(xx,porcentaje), "group") )
nombre_1<-as.character(xx$experimento[1])
nombre_2<-as.character(xx$angulo[1])
nombre<-paste(nombre_1,nombre_2,sep = "_")
if(is.na(nombre_2)){
nombre_grafica<- nombre_1
}else{
nombre_grafica<-paste(nombre_1," ",nombre_2,"º",sep = "")
}
xx_percentaje<-list()
for (per in 1:percentaje_number) {
xx_perc<- xx %>% group_by(.,porcentaje) %>% select_groups(per)
xx_perc<-cbind(xx_perc$cp,xx_perc$TSR,xx_perc$`m/s`)
colnames(xx_perc)<- c("cp","TSR", "Vviento")
xx_percentaje[[per]]<- xx_perc
}
##lambda_cp es una tabla de dos columnas (cp,lambda)
lambda_Cp<- xx_percentaje
lambda_Cp_clean<-list()
for(j in 1:length(lambda_Cp)){
cp_lmb<- lambda_Cp[[j]]
cp_lmb<-cp_lmb[order(cp_lmb[,2]),]
TSR_1<-cp_lmb[,2]
Cp_1<-cp_lmb[,1]
V_tsr<- seq(0.05,max(TSR_1),by=max(TSR_1)/8)
TSR_2<- vector()
Cp_2<- vector()
for(i in 1:length(V_tsr)){
Cp_2[i]<- Cp_1[which.min(abs(TSR_1-V_tsr[i]))]
TSR_2[i]<-TSR_1[which.min(abs(TSR_1-V_tsr[i]))]
}
validacion<-cbind(unique(Cp_2),unique(TSR_2))
validacion_1<- validacion[1:which.max(validacion[,1]),]
validacion_2<- validacion[(which.max(validacion[,1])+1):length(validacion[,1]),]
indeeex<- vector()
rr<- 1
if(length(validacion_2)==2){
validacion_2<- validacion_2
}else{
for (i in 1:length(validacion_2[,1])) {
if(i==length(validacion_2[,1])){break}else{
if(validacion_2[i,1] < validacion_2[(i+1),1]){
indeeex[rr]<- as.numeric(i)
rr<-rr+1
}
}
}
}
if(length(indeeex)==0){
validacion_2<- validacion_2
}else{
validacion_2<-validacion_2[-indeeex,]
}
clean_table<-rbind(validacion_1,validacion_2)
lambda_Cp_clean[[j]]<- clean_table
}
lista_Cps_nueva[[groups_ind]]<- lambda_Cp_clean
nombres_gra[groups_ind]<- nombre_grafica
}
vector_nombre_vel<- c(10.34,5.47,6.04,7.29,8.33,9.36)
for (porcentaje in 1:length(lista_Cps_nueva[[1]])) {
lista_cpmsVmax<- lapply(lista_Cps_nueva,"[[",porcentaje)
x_max<-max(sapply(lista_cpmsVmax, function(x) max(x[,2])))
y_max<-max(sapply(lista_cpmsVmax, function(x) max(x[,1])))
dir.create(paste0(here(),"/graficos_Cp_juntos/"))
#jpeg(paste0(here(),"/graficos_Cp_juntos/",porcentaje,".jpeg"))
tiff(paste0(here(),"/graficos_Cp_juntos/",porcentaje,".tiff"), width = 7, height =7, units = 'in', res = 300)
colores<- c("orange","red","blue","dodgerblue4","purple")
pch_dif<-c(0:5)
for(i in 1:(length(lista_cpmsVmax))){
x<- lista_cpmsVmax[[i]][,2]
y<- lista_cpmsVmax[[i]][,1]
fit5<-lm(y~poly(x,grados,raw=TRUE))
xx <- seq(min(x),max(x), by=0.01)
plot(NULL,xlim=c(0,(x_max+0.2)),
ylim = c(0,(y_max+0.01)),cex=0.005, yaxt ="n",
xlab = "TSR", ylab = "Cp", bty='L')
par(new=T)
lines(xx, predict(fit5, data.frame(x=xx)), col=colores[i],lwd=2)
tabla_maxcp<-cbind(xx,predict(fit5, data.frame(x=xx)))
par(new=T)
}
axis(2, at=unique(round(seq(0,(y_max+0.02), by=round((y_max/10),digits = 4)),digits = 2)),las=2)
leyenda<-paste0(nombres_gra)
legend("topright", inset=c(0,0),leyenda,
text.col = colores,ncol = 1,cex = 1)
titulo<- paste0("Comparación de gráficas Cp-TSR a ",vector_nombre_vel[porcentaje],"m/s")
title(main = titulo)
dev.off()
}
}
ploteo_CPmax10(df,2)
df$experimento != "piloto"
df %>% mutate(V_viento_correcion= ifelse(df$experimento != "piloto"), df$`m/s`/0.7, df$`m/s`)
df %>% mutate(V_viento_correcion= ifelse(df$experimento != "piloto", (df$`m/s`)/0.7, df$`m/s`))
View(df)
df%<>% mutate(V_viento_correcion= ifelse(df$experimento != "piloto", (df$`m/s`)/0.7, df$`m/s`))
View(df)
