\documentclass[]{article}
\usepackage{lmodern}
\usepackage{amssymb,amsmath}
\usepackage{ifxetex,ifluatex}
\usepackage{fixltx2e} % provides \textsubscript
\ifnum 0\ifxetex 1\fi\ifluatex 1\fi=0 % if pdftex
  \usepackage[T1]{fontenc}
  \usepackage[utf8]{inputenc}
\else % if luatex or xelatex
  \ifxetex
    \usepackage{mathspec}
  \else
    \usepackage{fontspec}
  \fi
  \defaultfontfeatures{Ligatures=TeX,Scale=MatchLowercase}
\fi
% use upquote if available, for straight quotes in verbatim environments
\IfFileExists{upquote.sty}{\usepackage{upquote}}{}
% use microtype if available
\IfFileExists{microtype.sty}{%
\usepackage{microtype}
\UseMicrotypeSet[protrusion]{basicmath} % disable protrusion for tt fonts
}{}
\usepackage[margin=1in]{geometry}
\usepackage{hyperref}
\hypersetup{unicode=true,
            pdftitle={Integración de turbinas en edificos I},
            pdfauthor={Óscar García Hernández},
            pdfborder={0 0 0},
            breaklinks=true}
\urlstyle{same}  % don't use monospace font for urls
\usepackage{color}
\usepackage{fancyvrb}
\newcommand{\VerbBar}{|}
\newcommand{\VERB}{\Verb[commandchars=\\\{\}]}
\DefineVerbatimEnvironment{Highlighting}{Verbatim}{commandchars=\\\{\}}
% Add ',fontsize=\small' for more characters per line
\usepackage{framed}
\definecolor{shadecolor}{RGB}{248,248,248}
\newenvironment{Shaded}{\begin{snugshade}}{\end{snugshade}}
\newcommand{\KeywordTok}[1]{\textcolor[rgb]{0.13,0.29,0.53}{\textbf{#1}}}
\newcommand{\DataTypeTok}[1]{\textcolor[rgb]{0.13,0.29,0.53}{#1}}
\newcommand{\DecValTok}[1]{\textcolor[rgb]{0.00,0.00,0.81}{#1}}
\newcommand{\BaseNTok}[1]{\textcolor[rgb]{0.00,0.00,0.81}{#1}}
\newcommand{\FloatTok}[1]{\textcolor[rgb]{0.00,0.00,0.81}{#1}}
\newcommand{\ConstantTok}[1]{\textcolor[rgb]{0.00,0.00,0.00}{#1}}
\newcommand{\CharTok}[1]{\textcolor[rgb]{0.31,0.60,0.02}{#1}}
\newcommand{\SpecialCharTok}[1]{\textcolor[rgb]{0.00,0.00,0.00}{#1}}
\newcommand{\StringTok}[1]{\textcolor[rgb]{0.31,0.60,0.02}{#1}}
\newcommand{\VerbatimStringTok}[1]{\textcolor[rgb]{0.31,0.60,0.02}{#1}}
\newcommand{\SpecialStringTok}[1]{\textcolor[rgb]{0.31,0.60,0.02}{#1}}
\newcommand{\ImportTok}[1]{#1}
\newcommand{\CommentTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textit{#1}}}
\newcommand{\DocumentationTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\newcommand{\AnnotationTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\newcommand{\CommentVarTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\newcommand{\OtherTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{#1}}
\newcommand{\FunctionTok}[1]{\textcolor[rgb]{0.00,0.00,0.00}{#1}}
\newcommand{\VariableTok}[1]{\textcolor[rgb]{0.00,0.00,0.00}{#1}}
\newcommand{\ControlFlowTok}[1]{\textcolor[rgb]{0.13,0.29,0.53}{\textbf{#1}}}
\newcommand{\OperatorTok}[1]{\textcolor[rgb]{0.81,0.36,0.00}{\textbf{#1}}}
\newcommand{\BuiltInTok}[1]{#1}
\newcommand{\ExtensionTok}[1]{#1}
\newcommand{\PreprocessorTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textit{#1}}}
\newcommand{\AttributeTok}[1]{\textcolor[rgb]{0.77,0.63,0.00}{#1}}
\newcommand{\RegionMarkerTok}[1]{#1}
\newcommand{\InformationTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\newcommand{\WarningTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\newcommand{\AlertTok}[1]{\textcolor[rgb]{0.94,0.16,0.16}{#1}}
\newcommand{\ErrorTok}[1]{\textcolor[rgb]{0.64,0.00,0.00}{\textbf{#1}}}
\newcommand{\NormalTok}[1]{#1}
\usepackage{graphicx,grffile}
\makeatletter
\def\maxwidth{\ifdim\Gin@nat@width>\linewidth\linewidth\else\Gin@nat@width\fi}
\def\maxheight{\ifdim\Gin@nat@height>\textheight\textheight\else\Gin@nat@height\fi}
\makeatother
% Scale images if necessary, so that they will not overflow the page
% margins by default, and it is still possible to overwrite the defaults
% using explicit options in \includegraphics[width, height, ...]{}
\setkeys{Gin}{width=\maxwidth,height=\maxheight,keepaspectratio}
\IfFileExists{parskip.sty}{%
\usepackage{parskip}
}{% else
\setlength{\parindent}{0pt}
\setlength{\parskip}{6pt plus 2pt minus 1pt}
}
\setlength{\emergencystretch}{3em}  % prevent overfull lines
\providecommand{\tightlist}{%
  \setlength{\itemsep}{0pt}\setlength{\parskip}{0pt}}
\setcounter{secnumdepth}{0}
% Redefines (sub)paragraphs to behave more like sections
\ifx\paragraph\undefined\else
\let\oldparagraph\paragraph
\renewcommand{\paragraph}[1]{\oldparagraph{#1}\mbox{}}
\fi
\ifx\subparagraph\undefined\else
\let\oldsubparagraph\subparagraph
\renewcommand{\subparagraph}[1]{\oldsubparagraph{#1}\mbox{}}
\fi

%%% Use protect on footnotes to avoid problems with footnotes in titles
\let\rmarkdownfootnote\footnote%
\def\footnote{\protect\rmarkdownfootnote}

%%% Change title format to be more compact
\usepackage{titling}

% Create subtitle command for use in maketitle
\newcommand{\subtitle}[1]{
  \posttitle{
    \begin{center}\large#1\end{center}
    }
}

\setlength{\droptitle}{-2em}

  \title{Integración de turbinas en edificos I}
    \pretitle{\vspace{\droptitle}\centering\huge}
  \posttitle{\par}
    \author{Óscar García Hernández}
    \preauthor{\centering\large\emph}
  \postauthor{\par}
      \predate{\centering\large\emph}
  \postdate{\par}
    \date{18 de septiembre de 2018}


\begin{document}
\maketitle

\section{Introducción}\label{introduccion}

En el presente documento se presentará el código empleado para el
tratamiento de los datos obtenidos en las pruebas. Cabe mencionar que el
código empleado se ha estructurado básicamente en 2 scripts. Uno en el
que definimos todas las funciones creadas y otro script en el que se
aplican todas estas funciones para obtener las gráficas y los
resultados. Además, se han añadido dos scripts adicionales: un para el
tratamiento de valores atípicos en la medición de la velocidad de giro y
otro para los cálculos necesarios para el ``ejemplo'' en el edificio de
bilbao.

\subsection{Código empleado}\label{codigo-empleado}

\subsubsection{Script de funciones}\label{script-de-funciones}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{library}\NormalTok{(stringr)}
\KeywordTok{library}\NormalTok{(magrittr)}
\KeywordTok{library}\NormalTok{(here)}
\KeywordTok{library}\NormalTok{(dplyr)}
\KeywordTok{library}\NormalTok{(ggplot2)}
\KeywordTok{library}\NormalTok{(minpack.lm)}

\NormalTok{procesador <-}\StringTok{ }\ControlFlowTok{function}\NormalTok{(path_to_csv)\{}
  
\NormalTok{  path_to_txt <-}\StringTok{ }\KeywordTok{str_replace}\NormalTok{(path_to_csv, }\DataTypeTok{pattern =} \StringTok{'csv'}\NormalTok{,}\DataTypeTok{replacement =} \StringTok{'txt'}\NormalTok{)}
  
\NormalTok{  path_to_speed <-}\StringTok{ }\KeywordTok{str_split}\NormalTok{(path_to_csv, }\StringTok{'/'}\NormalTok{, }\DataTypeTok{simplify =} \OtherTok{TRUE}\NormalTok{)}
\NormalTok{  path_to_speed <-}\StringTok{ }\NormalTok{path_to_speed[}\OperatorTok{-}\KeywordTok{length}\NormalTok{(path_to_speed)]}
\NormalTok{  path_to_speed <-}\StringTok{ }\KeywordTok{paste}\NormalTok{(path_to_speed, }\DataTypeTok{collapse=}\StringTok{'/'}\NormalTok{)}
  
\NormalTok{  path_to_speed_mean <-}\StringTok{ }\KeywordTok{paste}\NormalTok{(path_to_speed,}\StringTok{"Vviento_mean.txt"}\NormalTok{,}\DataTypeTok{sep =} \StringTok{'/'}\NormalTok{)}
\NormalTok{  path_to_speed <-}\StringTok{ }\KeywordTok{paste}\NormalTok{(path_to_speed,}\StringTok{"Vviento.txt"}\NormalTok{,}\DataTypeTok{sep =} \StringTok{'/'}\NormalTok{)}
  
  \ControlFlowTok{if}\NormalTok{(}\OperatorTok{!}\KeywordTok{file.exists}\NormalTok{(path_to_speed_mean))\{}
    
\NormalTok{    speed_mean <-}\StringTok{ }\KeywordTok{mean}\NormalTok{(}\KeywordTok{read.table}\NormalTok{(path_to_speed)[,}\DecValTok{1}\NormalTok{])}
    \KeywordTok{write.table}\NormalTok{(speed_mean,}\DataTypeTok{file =}\NormalTok{ path_to_speed_mean)}
\NormalTok{  \}}\ControlFlowTok{else}\NormalTok{\{}
\NormalTok{    speed_mean<-}\StringTok{ }\KeywordTok{read.table}\NormalTok{(path_to_speed_mean)}
    \ControlFlowTok{if}\NormalTok{(}\KeywordTok{is.na}\NormalTok{(speed_mean))\{}
\NormalTok{      speed_mean <-}\StringTok{ }\KeywordTok{mean}\NormalTok{(}\KeywordTok{read.table}\NormalTok{(path_to_speed)[,}\DecValTok{1}\NormalTok{])}
      \KeywordTok{write.table}\NormalTok{(speed_mean,}\DataTypeTok{file =}\NormalTok{ path_to_speed_mean) }
\NormalTok{    \} }\ControlFlowTok{else}\NormalTok{\{}
\NormalTok{      speed_mean <-}\StringTok{ }\NormalTok{speed_mean[}\DecValTok{1}\NormalTok{,}\DecValTok{1}\NormalTok{]}
\NormalTok{    \}}
\NormalTok{  \}}
  
  
  
\NormalTok{  rpm<-}\KeywordTok{colMeans}\NormalTok{(}\KeywordTok{as.data.frame}\NormalTok{(}\KeywordTok{read.table}\NormalTok{(path_to_txt)))}
  
\NormalTok{  y<-}\KeywordTok{read.table}\NormalTok{(path_to_csv, }\DataTypeTok{sep =}\StringTok{","}\NormalTok{ )}
  \CommentTok{# El CSV que ofrece el BK es kk esta todo separado por comas}
\NormalTok{  volts_amps<-}\StringTok{ }\KeywordTok{colMeans}\NormalTok{(}\KeywordTok{as.data.frame}\NormalTok{(}\KeywordTok{cbind}\NormalTok{(}\KeywordTok{as.numeric}\NormalTok{(}\KeywordTok{paste0}\NormalTok{(y[,}\DecValTok{1}\NormalTok{],}\StringTok{"."}\NormalTok{,y[,}\DecValTok{2}\NormalTok{])),}
                                            \KeywordTok{as.numeric}\NormalTok{(y[,}\DecValTok{3}\NormalTok{]}\OperatorTok{+}\NormalTok{y[,}\DecValTok{4}\NormalTok{]}\OperatorTok{*}\DecValTok{10}\OperatorTok{^}\NormalTok{(}\OperatorTok{-}\DecValTok{4}\NormalTok{)))))}
  
\NormalTok{  ##introduzco las velocidades del experimento piloto: Vel}
\NormalTok{  processed_file <-}\KeywordTok{as.data.frame}\NormalTok{( }\KeywordTok{cbind}\NormalTok{(rpm[}\DecValTok{1}\NormalTok{],speed_mean, volts_amps[}\DecValTok{1}\NormalTok{], volts_amps[}\DecValTok{2}\NormalTok{]))}
  \KeywordTok{names}\NormalTok{(processed_file)<-}\StringTok{ }\KeywordTok{c}\NormalTok{(}\StringTok{"RPM"}\NormalTok{,}\StringTok{"m/s"}\NormalTok{,}\StringTok{"V"}\NormalTok{, }\StringTok{"A"}\NormalTok{)}
  
  \KeywordTok{return}\NormalTok{(processed_file)}
\NormalTok{\}}
\NormalTok{df_mutate<-}\ControlFlowTok{function}\NormalTok{(tabla_cruda)\{}
\NormalTok{  df<-}\StringTok{ }\NormalTok{tabla_cruda}
\NormalTok{  df }\OperatorTok{%<>%}\StringTok{ }\KeywordTok{mutate}\NormalTok{(}\DataTypeTok{experimento=} \KeywordTok{factor}\NormalTok{( }
    \KeywordTok{ifelse}\NormalTok{(}\KeywordTok{str_detect}\NormalTok{(archivos, }\StringTok{'concentrador'}\NormalTok{), }\StringTok{'concentrador'}\NormalTok{,}
           \KeywordTok{ifelse}\NormalTok{(}\KeywordTok{str_detect}\NormalTok{(archivos, }\StringTok{'piloto'}\NormalTok{), }\StringTok{'piloto'}\NormalTok{,}\StringTok{'pared'}\NormalTok{)}
\NormalTok{    ) }
\NormalTok{  )}
\NormalTok{  )}
\NormalTok{  df }\OperatorTok{%<>%}\StringTok{ }\KeywordTok{mutate}\NormalTok{(}\DataTypeTok{angulo=}  \KeywordTok{str_extract}\NormalTok{(archivos,}\DataTypeTok{pattern =} \StringTok{"concentrador/[0-9]+"}\NormalTok{) ) }\OperatorTok{%>%}\StringTok{ }
\StringTok{    }\KeywordTok{mutate}\NormalTok{(}\DataTypeTok{angulo =}  \KeywordTok{factor}\NormalTok{(}\KeywordTok{str_remove}\NormalTok{(angulo,}\DataTypeTok{pattern =} \StringTok{"concentrador/"}\NormalTok{) ),}
           \DataTypeTok{porcentaje=}\KeywordTok{str_extract}\NormalTok{(archivos, }\DataTypeTok{pattern =} \StringTok{"prueba_[0-9]+"}\NormalTok{)) }\OperatorTok{%>%}\StringTok{ }
\StringTok{    }\KeywordTok{mutate}\NormalTok{(}\DataTypeTok{porcentaje=}\KeywordTok{factor}\NormalTok{(}\KeywordTok{str_remove}\NormalTok{(porcentaje,}\DataTypeTok{pattern =} \StringTok{"prueba_"}\NormalTok{))) }\OperatorTok{%>%}\StringTok{ }
\StringTok{    }\KeywordTok{mutate}\NormalTok{(}\DataTypeTok{resistencia=}\KeywordTok{str_extract}\NormalTok{(archivos, }\DataTypeTok{pattern =} \StringTok{"[0-9]+.csv"}\NormalTok{)) }\OperatorTok{%>%}\StringTok{ }
\StringTok{    }\KeywordTok{mutate}\NormalTok{(}\DataTypeTok{resistencia=}\KeywordTok{factor}\NormalTok{(}\KeywordTok{str_remove}\NormalTok{(resistencia,}\DataTypeTok{pattern =} \StringTok{".csv"}\NormalTok{)), }
           \DataTypeTok{watts =}\NormalTok{ V}\OperatorTok{*}\NormalTok{A,}
           \DataTypeTok{wind_power =} \FloatTok{0.5}\OperatorTok{*}\FloatTok{1.2}\OperatorTok{*}\FloatTok{0.27}\OperatorTok{*}\FloatTok{0.45}\OperatorTok{*}\NormalTok{(}\StringTok{`}\DataTypeTok{m/s}\StringTok{`}\NormalTok{)}\OperatorTok{^}\DecValTok{3}\NormalTok{,}
           \DataTypeTok{TSR =}\NormalTok{ RPM}\OperatorTok{*}\DecValTok{2}\OperatorTok{*}\NormalTok{pi}\OperatorTok{*}\NormalTok{r}\OperatorTok{/}\DecValTok{60}\OperatorTok{/}\StringTok{`}\DataTypeTok{m/s}\StringTok{`}\NormalTok{,}
           \DataTypeTok{cp =}\NormalTok{ watts}\OperatorTok{/}\NormalTok{wind_power)}
  
 
  
\NormalTok{  df}\OperatorTok{%<>%}\StringTok{ }\KeywordTok{mutate}\NormalTok{(}\DataTypeTok{V_viento_correcion=} \KeywordTok{ifelse}\NormalTok{(df}\OperatorTok{$}\NormalTok{experimento }\OperatorTok{!=}\StringTok{ "piloto"}\NormalTok{, (df}\OperatorTok{$}\StringTok{`}\DataTypeTok{m/s}\StringTok{`}\NormalTok{)}\OperatorTok{/}\FloatTok{0.7}\NormalTok{, df}\OperatorTok{$}\StringTok{`}\DataTypeTok{m/s}\StringTok{`}\NormalTok{))}
\NormalTok{  df}\OperatorTok{%<>%}\StringTok{ }\KeywordTok{mutate}\NormalTok{(}\DataTypeTok{wind_power_correccion =} \FloatTok{0.5}\OperatorTok{*}\FloatTok{1.2}\OperatorTok{*}\FloatTok{0.27}\OperatorTok{*}\FloatTok{0.45}\OperatorTok{*}\NormalTok{(df}\OperatorTok{$}\NormalTok{V_viento_correcion)}\OperatorTok{^}\DecValTok{3}\NormalTok{,}
                \DataTypeTok{TSR_correc =}\NormalTok{ RPM}\OperatorTok{*}\DecValTok{2}\OperatorTok{*}\NormalTok{pi}\OperatorTok{*}\NormalTok{r}\OperatorTok{/}\DecValTok{60}\OperatorTok{/}\NormalTok{df}\OperatorTok{$}\NormalTok{V_viento_correcion,}
                \DataTypeTok{cp_correc =}\NormalTok{ watts}\OperatorTok{/}\NormalTok{wind_power_correccion)}
  
  
\NormalTok{  df}\OperatorTok{%<>%}\StringTok{ }\KeywordTok{mutate}\NormalTok{(}\DataTypeTok{V_viento_alfa=} \KeywordTok{ifelse}\NormalTok{(df}\OperatorTok{$}\NormalTok{experimento }\OperatorTok{!=}\StringTok{ "piloto"}\NormalTok{, ((df}\OperatorTok{$}\StringTok{`}\DataTypeTok{m/s}\StringTok{`}\NormalTok{)}\OperatorTok{/}\FloatTok{0.7}\NormalTok{)}\OperatorTok{/}\FloatTok{1.85}\NormalTok{,( df}\OperatorTok{$}\StringTok{`}\DataTypeTok{m/s}\StringTok{`}\NormalTok{)}\OperatorTok{/}\FloatTok{1.85}\NormalTok{))}
\NormalTok{  df}\OperatorTok{%<>%}\StringTok{ }\KeywordTok{mutate}\NormalTok{(}\DataTypeTok{wind_power_alfa =} \FloatTok{0.5}\OperatorTok{*}\FloatTok{1.2}\OperatorTok{*}\FloatTok{0.50}\OperatorTok{*}\FloatTok{0.45}\OperatorTok{*}\NormalTok{(df}\OperatorTok{$}\NormalTok{V_viento_alfa)}\OperatorTok{^}\DecValTok{3}\NormalTok{,}
                \DataTypeTok{TSR_alfa =}\NormalTok{ RPM}\OperatorTok{*}\DecValTok{2}\OperatorTok{*}\NormalTok{pi}\OperatorTok{*}\NormalTok{r}\OperatorTok{/}\DecValTok{60}\OperatorTok{/}\NormalTok{df}\OperatorTok{$}\NormalTok{V_viento_alfa,}\DataTypeTok{watts_alfa=}\NormalTok{watts}\OperatorTok{/}\FloatTok{1.85}\NormalTok{,}
                \DataTypeTok{cp_alfa =}\NormalTok{ watts_alfa}\OperatorTok{/}\NormalTok{wind_power_alfa)}
  
  
  

  
  \KeywordTok{return}\NormalTok{(df)}
  
\NormalTok{\}}
\NormalTok{ajuste_RPM_Resistencia_so<-}\StringTok{ }\ControlFlowTok{function}\NormalTok{(df,tabla_sinout)\{}
\NormalTok{  group_number<-}\KeywordTok{length}\NormalTok{(}\KeywordTok{attr}\NormalTok{(}\KeywordTok{group_by}\NormalTok{(df,experimento,angulo,porcentaje), }\StringTok{"group"}\NormalTok{))}
\NormalTok{  r<-}\StringTok{ }\NormalTok{(}\OperatorTok{-}\DecValTok{2}\NormalTok{)}
  
  
\NormalTok{  lista_rpm_resistencia<-}\StringTok{ }\KeywordTok{list}\NormalTok{()}
\NormalTok{  nombres_lista<-}\StringTok{ }\KeywordTok{vector}\NormalTok{()}
\NormalTok{  titulos_grafico<-}\StringTok{ }\KeywordTok{vector}\NormalTok{()}
\NormalTok{  tabladenombres<-}\StringTok{ }\KeywordTok{matrix}\NormalTok{(}\OperatorTok{-}\DecValTok{31}\NormalTok{,}\DataTypeTok{ncol =} \DecValTok{3}\NormalTok{, }\DataTypeTok{nrow =}\NormalTok{ group_number)}
  \ControlFlowTok{for}\NormalTok{ (grupos }\ControlFlowTok{in} \DecValTok{1}\OperatorTok{:}\NormalTok{group_number) \{}
\NormalTok{    grupos_rpm_resistencia<-}\StringTok{ }\NormalTok{df }\OperatorTok{%>%}\StringTok{ }\KeywordTok{group_by}\NormalTok{(.,experimento,angulo,porcentaje) }\OperatorTok{%>%}\StringTok{ }\KeywordTok{select_groups}\NormalTok{(grupos)}
    
\NormalTok{    tabla_resistencia_rpm<-}\StringTok{ }\KeywordTok{as.data.frame}\NormalTok{(}\KeywordTok{cbind}\NormalTok{(}\KeywordTok{as.numeric}\NormalTok{(grupos_rpm_resistencia}\OperatorTok{$}\NormalTok{RPM),}\KeywordTok{as.data.frame}\NormalTok{(grupos_rpm_resistencia}\OperatorTok{$}\NormalTok{resistencia)))}
    \KeywordTok{colnames}\NormalTok{(tabla_resistencia_rpm)<-}\StringTok{ }\KeywordTok{c}\NormalTok{(}\StringTok{"RPM"}\NormalTok{, }\StringTok{"Omhnios"}\NormalTok{)}
    
\NormalTok{    nombre_tabla<-}\StringTok{ }\KeywordTok{unique}\NormalTok{(}\KeywordTok{paste}\NormalTok{(grupos_rpm_resistencia}\OperatorTok{$}\NormalTok{experimento,grupos_rpm_resistencia}\OperatorTok{$}\NormalTok{angulo,grupos_rpm_resistencia}\OperatorTok{$}\NormalTok{porcentaje,}\DataTypeTok{sep =} \StringTok{"_"}\NormalTok{))}
    
    \ControlFlowTok{if}\NormalTok{(}\KeywordTok{is.na}\NormalTok{(grupos_rpm_resistencia}\OperatorTok{$}\NormalTok{angulo))\{}
\NormalTok{      titulo_graph<-}\StringTok{ }\KeywordTok{unique}\NormalTok{(}\KeywordTok{paste0}\NormalTok{(grupos_rpm_resistencia}\OperatorTok{$}\NormalTok{experimento,}\StringTok{"-"}\NormalTok{,grupos_rpm_resistencia}\OperatorTok{$}\NormalTok{porcentaje,}\StringTok{"%"}\NormalTok{))}
\NormalTok{    \}}\ControlFlowTok{else}\NormalTok{\{}
\NormalTok{      titulo_graph<-}\StringTok{ }\KeywordTok{unique}\NormalTok{(}\KeywordTok{paste0}\NormalTok{(grupos_rpm_resistencia}\OperatorTok{$}\NormalTok{experimento,}\StringTok{"-"}\NormalTok{,grupos_rpm_resistencia}\OperatorTok{$}\NormalTok{angulo,}\StringTok{"º-"}\NormalTok{,grupos_rpm_resistencia}\OperatorTok{$}\NormalTok{porcentaje,}\StringTok{"%"}\NormalTok{))}
\NormalTok{    \}}
\NormalTok{    titulos_grafico[grupos]<-}\StringTok{ }\NormalTok{titulo_graph}
\NormalTok{    lista_rpm_resistencia[[grupos]]<-}\StringTok{ }\NormalTok{tabla_resistencia_rpm}
\NormalTok{    nombres_lista[grupos]<-}\StringTok{ }\NormalTok{nombre_tabla}
\NormalTok{    tabladenombres[grupos,}\DecValTok{1}\NormalTok{]<-}\KeywordTok{as.character}\NormalTok{(grupos_rpm_resistencia}\OperatorTok{$}\NormalTok{experimento[}\DecValTok{1}\NormalTok{])}
\NormalTok{    tabladenombres[grupos,}\DecValTok{2}\NormalTok{]<-}\StringTok{ }\KeywordTok{as.character}\NormalTok{(grupos_rpm_resistencia}\OperatorTok{$}\NormalTok{angulo[}\DecValTok{1}\NormalTok{])}
\NormalTok{    tabladenombres[grupos,}\DecValTok{3}\NormalTok{]<-}\StringTok{ }\KeywordTok{as.character}\NormalTok{(grupos_rpm_resistencia}\OperatorTok{$}\NormalTok{porcentaje[}\DecValTok{1}\NormalTok{])}
\NormalTok{  \}}
  
\NormalTok{  ordenando<-}\StringTok{ }\ControlFlowTok{function}\NormalTok{(ordenando)\{}
    \KeywordTok{return}\NormalTok{(ordenando[}\KeywordTok{order}\NormalTok{(}\KeywordTok{as.numeric}\NormalTok{(}\KeywordTok{as.character}\NormalTok{(ordenando}\OperatorTok{$}\NormalTok{Omhnios))),] ) }
\NormalTok{  \}}
\NormalTok{  lista_rpm_resistencia_ordenada<-}\KeywordTok{lapply}\NormalTok{(lista_rpm_resistencia, ordenando)}
  
  
\NormalTok{  lista_coef<-}\KeywordTok{list}\NormalTok{()}
  \ControlFlowTok{for}\NormalTok{ (pruebas }\ControlFlowTok{in} \DecValTok{1}\OperatorTok{:}\KeywordTok{length}\NormalTok{(lista_rpm_resistencia_ordenada)) \{}
    \KeywordTok{dir.create}\NormalTok{(}\KeywordTok{paste0}\NormalTok{(}\KeywordTok{here}\NormalTok{(),}\StringTok{"/graficos_RPM_Resistencia_sinout/"}\NormalTok{))}
    
    \CommentTok{#jpeg(paste0(here(),"/graficos_RPM_Resistencia/",nombres_lista[pruebas],".jpeg"))}
    \KeywordTok{tiff}\NormalTok{(}\KeywordTok{paste0}\NormalTok{(}\KeywordTok{here}\NormalTok{(),}\StringTok{"/graficos_RPM_Resistencia/"}\NormalTok{,nombres_lista[pruebas],}\StringTok{".tiff"}\NormalTok{), }\DataTypeTok{width =} \DecValTok{7}\NormalTok{, }\DataTypeTok{height =}\DecValTok{7}\NormalTok{, }\DataTypeTok{units =} \StringTok{'in'}\NormalTok{, }\DataTypeTok{res =} \DecValTok{300}\NormalTok{)}
    
    
    
\NormalTok{    x<-}\KeywordTok{as.numeric}\NormalTok{(}\KeywordTok{as.character}\NormalTok{(lista_rpm_resistencia_ordenada[[pruebas]][,}\DecValTok{2}\NormalTok{]))}
\NormalTok{    x_so<-tabla_sinout[[pruebas]][,}\DecValTok{2}\NormalTok{]}
\NormalTok{    y<-}\StringTok{ }\KeywordTok{as.numeric}\NormalTok{(}\KeywordTok{as.character}\NormalTok{(lista_rpm_resistencia_ordenada[[pruebas]][,}\DecValTok{1}\NormalTok{]))}
\NormalTok{    y_so<-tabla_sinout[[pruebas]][,}\DecValTok{1}\NormalTok{]}
    
    \CommentTok{#dat<-as.data.frame(cbind(tabla_sinout[[pruebas]][,2],tabla_sinout[[pruebas]][,1]))}
    \CommentTok{#names(dat)<- c("x","y")}
    \CommentTok{#f <- function(x,a,b) \{a * exp(b * x)\}}
    \CommentTok{#fm0 <- nls(log(y) ~ log(f(x, a, b)),dat, start = c(a = 1, b = 1))}
    
    \CommentTok{#nls(y_so ~ f(x_so, a, b), start = coef(fm0))}
    
    
\NormalTok{    m<-}\KeywordTok{nls}\NormalTok{(y}\OperatorTok{~}\NormalTok{a}\OperatorTok{*}\NormalTok{x}\OperatorTok{/}\NormalTok{(b}\OperatorTok{+}\NormalTok{x))}
\NormalTok{    m_so_}\DecValTok{1}\NormalTok{<-}\ControlFlowTok{function}\NormalTok{(y_so,x_so)\{}
      \KeywordTok{return}\NormalTok{(}\KeywordTok{nls}\NormalTok{(y_so}\OperatorTok{~}\NormalTok{a}\OperatorTok{*}\NormalTok{x_so}\OperatorTok{/}\NormalTok{(b}\OperatorTok{+}\NormalTok{x_so)))}
\NormalTok{    \}}
\NormalTok{    m_so_}\DecValTok{2}\NormalTok{<-}\ControlFlowTok{function}\NormalTok{(y_so,x_so)\{}
      \KeywordTok{return}\NormalTok{(}\KeywordTok{nlsLM}\NormalTok{(y_so}\OperatorTok{~}\NormalTok{a}\OperatorTok{*}\NormalTok{x_so}\OperatorTok{/}\NormalTok{(b}\OperatorTok{+}\NormalTok{x_so)))}
\NormalTok{    \}}
\NormalTok{    m_so<-}\KeywordTok{tryCatch}\NormalTok{(}\KeywordTok{m_so_1}\NormalTok{(y_so,x_so), }\DataTypeTok{error=}\ControlFlowTok{function}\NormalTok{(e) }\KeywordTok{m_so_2}\NormalTok{(y_so,x_so))}
    
    
    
    
\NormalTok{    coefa_so<-}\KeywordTok{coef}\NormalTok{(m_so)[}\DecValTok{1}\NormalTok{]}
\NormalTok{    coefb_so<-}\StringTok{ }\KeywordTok{coef}\NormalTok{(m_so)[}\DecValTok{2}\NormalTok{]}
\NormalTok{    x_so_seq<-}\StringTok{ }\KeywordTok{seq}\NormalTok{(}\DecValTok{0}\NormalTok{,}\DecValTok{8000}\NormalTok{,}\DataTypeTok{by=}\DecValTok{1}\NormalTok{)}
\NormalTok{    y_so_seq<-}\StringTok{ }\NormalTok{coefa_so}\OperatorTok{*}\NormalTok{x_so_seq}\OperatorTok{/}\NormalTok{(coefb_so}\OperatorTok{+}\NormalTok{x_so_seq)}
    
\NormalTok{    coefa <-}\KeywordTok{coef}\NormalTok{(m)[}\DecValTok{1}\NormalTok{]}
\NormalTok{    coefb <-}\StringTok{ }\KeywordTok{coef}\NormalTok{(m)[}\DecValTok{2}\NormalTok{]}
\NormalTok{    x_seq<-}\StringTok{ }\KeywordTok{seq}\NormalTok{(}\DecValTok{0}\NormalTok{,}\DecValTok{8000}\NormalTok{,}\DataTypeTok{by=}\DecValTok{1}\NormalTok{)}
\NormalTok{    y_seq<-}\StringTok{ }\NormalTok{coefa}\OperatorTok{*}\NormalTok{x_seq}\OperatorTok{/}\NormalTok{(coefb}\OperatorTok{+}\NormalTok{x_seq)}
    
    
    
    
    
    \KeywordTok{plot}\NormalTok{(}\OtherTok{NULL}\NormalTok{,}\DataTypeTok{xlim=}\KeywordTok{c}\NormalTok{(}\DecValTok{0}\NormalTok{,}\DecValTok{8000}\NormalTok{),}
         \DataTypeTok{ylim =} \KeywordTok{c}\NormalTok{(}\DecValTok{0}\NormalTok{,(}\KeywordTok{max}\NormalTok{(y_so_seq)}\OperatorTok{+}\NormalTok{(}\KeywordTok{max}\NormalTok{(y_so_seq))}\OperatorTok{/}\DecValTok{5}\NormalTok{)),}\DataTypeTok{cex=}\FloatTok{0.005}\NormalTok{, }\DataTypeTok{yaxt =}\StringTok{"n"}\NormalTok{,}
         \DataTypeTok{xlab =}  \KeywordTok{expression}\NormalTok{(}\KeywordTok{paste}\NormalTok{(}\StringTok{"Resistencia ("}\NormalTok{,Omega,}\StringTok{")"}\NormalTok{)), }\DataTypeTok{ylab =} \StringTok{"Velocidad Angular (RPM)"}\NormalTok{, }\DataTypeTok{bty=}\StringTok{'L'}\NormalTok{)}
    \KeywordTok{par}\NormalTok{(}\DataTypeTok{new=}\NormalTok{T)}
    \CommentTok{#lines(x,predict(m),lty=2,col="red",lwd=1)}
    \KeywordTok{lines}\NormalTok{(x_seq,y_seq,}\DataTypeTok{lty=}\DecValTok{2}\NormalTok{, }\DataTypeTok{col=}\StringTok{"red"}\NormalTok{,}\DataTypeTok{lwd=}\DecValTok{1}\NormalTok{)}
    \KeywordTok{par}\NormalTok{(}\DataTypeTok{new=}\NormalTok{T)}
    \CommentTok{#lines(x_so,predict(m_so),lty=2,col="blue",lwd=1)}
    \KeywordTok{lines}\NormalTok{(x_so_seq,y_so_seq,}\DataTypeTok{lty=}\DecValTok{2}\NormalTok{,}\DataTypeTok{col=}\StringTok{"blue"}\NormalTok{,}\DataTypeTok{lwd=}\DecValTok{1}\NormalTok{)}
    
    \KeywordTok{points}\NormalTok{(x_so,y_so, }\DataTypeTok{pch=} \DecValTok{4}\NormalTok{, }\DataTypeTok{col=}\StringTok{"blue"}\NormalTok{)}
    
    
    
\NormalTok{    x_dif<-}\KeywordTok{length}\NormalTok{(}\KeywordTok{setdiff}\NormalTok{(x, x_so))}
\NormalTok{    y_dif<-}\KeywordTok{length}\NormalTok{(}\KeywordTok{setdiff}\NormalTok{(}\KeywordTok{round}\NormalTok{(y,r),}\KeywordTok{round}\NormalTok{(y_so,r)))}
    
    
    \ControlFlowTok{while}\NormalTok{(x_dif }\OperatorTok{!=}\StringTok{ }\NormalTok{y_dif)\{}
\NormalTok{      y_dif<-}\KeywordTok{length}\NormalTok{(}\KeywordTok{setdiff}\NormalTok{(}\KeywordTok{round}\NormalTok{(y,r),}\KeywordTok{round}\NormalTok{(y_so,r)))}
\NormalTok{      r<-r}\OperatorTok{+}\DecValTok{1}\NormalTok{\}}
    
    
    \ControlFlowTok{if}\NormalTok{(x_dif}\OperatorTok{==}\NormalTok{y_dif)\{}
      \KeywordTok{points}\NormalTok{(}\KeywordTok{setdiff}\NormalTok{(x, x_so),}\KeywordTok{setdiff}\NormalTok{(}\KeywordTok{round}\NormalTok{(y,r),}\KeywordTok{round}\NormalTok{(y_so,r)), }\DataTypeTok{pch=}\DecValTok{20}\NormalTok{, }\DataTypeTok{col=}\StringTok{"red"}\NormalTok{, }\DataTypeTok{cex=}\FloatTok{1.5}\NormalTok{)}
      
\NormalTok{    \}}
    
    
    
    
    
    
\NormalTok{    subtitle_nom<-}\StringTok{ }\KeywordTok{paste0}\NormalTok{(}\StringTok{"Experimento = "}\NormalTok{,titulos_grafico[pruebas])}
\NormalTok{    maintitle<-}\StringTok{ }\KeywordTok{paste0}\NormalTok{(}\StringTok{"Gráfica Velocidad Angular-Resistencia }\CharTok{\textbackslash{}n}\StringTok{"}\NormalTok{,subtitle_nom)}
    \KeywordTok{par}\NormalTok{(}\DataTypeTok{new=}\NormalTok{T)}
    \KeywordTok{axis}\NormalTok{(}\DecValTok{2}\NormalTok{, }\DataTypeTok{at=}\KeywordTok{seq}\NormalTok{(}\DecValTok{0}\NormalTok{,(}\KeywordTok{max}\NormalTok{(y_so_seq)}\OperatorTok{+}\NormalTok{(}\KeywordTok{max}\NormalTok{(y_so_seq))}\OperatorTok{/}\DecValTok{5}\NormalTok{), }\DataTypeTok{by=}\KeywordTok{round}\NormalTok{((}\KeywordTok{max}\NormalTok{(y_so_seq)}\OperatorTok{+}\NormalTok{(}\KeywordTok{max}\NormalTok{(y_so_seq))}\OperatorTok{/}\DecValTok{5}\NormalTok{)}\OperatorTok{/}\DecValTok{10}\NormalTok{,}\OperatorTok{-}\DecValTok{1}\NormalTok{)),}\DataTypeTok{las=}\DecValTok{2}\NormalTok{)}
    \KeywordTok{title}\NormalTok{(}\DataTypeTok{main =}\NormalTok{ maintitle)}
    
\NormalTok{    R_sinVA<-}\StringTok{ }\KeywordTok{paste0}\NormalTok{(}\StringTok{"Regresión sin VA"}\NormalTok{,}\StringTok{" (Correlación= "}\NormalTok{,}\KeywordTok{as.character}\NormalTok{(}\KeywordTok{round}\NormalTok{(}\KeywordTok{cor}\NormalTok{(y_so,}\KeywordTok{predict}\NormalTok{(m_so)),}\DecValTok{3}\NormalTok{)),}\StringTok{")"}\NormalTok{)}
\NormalTok{    R_conVA<-}\StringTok{ }\KeywordTok{paste0}\NormalTok{(}\StringTok{"Regresión con VA"}\NormalTok{,}\StringTok{" (Correlación= "}\NormalTok{,}\KeywordTok{as.character}\NormalTok{(}\KeywordTok{round}\NormalTok{(}\KeywordTok{cor}\NormalTok{(y,}\KeywordTok{predict}\NormalTok{(m)),}\DecValTok{3}\NormalTok{)),}\StringTok{")"}\NormalTok{)}
    
    
    \KeywordTok{legend}\NormalTok{(}\StringTok{"right"}\NormalTok{, }\DataTypeTok{inset=}\KeywordTok{c}\NormalTok{(}\DecValTok{0}\NormalTok{,}\DecValTok{0}\NormalTok{),}
           \DataTypeTok{legend =} \KeywordTok{c}\NormalTok{(R_sinVA,R_conVA,}\StringTok{"Valores comunes"}\NormalTok{, }\StringTok{"Valores atípicos "}\NormalTok{),}
           \DataTypeTok{pch =} \KeywordTok{c}\NormalTok{(}\OtherTok{NA}\NormalTok{,}\OtherTok{NA}\NormalTok{, }\DecValTok{4}\NormalTok{,}\DecValTok{20}\NormalTok{),}
           \DataTypeTok{lty =} \KeywordTok{c}\NormalTok{(}\DecValTok{2}\NormalTok{,}\DecValTok{2}\NormalTok{,}\OtherTok{NA}\NormalTok{,}\OtherTok{NA}\NormalTok{), }
           \DataTypeTok{col =} \KeywordTok{c}\NormalTok{(}\StringTok{"blue"}\NormalTok{,}\StringTok{"red"}\NormalTok{,}\StringTok{"black"}\NormalTok{,}\StringTok{"red"}\NormalTok{),}\DataTypeTok{ncol =} \DecValTok{1}\NormalTok{,}\DataTypeTok{cex =} \DecValTok{1}\NormalTok{)}
    
    \KeywordTok{dev.off}\NormalTok{()}
    
\NormalTok{    correlacion_sino<-}\KeywordTok{cor}\NormalTok{(y_so,}\KeywordTok{predict}\NormalTok{(m_so))}
\NormalTok{    correlacion_cono<-}\KeywordTok{cor}\NormalTok{(y,}\KeywordTok{predict}\NormalTok{(m))}
    \ControlFlowTok{if}\NormalTok{(correlacion_sino}\OperatorTok{>=}\StringTok{ }\NormalTok{correlacion_cono)\{}
\NormalTok{      aa<-}\StringTok{ }\NormalTok{coefa_so}
\NormalTok{      bb<-}\StringTok{ }\NormalTok{coefb_so}
\NormalTok{    \}}\ControlFlowTok{else}\NormalTok{\{}
\NormalTok{      aa<-}\StringTok{ }\NormalTok{coefa}
\NormalTok{      bb<-coefb}
\NormalTok{    \}}
    
\NormalTok{    coef_tabla<-}\StringTok{ }\KeywordTok{cbind}\NormalTok{(}\KeywordTok{as.character}\NormalTok{(tabladenombres[pruebas,}\DecValTok{1}\NormalTok{]),}\KeywordTok{as.character}\NormalTok{(tabladenombres[pruebas,}\DecValTok{2}\NormalTok{]),}
                       \KeywordTok{as.character}\NormalTok{(tabladenombres[pruebas,}\DecValTok{3}\NormalTok{]),aa,bb)  }
    \KeywordTok{names}\NormalTok{(coef_tabla)<-}\KeywordTok{c}\NormalTok{(}\StringTok{"Experimento"}\NormalTok{,}\StringTok{"Angulo"}\NormalTok{,}\StringTok{"Porcentaje"}\NormalTok{,}\StringTok{"a"}\NormalTok{,}\StringTok{"b"}\NormalTok{)}
    
\NormalTok{    lista_coef[[pruebas]]<-coef_tabla}
    
\NormalTok{  \}}
  
  \KeywordTok{return}\NormalTok{(lista_coef) }
  
\NormalTok{\}}
\NormalTok{add_coef<-}\ControlFlowTok{function}\NormalTok{(df,coeficientes_RPM)\{}
\NormalTok{  df }\OperatorTok{%<>%}\StringTok{ }\KeywordTok{mutate}\NormalTok{(}\DataTypeTok{coef_a=} \OperatorTok{-}\DecValTok{31}\NormalTok{,}\DataTypeTok{coef_b=}\OperatorTok{-}\DecValTok{31}\NormalTok{)}
\NormalTok{  vector_logico<-}\StringTok{ }\KeywordTok{list}\NormalTok{()}
  \ControlFlowTok{for}\NormalTok{ (i }\ControlFlowTok{in} \DecValTok{1}\OperatorTok{:}\KeywordTok{length}\NormalTok{(coeficientes_RPM[,}\DecValTok{1}\NormalTok{])) \{}
    \ControlFlowTok{if}\NormalTok{(coeficientes_RPM[i,}\DecValTok{1}\NormalTok{]}\OperatorTok{==}\StringTok{"concentrador"}\NormalTok{)\{}
\NormalTok{      vector_logico[[i]]<-}\StringTok{ }\KeywordTok{c}\NormalTok{(coeficientes_RPM[i,}\DecValTok{1}\NormalTok{]}\OperatorTok{==}\NormalTok{df}\OperatorTok{$}\NormalTok{experimento }\OperatorTok{&}\StringTok{ }\NormalTok{coeficientes_RPM[i,}\DecValTok{2}\NormalTok{]}\OperatorTok{==}\NormalTok{df}\OperatorTok{$}\NormalTok{angulo }\OperatorTok{&}\StringTok{ }\NormalTok{coeficientes_RPM[i,}\DecValTok{3}\NormalTok{]}\OperatorTok{==}\NormalTok{df}\OperatorTok{$}\NormalTok{porcentaje)}
      
\NormalTok{    \}}\ControlFlowTok{else}\NormalTok{\{}
\NormalTok{      vector_logico[[i]]<-}\StringTok{ }\KeywordTok{c}\NormalTok{(coeficientes_RPM[i,}\DecValTok{1}\NormalTok{]}\OperatorTok{==}\NormalTok{df}\OperatorTok{$}\NormalTok{experimento }\OperatorTok{&}\StringTok{ }\NormalTok{coeficientes_RPM[i,}\DecValTok{3}\NormalTok{]}\OperatorTok{==}\NormalTok{df}\OperatorTok{$}\NormalTok{porcentaje)}
      
\NormalTok{    \}}
\NormalTok{  \}}
  \ControlFlowTok{for}\NormalTok{ (j }\ControlFlowTok{in} \DecValTok{1}\OperatorTok{:}\KeywordTok{length}\NormalTok{(vector_logico)) \{}
\NormalTok{    df }\OperatorTok{%<>%}\StringTok{ }\KeywordTok{mutate}\NormalTok{(}\DataTypeTok{coef_a=}\KeywordTok{replace}\NormalTok{(coef_a, vector_logico[[j]],}\KeywordTok{as.numeric}\NormalTok{(}\KeywordTok{as.character}\NormalTok{( coeficientes_RPM[j,}\DecValTok{4}\NormalTok{]))),}
                   \DataTypeTok{coef_b=}\KeywordTok{replace}\NormalTok{(coef_b, vector_logico[[j]],}\KeywordTok{as.numeric}\NormalTok{(}\KeywordTok{as.character}\NormalTok{( coeficientes_RPM[j,}\DecValTok{5}\NormalTok{]))))}
\NormalTok{  \}}
  
\NormalTok{  df }\OperatorTok{%<>%}\StringTok{ }\KeywordTok{mutate}\NormalTok{(}\DataTypeTok{RPM_regresion=}\NormalTok{ (}\KeywordTok{as.numeric}\NormalTok{(}\KeywordTok{as.character}\NormalTok{(coef_a)) }\OperatorTok{*}\KeywordTok{as.numeric}\NormalTok{(}\KeywordTok{as.character}\NormalTok{(resistencia)))}\OperatorTok{/}\NormalTok{(}\KeywordTok{as.numeric}\NormalTok{(}\KeywordTok{as.character}\NormalTok{(coef_b))}\OperatorTok{+}\KeywordTok{as.numeric}\NormalTok{(}\KeywordTok{as.character}\NormalTok{(resistencia))))}
\NormalTok{  df }\OperatorTok{%<>%}\StringTok{ }\KeywordTok{mutate}\NormalTok{(}\DataTypeTok{diff_rpm=}\NormalTok{RPM}\OperatorTok{-}\NormalTok{RPM_regresion, }\DataTypeTok{TSR_regresion_est =}\NormalTok{ RPM_regresion}\OperatorTok{*}\DecValTok{2}\OperatorTok{*}\NormalTok{pi}\OperatorTok{*}\NormalTok{r}\OperatorTok{/}\DecValTok{60}\OperatorTok{/}\NormalTok{Vviento_estandar,}\DataTypeTok{TSR_regresion_lectura =}\NormalTok{ RPM_regresion}\OperatorTok{*}\DecValTok{2}\OperatorTok{*}\NormalTok{pi}\OperatorTok{*}\NormalTok{r}\OperatorTok{/}\DecValTok{60}\OperatorTok{/}\StringTok{`}\DataTypeTok{m/s}\StringTok{`}\NormalTok{)}
\NormalTok{  df }\OperatorTok{%<>%}\StringTok{ }\KeywordTok{mutate}\NormalTok{(}\DataTypeTok{TSR_regresion_corr =}\NormalTok{ RPM_regresion}\OperatorTok{*}\DecValTok{2}\OperatorTok{*}\NormalTok{pi}\OperatorTok{*}\NormalTok{r}\OperatorTok{/}\DecValTok{60}\OperatorTok{/}\NormalTok{V_viento_correcion)}
  
  
\NormalTok{\}}
\NormalTok{grafica_Potencia_V<-}\ControlFlowTok{function}\NormalTok{(df,xlimite,ylimite,V)\{}
\NormalTok{  select_groups <-}\StringTok{ }\ControlFlowTok{function}\NormalTok{(data, groups) \{}
\NormalTok{    data[}\KeywordTok{sort}\NormalTok{(}\KeywordTok{unlist}\NormalTok{(}\KeywordTok{attr}\NormalTok{(data, }\StringTok{"indices"}\NormalTok{)[ groups ])) }\OperatorTok{+}\StringTok{ }\DecValTok{1}\NormalTok{, ]}
\NormalTok{  \}}
  
\NormalTok{  group_number<-}\KeywordTok{length}\NormalTok{(}\KeywordTok{attr}\NormalTok{(}\KeywordTok{group_by}\NormalTok{(df,experimento,angulo), }\StringTok{"group"}\NormalTok{))}
\NormalTok{  lista_watts_Vviento<-}\StringTok{ }\KeywordTok{list}\NormalTok{()}
\NormalTok{  nombres_expr<-}\KeywordTok{vector}\NormalTok{()}
  \ControlFlowTok{for}\NormalTok{ (groups_ind }\ControlFlowTok{in} \DecValTok{1}\OperatorTok{:}\NormalTok{group_number) \{}
    
\NormalTok{    xx<-}\StringTok{ }\NormalTok{df }\OperatorTok{%>%}\StringTok{ }\KeywordTok{group_by}\NormalTok{(.,experimento,angulo) }\OperatorTok{%>%}\StringTok{ }\KeywordTok{select_groups}\NormalTok{(groups_ind)}
\NormalTok{    nombre_}\DecValTok{1}\NormalTok{<-}\KeywordTok{as.character}\NormalTok{(xx}\OperatorTok{$}\NormalTok{experimento[}\DecValTok{1}\NormalTok{])}
\NormalTok{    nombre_}\DecValTok{2}\NormalTok{<-}\KeywordTok{as.character}\NormalTok{(xx}\OperatorTok{$}\NormalTok{angulo[}\DecValTok{1}\NormalTok{])}
\NormalTok{    nombre<-}\KeywordTok{paste}\NormalTok{(nombre_}\DecValTok{1}\NormalTok{,nombre_}\DecValTok{2}\NormalTok{,}\DataTypeTok{sep =} \StringTok{"_"}\NormalTok{)}
    
    
\NormalTok{    percentaje_number<-}\KeywordTok{length}\NormalTok{(}\KeywordTok{attr}\NormalTok{(}\KeywordTok{group_by}\NormalTok{(xx,porcentaje), }\StringTok{"group"}\NormalTok{) )}
\NormalTok{    xx_percentaje<-}\KeywordTok{list}\NormalTok{()}
    \ControlFlowTok{for}\NormalTok{ (per }\ControlFlowTok{in} \DecValTok{1}\OperatorTok{:}\NormalTok{percentaje_number) \{}
\NormalTok{      xx_perc<-}\StringTok{ }\NormalTok{xx }\OperatorTok{%>%}\StringTok{ }\KeywordTok{group_by}\NormalTok{(.,porcentaje) }\OperatorTok{%>%}\StringTok{ }\KeywordTok{select_groups}\NormalTok{(per)}
\NormalTok{      V_select<-}\StringTok{ }\KeywordTok{as.name}\NormalTok{(}\KeywordTok{paste0}\NormalTok{(}\StringTok{"xx_perc$"}\NormalTok{,V))}
      
      \ControlFlowTok{if}\NormalTok{(V}\OperatorTok{==}\DecValTok{1}\NormalTok{)\{}
\NormalTok{        xx_perc<-}\KeywordTok{cbind}\NormalTok{(xx_perc}\OperatorTok{$}\NormalTok{cp_est,xx_perc}\OperatorTok{$}\NormalTok{watts,xx_perc}\OperatorTok{$}\NormalTok{V_viento_correcion)}
\NormalTok{      \}}\ControlFlowTok{else}\NormalTok{\{}
\NormalTok{        xx_perc<-}\KeywordTok{cbind}\NormalTok{(xx_perc}\OperatorTok{$}\NormalTok{cp_est,xx_perc}\OperatorTok{$}\NormalTok{watts,xx_perc}\OperatorTok{$}\NormalTok{Vviento_estandar)}
\NormalTok{      \}}
      \KeywordTok{colnames}\NormalTok{(xx_perc)<-}\StringTok{ }\KeywordTok{c}\NormalTok{(}\StringTok{"cp"}\NormalTok{,}\StringTok{"watts"}\NormalTok{, }\StringTok{"Vviento"}\NormalTok{)}
\NormalTok{      xx_percentaje[[per]]<-}\StringTok{ }\NormalTok{xx_perc}
      
\NormalTok{    \}}
\NormalTok{    lista_watts_Vviento[[groups_ind]]<-}\StringTok{ }\NormalTok{xx_percentaje}
\NormalTok{    nombres_expr[groups_ind]<-}\StringTok{ }\NormalTok{nombre}
\NormalTok{  \}}
  
  \KeywordTok{names}\NormalTok{(lista_watts_Vviento)<-}\StringTok{ }\NormalTok{nombres_expr}
  
\NormalTok{  lista_watts_Vviento_max<-}\KeywordTok{list}\NormalTok{()}
  \ControlFlowTok{for}\NormalTok{ (i }\ControlFlowTok{in} \DecValTok{1}\OperatorTok{:}\KeywordTok{length}\NormalTok{(lista_watts_Vviento)) \{}
    
\NormalTok{    df_watts_Vviento<-}\StringTok{ }\KeywordTok{data.frame}\NormalTok{(}\KeywordTok{matrix}\NormalTok{(}\KeywordTok{unlist}\NormalTok{(}\KeywordTok{lapply}\NormalTok{(lista_watts_Vviento[[i]],}
                                                       \ControlFlowTok{function}\NormalTok{(x) x[}\KeywordTok{which.max}\NormalTok{(x[,}\DecValTok{1}\NormalTok{]),}\DecValTok{2}\OperatorTok{:}\DecValTok{3}\NormalTok{])),}
                                         \DataTypeTok{nrow=}\DecValTok{6}\NormalTok{, }\DataTypeTok{byrow=}\NormalTok{T))}
    \KeywordTok{names}\NormalTok{(df_watts_Vviento)<-}\StringTok{ }\KeywordTok{c}\NormalTok{(}\StringTok{"Watss"}\NormalTok{,}\StringTok{"Vviento"}\NormalTok{)}
\NormalTok{    lista_watts_Vviento_max[[i]]<-}\StringTok{ }\NormalTok{df_watts_Vviento}
\NormalTok{  \}}
  \KeywordTok{names}\NormalTok{(lista_watts_Vviento_max)<-}\StringTok{ }\NormalTok{nombres_expr}
  
  \KeywordTok{dir.create}\NormalTok{(}\KeywordTok{paste0}\NormalTok{(}\KeywordTok{here}\NormalTok{(),}\StringTok{"/graficos_Potencia_V/"}\NormalTok{))}
  
  \CommentTok{#jpeg(paste0(here(),"/graficos_Potencia_V/grafica_Potencia_V.jpeg"))}
  \KeywordTok{tiff}\NormalTok{(}\KeywordTok{paste0}\NormalTok{(}\KeywordTok{here}\NormalTok{(),}\StringTok{"/graficos_Potencia_V/grafica_Potencia_V.tiff"}\NormalTok{), }\DataTypeTok{width =} \DecValTok{7}\NormalTok{, }\DataTypeTok{height =}\DecValTok{7}\NormalTok{, }\DataTypeTok{units =} \StringTok{'in'}\NormalTok{, }\DataTypeTok{res =} \DecValTok{300}\NormalTok{)}
  
  
\NormalTok{  colores<-}\StringTok{ }\KeywordTok{c}\NormalTok{(}\StringTok{"orange"}\NormalTok{,}\StringTok{"red"}\NormalTok{,}\StringTok{"blue"}\NormalTok{,}\StringTok{"dodgerblue4"}\NormalTok{,}\StringTok{"purple"}\NormalTok{,}\StringTok{"black"}\NormalTok{)}
\NormalTok{  pch_dif<-}\KeywordTok{c}\NormalTok{(}\DecValTok{0}\OperatorTok{:}\DecValTok{5}\NormalTok{)}
\NormalTok{  correlacion<-}\StringTok{ }\KeywordTok{vector}\NormalTok{()}
\NormalTok{  lista_coef<-}\KeywordTok{list}\NormalTok{()}
  \ControlFlowTok{for}\NormalTok{(i }\ControlFlowTok{in} \DecValTok{1}\OperatorTok{:}\KeywordTok{length}\NormalTok{(lista_watts_Vviento_max))\{}
    \CommentTok{#en caso de que sea mejor añadir el origen}
    \CommentTok{#x<- c(0,lambda_Cp[[i]][,2])}
    \CommentTok{#y<- c(0,lambda_Cp[[i]][,1])}
\NormalTok{    x<-}\StringTok{ }\NormalTok{lista_watts_Vviento_max[[i]][,}\DecValTok{2}\NormalTok{]}
\NormalTok{    y<-}\StringTok{ }\NormalTok{lista_watts_Vviento_max[[i]][,}\DecValTok{1}\NormalTok{]}
\NormalTok{    fit_curva<-}\KeywordTok{nls}\NormalTok{(y}\OperatorTok{~}\NormalTok{b}\OperatorTok{+}\NormalTok{a}\OperatorTok{*}\NormalTok{x}\OperatorTok{^}\DecValTok{3}\NormalTok{,}\DataTypeTok{start =} \KeywordTok{list}\NormalTok{(}\DataTypeTok{a=}\DecValTok{0}\NormalTok{, }\DataTypeTok{b=}\DecValTok{0}\NormalTok{))}
\NormalTok{    xx <-}\StringTok{ }\KeywordTok{seq}\NormalTok{(}\KeywordTok{min}\NormalTok{(x),xlimite[}\DecValTok{2}\NormalTok{], }\DataTypeTok{by=}\FloatTok{0.1}\NormalTok{)}
    
    \KeywordTok{plot}\NormalTok{(}\OtherTok{NULL}\NormalTok{,}\DataTypeTok{xlim=}\NormalTok{xlimite,}
         \DataTypeTok{ylim =}\NormalTok{ ylimite,}\DataTypeTok{cex=}\FloatTok{0.005}\NormalTok{, }\DataTypeTok{yaxt =}\StringTok{"n"}\NormalTok{,}
         \DataTypeTok{xlab =} \StringTok{"Velocidad del viento (m/s)"}\NormalTok{, }\DataTypeTok{ylab =} \StringTok{"Potencia (W)"}\NormalTok{, }\DataTypeTok{bty=}\StringTok{'L'}\NormalTok{)}
    \KeywordTok{title}\NormalTok{(}\DataTypeTok{main=} \StringTok{"Curvas de potencia"}\NormalTok{)}
    \KeywordTok{par}\NormalTok{(}\DataTypeTok{new=}\NormalTok{T)}
    \KeywordTok{lines}\NormalTok{(xx, }\KeywordTok{predict}\NormalTok{(fit_curva, }\KeywordTok{data.frame}\NormalTok{(}\DataTypeTok{x=}\NormalTok{xx)), }\DataTypeTok{col=}\NormalTok{colores[i],}\DataTypeTok{lwd=}\DecValTok{1}\NormalTok{,}\DataTypeTok{lty=}\DecValTok{2}\NormalTok{)}
    \KeywordTok{points}\NormalTok{(x,y, }\DataTypeTok{pch=}\NormalTok{ pch_dif[i])}
    \KeywordTok{par}\NormalTok{(}\DataTypeTok{new=}\NormalTok{T)}
\NormalTok{    correlacion[i]<-}\StringTok{ }\KeywordTok{cor}\NormalTok{(y,}\KeywordTok{predict}\NormalTok{(fit_curva))}
\NormalTok{    lista_coef[[i]]<-}\StringTok{ }\KeywordTok{coef}\NormalTok{(fit_curva)}
\NormalTok{  \}}
  
  \KeywordTok{axis}\NormalTok{(}\DecValTok{2}\NormalTok{, }\DataTypeTok{at=}\KeywordTok{seq}\NormalTok{(}\DecValTok{0}\NormalTok{,ylimite[}\DecValTok{2}\NormalTok{], }\DataTypeTok{by=}\KeywordTok{round}\NormalTok{(ylimite[}\DecValTok{2}\NormalTok{]}\OperatorTok{/}\DecValTok{7}\NormalTok{,}\DecValTok{0}\NormalTok{)),}\DataTypeTok{las=}\DecValTok{2}\NormalTok{)}
  
\NormalTok{  titulos_graficos<-}\ControlFlowTok{function}\NormalTok{(df)\{}
\NormalTok{    group_number<-}\KeywordTok{length}\NormalTok{(}\KeywordTok{attr}\NormalTok{(}\KeywordTok{group_by}\NormalTok{(df,experimento,angulo,porcentaje), }\StringTok{"group"}\NormalTok{))}
\NormalTok{    lista_rpm_resistencia<-}\StringTok{ }\KeywordTok{list}\NormalTok{()}
\NormalTok{    nombres_lista<-}\StringTok{ }\KeywordTok{vector}\NormalTok{()}
\NormalTok{    titulos_grafico<-}\StringTok{ }\KeywordTok{vector}\NormalTok{()}
\NormalTok{    tabladenombres<-}\StringTok{ }\KeywordTok{matrix}\NormalTok{(}\OperatorTok{-}\DecValTok{31}\NormalTok{,}\DataTypeTok{ncol =} \DecValTok{3}\NormalTok{, }\DataTypeTok{nrow =}\NormalTok{ group_number)}
    \ControlFlowTok{for}\NormalTok{ (grupos }\ControlFlowTok{in} \DecValTok{1}\OperatorTok{:}\NormalTok{group_number) \{}
\NormalTok{      grupos_rpm_resistencia<-}\StringTok{ }\NormalTok{df }\OperatorTok{%>%}\StringTok{ }\KeywordTok{group_by}\NormalTok{(.,experimento,angulo,porcentaje) }\OperatorTok{%>%}\StringTok{ }\KeywordTok{select_groups}\NormalTok{(grupos)}
      
\NormalTok{      tabla_resistencia_rpm<-}\StringTok{ }\KeywordTok{as.data.frame}\NormalTok{(}\KeywordTok{cbind}\NormalTok{(}\KeywordTok{as.numeric}\NormalTok{(grupos_rpm_resistencia}\OperatorTok{$}\NormalTok{RPM),}\KeywordTok{as.data.frame}\NormalTok{(grupos_rpm_resistencia}\OperatorTok{$}\NormalTok{resistencia)))}
      \KeywordTok{colnames}\NormalTok{(tabla_resistencia_rpm)<-}\StringTok{ }\KeywordTok{c}\NormalTok{(}\StringTok{"RPM"}\NormalTok{, }\StringTok{"Omhnios"}\NormalTok{)}
      
\NormalTok{      nombre_tabla<-}\StringTok{ }\KeywordTok{unique}\NormalTok{(}\KeywordTok{paste}\NormalTok{(grupos_rpm_resistencia}\OperatorTok{$}\NormalTok{experimento,grupos_rpm_resistencia}\OperatorTok{$}\NormalTok{angulo,grupos_rpm_resistencia}\OperatorTok{$}\NormalTok{porcentaje,}\DataTypeTok{sep =} \StringTok{"_"}\NormalTok{))}
      
      \ControlFlowTok{if}\NormalTok{(}\KeywordTok{is.na}\NormalTok{(grupos_rpm_resistencia}\OperatorTok{$}\NormalTok{angulo))\{}
\NormalTok{        titulo_graph<-}\StringTok{ }\KeywordTok{unique}\NormalTok{(}\KeywordTok{paste0}\NormalTok{(grupos_rpm_resistencia}\OperatorTok{$}\NormalTok{experimento))}
\NormalTok{      \}}\ControlFlowTok{else}\NormalTok{\{}
\NormalTok{        titulo_graph<-}\StringTok{ }\KeywordTok{unique}\NormalTok{(}\KeywordTok{paste0}\NormalTok{(grupos_rpm_resistencia}\OperatorTok{$}\NormalTok{experimento,}\StringTok{"-"}\NormalTok{,grupos_rpm_resistencia}\OperatorTok{$}\NormalTok{angulo,}\StringTok{"º"}\NormalTok{))}
\NormalTok{      \}}
\NormalTok{      titulos_grafico[grupos]<-}\StringTok{ }\NormalTok{titulo_graph}
\NormalTok{      lista_rpm_resistencia[[grupos]]<-}\StringTok{ }\NormalTok{tabla_resistencia_rpm}
\NormalTok{      nombres_lista[grupos]<-}\StringTok{ }\NormalTok{nombre_tabla}
\NormalTok{      tabladenombres[grupos,}\DecValTok{1}\NormalTok{]<-}\KeywordTok{as.character}\NormalTok{(grupos_rpm_resistencia}\OperatorTok{$}\NormalTok{experimento[}\DecValTok{1}\NormalTok{])}
\NormalTok{      tabladenombres[grupos,}\DecValTok{2}\NormalTok{]<-}\StringTok{ }\KeywordTok{as.character}\NormalTok{(grupos_rpm_resistencia}\OperatorTok{$}\NormalTok{angulo[}\DecValTok{1}\NormalTok{])}
\NormalTok{      tabladenombres[grupos,}\DecValTok{3}\NormalTok{]<-}\StringTok{ }\KeywordTok{as.character}\NormalTok{(grupos_rpm_resistencia}\OperatorTok{$}\NormalTok{porcentaje[}\DecValTok{1}\NormalTok{])}
\NormalTok{    \}}
    \KeywordTok{return}\NormalTok{(}\KeywordTok{unique}\NormalTok{(titulos_grafico))}
    
\NormalTok{  \}}
\NormalTok{  nombres_df<-}\StringTok{ }\KeywordTok{titulos_graficos}\NormalTok{(df)}
  
  
\NormalTok{  leyenda<-}\StringTok{ }\KeywordTok{paste0}\NormalTok{(nombres_df,}\StringTok{" (Cor= "}\NormalTok{,}\KeywordTok{round}\NormalTok{(correlacion,}\DecValTok{4}\NormalTok{),}\StringTok{")"}\NormalTok{)}
  
  \KeywordTok{legend}\NormalTok{(}\StringTok{"topleft"}\NormalTok{,}\DataTypeTok{y.intersp =} \FloatTok{0.75}\NormalTok{,}\DataTypeTok{seg.len =} \FloatTok{0.9}\NormalTok{,}
         \DataTypeTok{bty=}\StringTok{"n"}\NormalTok{, }\DataTypeTok{bg=}\StringTok{"transparent"}\NormalTok{,}\DataTypeTok{inset=}\KeywordTok{c}\NormalTok{(}\DecValTok{0}\NormalTok{,}\DecValTok{0}\NormalTok{),}
         \DataTypeTok{legend =}\NormalTok{ leyenda,}\DataTypeTok{lty =} \KeywordTok{c}\NormalTok{(}\DecValTok{2}\NormalTok{,}\DecValTok{2}\NormalTok{,}\DecValTok{2}\NormalTok{,}\DecValTok{2}\NormalTok{,}\DecValTok{2}\NormalTok{),}\DataTypeTok{lwd =} \KeywordTok{c}\NormalTok{(}\DecValTok{2}\NormalTok{,}\DecValTok{2}\NormalTok{,}\DecValTok{2}\NormalTok{,}\DecValTok{2}\NormalTok{,}\DecValTok{2}\NormalTok{),}\DataTypeTok{col =}\NormalTok{ colores[}\DecValTok{1}\OperatorTok{:}\DecValTok{5}\NormalTok{],}\DataTypeTok{ncol =} \DecValTok{1}\NormalTok{,}\DataTypeTok{cex =} \DecValTok{1}\NormalTok{)}
  \KeywordTok{dev.off}\NormalTok{()}
  
\NormalTok{  tabladenombress<-}\ControlFlowTok{function}\NormalTok{(df)\{}
\NormalTok{    group_number<-}\KeywordTok{length}\NormalTok{(}\KeywordTok{attr}\NormalTok{(}\KeywordTok{group_by}\NormalTok{(df,experimento,angulo), }\StringTok{"group"}\NormalTok{))}
\NormalTok{    tabladenombres<-}\StringTok{ }\KeywordTok{matrix}\NormalTok{(}\OperatorTok{-}\DecValTok{31}\NormalTok{,}\DataTypeTok{ncol =} \DecValTok{2}\NormalTok{, }\DataTypeTok{nrow =}\NormalTok{ group_number)}
    \ControlFlowTok{for}\NormalTok{ (grupos }\ControlFlowTok{in} \DecValTok{1}\OperatorTok{:}\NormalTok{group_number) \{}
\NormalTok{      grupos_rpm_resistencia<-}\StringTok{ }\NormalTok{df }\OperatorTok{%>%}\StringTok{ }\KeywordTok{group_by}\NormalTok{(.,experimento,angulo) }\OperatorTok{%>%}\StringTok{ }\KeywordTok{select_groups}\NormalTok{(grupos)}
\NormalTok{      tabladenombres[grupos,}\DecValTok{1}\NormalTok{]<-}\KeywordTok{as.character}\NormalTok{(grupos_rpm_resistencia}\OperatorTok{$}\NormalTok{experimento[}\DecValTok{1}\NormalTok{])}
\NormalTok{      tabladenombres[grupos,}\DecValTok{2}\NormalTok{]<-}\StringTok{ }\KeywordTok{as.character}\NormalTok{(grupos_rpm_resistencia}\OperatorTok{$}\NormalTok{angulo[}\DecValTok{1}\NormalTok{])}
\NormalTok{    \}}
    \KeywordTok{return}\NormalTok{(}\KeywordTok{as.data.frame}\NormalTok{(tabladenombres))}
\NormalTok{  \}}
  
\NormalTok{  tablanombres<-}\KeywordTok{tabladenombress}\NormalTok{(df)}
  
\NormalTok{  coeficientes_P_V<-}\KeywordTok{data.frame}\NormalTok{(}\KeywordTok{matrix}\NormalTok{(}\KeywordTok{unlist}\NormalTok{(lista_coef),}\DataTypeTok{nrow=}\DecValTok{5}\NormalTok{, }\DataTypeTok{byrow=}\NormalTok{T))}
  
\NormalTok{  coef_tabla<-}\StringTok{ }\KeywordTok{cbind}\NormalTok{(tablanombres,coeficientes_P_V) }
  \KeywordTok{names}\NormalTok{(coef_tabla)<-}\KeywordTok{c}\NormalTok{(}\StringTok{"Experimento"}\NormalTok{,}\StringTok{"Angulo"}\NormalTok{,}\StringTok{"a"}\NormalTok{,}\StringTok{"b"}\NormalTok{)}
  
  \KeywordTok{return}\NormalTok{(coef_tabla)}
  
\NormalTok{\}}

\NormalTok{grafica_Potencia_V_alfa<-}\ControlFlowTok{function}\NormalTok{(df,xlimite,ylimite)\{}
\NormalTok{  select_groups <-}\StringTok{ }\ControlFlowTok{function}\NormalTok{(data, groups) \{}
\NormalTok{    data[}\KeywordTok{sort}\NormalTok{(}\KeywordTok{unlist}\NormalTok{(}\KeywordTok{attr}\NormalTok{(data, }\StringTok{"indices"}\NormalTok{)[ groups ])) }\OperatorTok{+}\StringTok{ }\DecValTok{1}\NormalTok{, ]}
\NormalTok{  \}}
  
\NormalTok{  group_number<-}\KeywordTok{length}\NormalTok{(}\KeywordTok{attr}\NormalTok{(}\KeywordTok{group_by}\NormalTok{(df,experimento,angulo), }\StringTok{"group"}\NormalTok{))}
\NormalTok{  lista_watts_Vviento_modelo<-}\StringTok{ }\KeywordTok{list}\NormalTok{()}
\NormalTok{  lista_watts_Vviento_prototipo<-}\StringTok{ }\KeywordTok{list}\NormalTok{()}
  
\NormalTok{  nombres_expr<-}\KeywordTok{vector}\NormalTok{()}
  \ControlFlowTok{for}\NormalTok{ (groups_ind }\ControlFlowTok{in} \DecValTok{1}\OperatorTok{:}\NormalTok{group_number) \{}
    
\NormalTok{    xx<-}\StringTok{ }\NormalTok{df }\OperatorTok{%>%}\StringTok{ }\KeywordTok{group_by}\NormalTok{(.,experimento,angulo) }\OperatorTok{%>%}\StringTok{ }\KeywordTok{select_groups}\NormalTok{(groups_ind)}
\NormalTok{    nombre_}\DecValTok{1}\NormalTok{<-}\KeywordTok{as.character}\NormalTok{(xx}\OperatorTok{$}\NormalTok{experimento[}\DecValTok{1}\NormalTok{])}
\NormalTok{    nombre_}\DecValTok{2}\NormalTok{<-}\KeywordTok{as.character}\NormalTok{(xx}\OperatorTok{$}\NormalTok{angulo[}\DecValTok{1}\NormalTok{])}
\NormalTok{    nombre<-}\KeywordTok{paste}\NormalTok{(nombre_}\DecValTok{1}\NormalTok{,nombre_}\DecValTok{2}\NormalTok{,}\DataTypeTok{sep =} \StringTok{"_"}\NormalTok{)}
    
    
\NormalTok{    percentaje_number<-}\KeywordTok{length}\NormalTok{(}\KeywordTok{attr}\NormalTok{(}\KeywordTok{group_by}\NormalTok{(xx,porcentaje), }\StringTok{"group"}\NormalTok{) )}
\NormalTok{    xx_percentaje_modelo<-}\KeywordTok{list}\NormalTok{()}
\NormalTok{    xx_percentaje_prototipo<-}\KeywordTok{list}\NormalTok{()}
    
    \ControlFlowTok{for}\NormalTok{ (per }\ControlFlowTok{in} \DecValTok{1}\OperatorTok{:}\NormalTok{percentaje_number) \{}
\NormalTok{      xx_perc<-}\StringTok{ }\NormalTok{xx }\OperatorTok{%>%}\StringTok{ }\KeywordTok{group_by}\NormalTok{(.,porcentaje) }\OperatorTok{%>%}\StringTok{ }\KeywordTok{select_groups}\NormalTok{(per)}
      
\NormalTok{      xx_perc_modelo<-}\KeywordTok{cbind}\NormalTok{(xx_perc}\OperatorTok{$}\NormalTok{cp_est,xx_perc}\OperatorTok{$}\NormalTok{watts,xx_perc}\OperatorTok{$}\NormalTok{V_viento_correcion)}
      \KeywordTok{colnames}\NormalTok{(xx_perc_modelo)<-}\StringTok{ }\KeywordTok{c}\NormalTok{(}\StringTok{"cp"}\NormalTok{,}\StringTok{"watts"}\NormalTok{, }\StringTok{"Vviento"}\NormalTok{)}
\NormalTok{      xx_percentaje_modelo[[per]]<-}\StringTok{ }\NormalTok{xx_perc_modelo}
      
      
\NormalTok{      xx_perc_prototipo<-}\KeywordTok{cbind}\NormalTok{(xx_perc}\OperatorTok{$}\NormalTok{cp_alfa,xx_perc}\OperatorTok{$}\NormalTok{watts_alfa,xx_perc}\OperatorTok{$}\NormalTok{V_viento_alfa)}
      \KeywordTok{colnames}\NormalTok{(xx_perc_prototipo)<-}\StringTok{ }\KeywordTok{c}\NormalTok{(}\StringTok{"cp"}\NormalTok{,}\StringTok{"watts"}\NormalTok{, }\StringTok{"Vviento"}\NormalTok{)}
\NormalTok{      xx_percentaje_prototipo[[per]]<-}\StringTok{ }\NormalTok{xx_perc_prototipo}
      
      
\NormalTok{    \}}
\NormalTok{    lista_watts_Vviento_modelo[[groups_ind]]<-}\StringTok{ }\NormalTok{xx_percentaje_modelo}
\NormalTok{    lista_watts_Vviento_prototipo[[groups_ind]]<-}\StringTok{ }\NormalTok{xx_percentaje_prototipo}
    
\NormalTok{    nombres_expr[groups_ind]<-}\StringTok{ }\NormalTok{nombre}
\NormalTok{  \}}
  
  \KeywordTok{names}\NormalTok{(lista_watts_Vviento_modelo)<-}\StringTok{ }\NormalTok{nombres_expr}
  
\NormalTok{  lista_watts_Vviento_max_modelo<-}\KeywordTok{list}\NormalTok{()}
\NormalTok{  lista_watts_Vviento_max_prototipo<-}\KeywordTok{list}\NormalTok{()}
  
  \ControlFlowTok{for}\NormalTok{ (i }\ControlFlowTok{in} \DecValTok{1}\OperatorTok{:}\KeywordTok{length}\NormalTok{(lista_watts_Vviento_modelo)) \{}
    
\NormalTok{    df_watts_Vviento_modelo<-}\StringTok{ }\KeywordTok{data.frame}\NormalTok{(}\KeywordTok{matrix}\NormalTok{(}\KeywordTok{unlist}\NormalTok{(}\KeywordTok{lapply}\NormalTok{(lista_watts_Vviento_modelo[[i]],}
                                                              \ControlFlowTok{function}\NormalTok{(x) x[}\KeywordTok{which.max}\NormalTok{(x[,}\DecValTok{1}\NormalTok{]),}\DecValTok{2}\OperatorTok{:}\DecValTok{3}\NormalTok{])),}
                                                \DataTypeTok{nrow=}\DecValTok{6}\NormalTok{, }\DataTypeTok{byrow=}\NormalTok{T))}
    \KeywordTok{names}\NormalTok{(df_watts_Vviento_modelo)<-}\StringTok{ }\KeywordTok{c}\NormalTok{(}\StringTok{"Watss"}\NormalTok{,}\StringTok{"Vviento"}\NormalTok{)}
\NormalTok{    lista_watts_Vviento_max_modelo[[i]]<-}\StringTok{ }\NormalTok{df_watts_Vviento_modelo}
    
\NormalTok{    df_watts_Vviento_prototipo<-}\StringTok{ }\KeywordTok{data.frame}\NormalTok{(}\KeywordTok{matrix}\NormalTok{(}\KeywordTok{unlist}\NormalTok{(}\KeywordTok{lapply}\NormalTok{(lista_watts_Vviento_prototipo[[i]],}
                                                                 \ControlFlowTok{function}\NormalTok{(x) x[}\KeywordTok{which.max}\NormalTok{(x[,}\DecValTok{1}\NormalTok{]),}\DecValTok{2}\OperatorTok{:}\DecValTok{3}\NormalTok{])),}
                                                   \DataTypeTok{nrow=}\DecValTok{6}\NormalTok{, }\DataTypeTok{byrow=}\NormalTok{T))}
    \KeywordTok{names}\NormalTok{(df_watts_Vviento_modelo)<-}\StringTok{ }\KeywordTok{c}\NormalTok{(}\StringTok{"Watss"}\NormalTok{,}\StringTok{"Vviento"}\NormalTok{)}
\NormalTok{    lista_watts_Vviento_max_prototipo[[i]]<-}\StringTok{ }\NormalTok{df_watts_Vviento_prototipo}
    
    
\NormalTok{  \}}
  \KeywordTok{names}\NormalTok{(lista_watts_Vviento_max_modelo)<-}\StringTok{ }\NormalTok{nombres_expr}
  
  \KeywordTok{dir.create}\NormalTok{(}\KeywordTok{paste0}\NormalTok{(}\KeywordTok{here}\NormalTok{(),}\StringTok{"/graficos_Potencia_V/"}\NormalTok{))}
  
  \CommentTok{#jpeg(paste0(here(),"/graficos_Potencia_V/grafica_Potencia_V.jpeg"))}
  \KeywordTok{tiff}\NormalTok{(}\KeywordTok{paste0}\NormalTok{(}\KeywordTok{here}\NormalTok{(),}\StringTok{"/graficos_Potencia_V/grafica_Potencia_V_comparativa.tiff"}\NormalTok{), }\DataTypeTok{width =} \DecValTok{7}\NormalTok{, }\DataTypeTok{height =}\DecValTok{7}\NormalTok{, }\DataTypeTok{units =} \StringTok{'in'}\NormalTok{, }\DataTypeTok{res =} \DecValTok{300}\NormalTok{)}
  
  
\NormalTok{  colores<-}\StringTok{ }\KeywordTok{c}\NormalTok{(}\StringTok{"orange"}\NormalTok{,}\StringTok{"red"}\NormalTok{,}\StringTok{"blue"}\NormalTok{,}\StringTok{"dodgerblue4"}\NormalTok{,}\StringTok{"purple"}\NormalTok{,}\StringTok{"black"}\NormalTok{)}
\NormalTok{  pch_dif<-}\KeywordTok{c}\NormalTok{(}\DecValTok{0}\OperatorTok{:}\DecValTok{5}\NormalTok{)}
\NormalTok{  correlacion<-}\StringTok{ }\KeywordTok{vector}\NormalTok{()}
\NormalTok{  lista_coef_modelo<-}\KeywordTok{list}\NormalTok{()}
\NormalTok{  lista_coef_prototipo<-}\KeywordTok{list}\NormalTok{()}
  \ControlFlowTok{for}\NormalTok{(i }\ControlFlowTok{in} \DecValTok{1}\OperatorTok{:}\KeywordTok{length}\NormalTok{(lista_watts_Vviento_max_modelo))\{}
    \CommentTok{#en caso de que sea mejor añadir el origen}
    \CommentTok{#x<- c(0,lambda_Cp[[i]][,2])}
    \CommentTok{#y<- c(0,lambda_Cp[[i]][,1])}
\NormalTok{    x_modelo<-}\StringTok{ }\NormalTok{lista_watts_Vviento_max_modelo[[i]][,}\DecValTok{2}\NormalTok{]}
\NormalTok{    y_modelo<-}\StringTok{ }\NormalTok{lista_watts_Vviento_max_modelo[[i]][,}\DecValTok{1}\NormalTok{]}
\NormalTok{    fit_curva_modelo<-}\KeywordTok{nls}\NormalTok{(y_modelo}\OperatorTok{~}\NormalTok{b}\OperatorTok{+}\NormalTok{a}\OperatorTok{*}\NormalTok{x_modelo}\OperatorTok{^}\DecValTok{3}\NormalTok{,}\DataTypeTok{start =} \KeywordTok{list}\NormalTok{(}\DataTypeTok{a=}\DecValTok{0}\NormalTok{, }\DataTypeTok{b=}\DecValTok{0}\NormalTok{))}
\NormalTok{    xx_modelo <-}\StringTok{ }\KeywordTok{seq}\NormalTok{(}\KeywordTok{min}\NormalTok{(x_modelo),xlimite[}\DecValTok{2}\NormalTok{], }\DataTypeTok{by=}\FloatTok{0.1}\NormalTok{)}
    
    
\NormalTok{    x_prototipo<-}\StringTok{ }\NormalTok{lista_watts_Vviento_max_prototipo[[i]][,}\DecValTok{2}\NormalTok{]}
\NormalTok{    y_prototipo<-}\StringTok{ }\NormalTok{lista_watts_Vviento_max_prototipo[[i]][,}\DecValTok{1}\NormalTok{]}
\NormalTok{    fit_curva_prototipo<-}\KeywordTok{nls}\NormalTok{(y_prototipo}\OperatorTok{~}\NormalTok{b}\OperatorTok{+}\NormalTok{a}\OperatorTok{*}\NormalTok{x_prototipo}\OperatorTok{^}\DecValTok{3}\NormalTok{,}\DataTypeTok{start =} \KeywordTok{list}\NormalTok{(}\DataTypeTok{a=}\DecValTok{0}\NormalTok{, }\DataTypeTok{b=}\DecValTok{0}\NormalTok{))}
\NormalTok{    xx_prototipo <-}\StringTok{ }\KeywordTok{seq}\NormalTok{(}\KeywordTok{min}\NormalTok{(x_prototipo),xlimite[}\DecValTok{2}\NormalTok{], }\DataTypeTok{by=}\FloatTok{0.1}\NormalTok{)}
    
    
    
    
    \KeywordTok{plot}\NormalTok{(}\OtherTok{NULL}\NormalTok{,}\DataTypeTok{xlim=}\NormalTok{xlimite,}
         \DataTypeTok{ylim =}\NormalTok{ ylimite,}\DataTypeTok{cex=}\FloatTok{0.005}\NormalTok{, }\DataTypeTok{yaxt =}\StringTok{"n"}\NormalTok{,}
         \DataTypeTok{xlab =} \StringTok{"Velocidad del viento (m/s)"}\NormalTok{, }\DataTypeTok{ylab =} \StringTok{"Potencia (W)"}\NormalTok{, }\DataTypeTok{bty=}\StringTok{'L'}\NormalTok{)}
    \KeywordTok{title}\NormalTok{(}\DataTypeTok{main=} \StringTok{"Curvas de potencia"}\NormalTok{)}
    \KeywordTok{par}\NormalTok{(}\DataTypeTok{new=}\NormalTok{T)}
    
    \KeywordTok{lines}\NormalTok{(xx_modelo, }\KeywordTok{predict}\NormalTok{(fit_curva_modelo, }\KeywordTok{data.frame}\NormalTok{(}\DataTypeTok{x_modelo=}\NormalTok{xx_modelo)), }\DataTypeTok{col=}\NormalTok{colores[i],}\DataTypeTok{lwd=}\DecValTok{1}\NormalTok{,}\DataTypeTok{lty=}\DecValTok{2}\NormalTok{)}
    
    \KeywordTok{lines}\NormalTok{(xx_prototipo, }\KeywordTok{predict}\NormalTok{(fit_curva_prototipo, }\KeywordTok{data.frame}\NormalTok{(}\DataTypeTok{x_prototipo=}\NormalTok{xx_prototipo)), }\DataTypeTok{col=}\NormalTok{colores[i],}\DataTypeTok{lwd=}\DecValTok{1}\NormalTok{,}\DataTypeTok{lty=}\DecValTok{1}\NormalTok{)}
    
    
    \KeywordTok{par}\NormalTok{(}\DataTypeTok{new=}\NormalTok{T)}
\NormalTok{    lista_coef_modelo[[i]]<-}\StringTok{ }\KeywordTok{coef}\NormalTok{(fit_curva_modelo)}
\NormalTok{    lista_coef_prototipo[[i]]<-}\StringTok{ }\KeywordTok{coef}\NormalTok{(fit_curva_prototipo)}
    
\NormalTok{  \}}
  
  \KeywordTok{axis}\NormalTok{(}\DecValTok{2}\NormalTok{, }\DataTypeTok{at=}\KeywordTok{seq}\NormalTok{(}\DecValTok{0}\NormalTok{,ylimite[}\DecValTok{2}\NormalTok{], }\DataTypeTok{by=}\KeywordTok{round}\NormalTok{(ylimite[}\DecValTok{2}\NormalTok{]}\OperatorTok{/}\DecValTok{7}\NormalTok{,}\DecValTok{0}\NormalTok{)),}\DataTypeTok{las=}\DecValTok{2}\NormalTok{)}
  
\NormalTok{  titulos_graficos<-}\ControlFlowTok{function}\NormalTok{(df)\{}
\NormalTok{    group_number<-}\KeywordTok{length}\NormalTok{(}\KeywordTok{attr}\NormalTok{(}\KeywordTok{group_by}\NormalTok{(df,experimento,angulo,porcentaje), }\StringTok{"group"}\NormalTok{))}
\NormalTok{    lista_rpm_resistencia<-}\StringTok{ }\KeywordTok{list}\NormalTok{()}
\NormalTok{    nombres_lista<-}\StringTok{ }\KeywordTok{vector}\NormalTok{()}
\NormalTok{    titulos_grafico<-}\StringTok{ }\KeywordTok{vector}\NormalTok{()}
\NormalTok{    tabladenombres<-}\StringTok{ }\KeywordTok{matrix}\NormalTok{(}\OperatorTok{-}\DecValTok{31}\NormalTok{,}\DataTypeTok{ncol =} \DecValTok{3}\NormalTok{, }\DataTypeTok{nrow =}\NormalTok{ group_number)}
    \ControlFlowTok{for}\NormalTok{ (grupos }\ControlFlowTok{in} \DecValTok{1}\OperatorTok{:}\NormalTok{group_number) \{}
\NormalTok{      grupos_rpm_resistencia<-}\StringTok{ }\NormalTok{df }\OperatorTok{%>%}\StringTok{ }\KeywordTok{group_by}\NormalTok{(.,experimento,angulo,porcentaje) }\OperatorTok{%>%}\StringTok{ }\KeywordTok{select_groups}\NormalTok{(grupos)}
      
\NormalTok{      tabla_resistencia_rpm<-}\StringTok{ }\KeywordTok{as.data.frame}\NormalTok{(}\KeywordTok{cbind}\NormalTok{(}\KeywordTok{as.numeric}\NormalTok{(grupos_rpm_resistencia}\OperatorTok{$}\NormalTok{RPM),}\KeywordTok{as.data.frame}\NormalTok{(grupos_rpm_resistencia}\OperatorTok{$}\NormalTok{resistencia)))}
      \KeywordTok{colnames}\NormalTok{(tabla_resistencia_rpm)<-}\StringTok{ }\KeywordTok{c}\NormalTok{(}\StringTok{"RPM"}\NormalTok{, }\StringTok{"Omhnios"}\NormalTok{)}
      
\NormalTok{      nombre_tabla<-}\StringTok{ }\KeywordTok{unique}\NormalTok{(}\KeywordTok{paste}\NormalTok{(grupos_rpm_resistencia}\OperatorTok{$}\NormalTok{experimento,grupos_rpm_resistencia}\OperatorTok{$}\NormalTok{angulo,grupos_rpm_resistencia}\OperatorTok{$}\NormalTok{porcentaje,}\DataTypeTok{sep =} \StringTok{"_"}\NormalTok{))}
      
      \ControlFlowTok{if}\NormalTok{(}\KeywordTok{is.na}\NormalTok{(grupos_rpm_resistencia}\OperatorTok{$}\NormalTok{angulo))\{}
\NormalTok{        titulo_graph<-}\StringTok{ }\KeywordTok{unique}\NormalTok{(}\KeywordTok{paste0}\NormalTok{(grupos_rpm_resistencia}\OperatorTok{$}\NormalTok{experimento))}
\NormalTok{      \}}\ControlFlowTok{else}\NormalTok{\{}
\NormalTok{        titulo_graph<-}\StringTok{ }\KeywordTok{unique}\NormalTok{(}\KeywordTok{paste0}\NormalTok{(grupos_rpm_resistencia}\OperatorTok{$}\NormalTok{experimento,}\StringTok{"-"}\NormalTok{,grupos_rpm_resistencia}\OperatorTok{$}\NormalTok{angulo,}\StringTok{"º"}\NormalTok{))}
\NormalTok{      \}}
\NormalTok{      titulos_grafico[grupos]<-}\StringTok{ }\NormalTok{titulo_graph}
\NormalTok{      lista_rpm_resistencia[[grupos]]<-}\StringTok{ }\NormalTok{tabla_resistencia_rpm}
\NormalTok{      nombres_lista[grupos]<-}\StringTok{ }\NormalTok{nombre_tabla}
\NormalTok{      tabladenombres[grupos,}\DecValTok{1}\NormalTok{]<-}\KeywordTok{as.character}\NormalTok{(grupos_rpm_resistencia}\OperatorTok{$}\NormalTok{experimento[}\DecValTok{1}\NormalTok{])}
\NormalTok{      tabladenombres[grupos,}\DecValTok{2}\NormalTok{]<-}\StringTok{ }\KeywordTok{as.character}\NormalTok{(grupos_rpm_resistencia}\OperatorTok{$}\NormalTok{angulo[}\DecValTok{1}\NormalTok{])}
\NormalTok{      tabladenombres[grupos,}\DecValTok{3}\NormalTok{]<-}\StringTok{ }\KeywordTok{as.character}\NormalTok{(grupos_rpm_resistencia}\OperatorTok{$}\NormalTok{porcentaje[}\DecValTok{1}\NormalTok{])}
\NormalTok{    \}}
    \KeywordTok{return}\NormalTok{(}\KeywordTok{unique}\NormalTok{(titulos_grafico))}
    
\NormalTok{  \}}
\NormalTok{  nombres_df<-}\StringTok{ }\KeywordTok{titulos_graficos}\NormalTok{(df)}
  
  
\NormalTok{  leyenda<-}\StringTok{ }\KeywordTok{paste0}\NormalTok{(nombres_df)}
  
  \KeywordTok{legend}\NormalTok{(}\StringTok{"topleft"}\NormalTok{,}\DataTypeTok{y.intersp =} \FloatTok{0.75}\NormalTok{,}\DataTypeTok{seg.len =} \FloatTok{1.2}\NormalTok{,}
         \DataTypeTok{bty=}\StringTok{"n"}\NormalTok{, }\DataTypeTok{bg=}\StringTok{"transparent"}\NormalTok{,}\DataTypeTok{inset=}\KeywordTok{c}\NormalTok{(}\DecValTok{0}\NormalTok{,}\DecValTok{0}\NormalTok{),}
         \DataTypeTok{legend =}\NormalTok{ leyenda,}\DataTypeTok{lty =} \KeywordTok{c}\NormalTok{(}\DecValTok{1}\NormalTok{,}\DecValTok{1}\NormalTok{,}\DecValTok{1}\NormalTok{,}\DecValTok{1}\NormalTok{,}\DecValTok{1}\NormalTok{),}\DataTypeTok{lwd =} \KeywordTok{c}\NormalTok{(}\DecValTok{2}\NormalTok{,}\DecValTok{2}\NormalTok{,}\DecValTok{2}\NormalTok{,}\DecValTok{2}\NormalTok{,}\DecValTok{2}\NormalTok{),}\DataTypeTok{col =}\NormalTok{ colores[}\DecValTok{1}\OperatorTok{:}\DecValTok{5}\NormalTok{],}\DataTypeTok{ncol =} \DecValTok{1}\NormalTok{,}\DataTypeTok{cex =} \DecValTok{1}\NormalTok{)}
  \KeywordTok{dev.off}\NormalTok{()}
  
\NormalTok{  tabladenombress<-}\ControlFlowTok{function}\NormalTok{(df)\{}
\NormalTok{    group_number<-}\KeywordTok{length}\NormalTok{(}\KeywordTok{attr}\NormalTok{(}\KeywordTok{group_by}\NormalTok{(df,experimento,angulo), }\StringTok{"group"}\NormalTok{))}
\NormalTok{    tabladenombres<-}\StringTok{ }\KeywordTok{matrix}\NormalTok{(}\OperatorTok{-}\DecValTok{31}\NormalTok{,}\DataTypeTok{ncol =} \DecValTok{2}\NormalTok{, }\DataTypeTok{nrow =}\NormalTok{ group_number)}
    \ControlFlowTok{for}\NormalTok{ (grupos }\ControlFlowTok{in} \DecValTok{1}\OperatorTok{:}\NormalTok{group_number) \{}
\NormalTok{      grupos_rpm_resistencia<-}\StringTok{ }\NormalTok{df }\OperatorTok{%>%}\StringTok{ }\KeywordTok{group_by}\NormalTok{(.,experimento,angulo) }\OperatorTok{%>%}\StringTok{ }\KeywordTok{select_groups}\NormalTok{(grupos)}
\NormalTok{      tabladenombres[grupos,}\DecValTok{1}\NormalTok{]<-}\KeywordTok{as.character}\NormalTok{(grupos_rpm_resistencia}\OperatorTok{$}\NormalTok{experimento[}\DecValTok{1}\NormalTok{])}
\NormalTok{      tabladenombres[grupos,}\DecValTok{2}\NormalTok{]<-}\StringTok{ }\KeywordTok{as.character}\NormalTok{(grupos_rpm_resistencia}\OperatorTok{$}\NormalTok{angulo[}\DecValTok{1}\NormalTok{])}
\NormalTok{    \}}
    \KeywordTok{return}\NormalTok{(}\KeywordTok{as.data.frame}\NormalTok{(tabladenombres))}
\NormalTok{  \}}
  
\NormalTok{  tablanombres<-}\KeywordTok{tabladenombress}\NormalTok{(df)}
  
\NormalTok{  coeficientes_P_V_modelo<-}\KeywordTok{data.frame}\NormalTok{(}\KeywordTok{matrix}\NormalTok{(}\KeywordTok{unlist}\NormalTok{(lista_coef_modelo),}\DataTypeTok{nrow=}\DecValTok{5}\NormalTok{, }\DataTypeTok{byrow=}\NormalTok{T))}
\NormalTok{  coeficientes_P_V_prototipo<-}\KeywordTok{data.frame}\NormalTok{(}\KeywordTok{matrix}\NormalTok{(}\KeywordTok{unlist}\NormalTok{(lista_coef_prototipo),}\DataTypeTok{nrow=}\DecValTok{5}\NormalTok{, }\DataTypeTok{byrow=}\NormalTok{T))}
  
\NormalTok{  coef_tabla<-}\StringTok{ }\KeywordTok{cbind}\NormalTok{(tablanombres,coeficientes_P_V_prototipo) }
  \KeywordTok{names}\NormalTok{(coef_tabla)<-}\KeywordTok{c}\NormalTok{(}\StringTok{"Experimento"}\NormalTok{,}\StringTok{"Angulo"}\NormalTok{,}\StringTok{"a"}\NormalTok{,}\StringTok{"b"}\NormalTok{)}
  
  \KeywordTok{return}\NormalTok{(coef_tabla)}
  
\NormalTok{\}}
\NormalTok{##funcion para plotear todas las graficas de Cp a todas las velocidades, comparando experimentos}
\NormalTok{ploteo_CPmax10<-}\StringTok{ }\ControlFlowTok{function}\NormalTok{(datos,grados)\{}
\NormalTok{  df<-datos}
\NormalTok{  select_groups <-}\StringTok{ }\ControlFlowTok{function}\NormalTok{(data, groups) \{}
\NormalTok{    data[}\KeywordTok{sort}\NormalTok{(}\KeywordTok{unlist}\NormalTok{(}\KeywordTok{attr}\NormalTok{(data, }\StringTok{"indices"}\NormalTok{)[ groups ])) }\OperatorTok{+}\StringTok{ }\DecValTok{1}\NormalTok{, ]}
\NormalTok{  \}}
  
\NormalTok{  lista_Cpmax_total<-}\KeywordTok{list}\NormalTok{()}
\NormalTok{  lista_Cps_nueva<-}\KeywordTok{list}\NormalTok{()}
\NormalTok{  nombres_gra<-}\StringTok{ }\KeywordTok{vector}\NormalTok{()}
\NormalTok{  group_number<-}\KeywordTok{length}\NormalTok{(}\KeywordTok{attr}\NormalTok{(}\KeywordTok{group_by}\NormalTok{(df,experimento,angulo), }\StringTok{"group"}\NormalTok{))}
  \ControlFlowTok{for}\NormalTok{ (groups_ind }\ControlFlowTok{in} \DecValTok{1}\OperatorTok{:}\NormalTok{group_number) \{}
    
\NormalTok{    xx<-}\StringTok{ }\NormalTok{df }\OperatorTok{%>%}\StringTok{ }\KeywordTok{group_by}\NormalTok{(.,experimento,angulo) }\OperatorTok{%>%}\StringTok{ }\KeywordTok{select_groups}\NormalTok{(groups_ind)}
\NormalTok{    percentaje_number<-}\KeywordTok{length}\NormalTok{(}\KeywordTok{attr}\NormalTok{(}\KeywordTok{group_by}\NormalTok{(xx,porcentaje), }\StringTok{"group"}\NormalTok{) )}
    
\NormalTok{    nombre_}\DecValTok{1}\NormalTok{<-}\KeywordTok{as.character}\NormalTok{(xx}\OperatorTok{$}\NormalTok{experimento[}\DecValTok{1}\NormalTok{])}
\NormalTok{    nombre_}\DecValTok{2}\NormalTok{<-}\KeywordTok{as.character}\NormalTok{(xx}\OperatorTok{$}\NormalTok{angulo[}\DecValTok{1}\NormalTok{])}
\NormalTok{    nombre<-}\KeywordTok{paste}\NormalTok{(nombre_}\DecValTok{1}\NormalTok{,nombre_}\DecValTok{2}\NormalTok{,}\DataTypeTok{sep =} \StringTok{"_"}\NormalTok{)}
    
    \ControlFlowTok{if}\NormalTok{(}\KeywordTok{is.na}\NormalTok{(nombre_}\DecValTok{2}\NormalTok{))\{}
\NormalTok{      nombre_grafica<-}\StringTok{ }\NormalTok{nombre_}\DecValTok{1}
\NormalTok{    \}}\ControlFlowTok{else}\NormalTok{\{}
\NormalTok{      nombre_grafica<-}\KeywordTok{paste}\NormalTok{(nombre_}\DecValTok{1}\NormalTok{,}\StringTok{" "}\NormalTok{,nombre_}\DecValTok{2}\NormalTok{,}\StringTok{"º"}\NormalTok{,}\DataTypeTok{sep =} \StringTok{""}\NormalTok{)}
\NormalTok{    \}}
    
\NormalTok{    xx_percentaje<-}\KeywordTok{list}\NormalTok{()}
    \ControlFlowTok{for}\NormalTok{ (per }\ControlFlowTok{in} \DecValTok{1}\OperatorTok{:}\NormalTok{percentaje_number) \{}
\NormalTok{      xx_perc<-}\StringTok{ }\NormalTok{xx }\OperatorTok{%>%}\StringTok{ }\KeywordTok{group_by}\NormalTok{(.,porcentaje) }\OperatorTok{%>%}\StringTok{ }\KeywordTok{select_groups}\NormalTok{(per)}
\NormalTok{      xx_perc<-}\KeywordTok{cbind}\NormalTok{(xx_perc}\OperatorTok{$}\NormalTok{cp_alfa,xx_perc}\OperatorTok{$}\NormalTok{TSR_alfa,xx_perc}\OperatorTok{$}\NormalTok{V_viento_alfa)}
      \KeywordTok{colnames}\NormalTok{(xx_perc)<-}\StringTok{ }\KeywordTok{c}\NormalTok{(}\StringTok{"cp"}\NormalTok{,}\StringTok{"TSR"}\NormalTok{, }\StringTok{"Vviento"}\NormalTok{)}
\NormalTok{      xx_percentaje[[per]]<-}\StringTok{ }\NormalTok{xx_perc}
      
\NormalTok{    \}}
    
    
    
    
\NormalTok{    ##lambda_cp es una tabla de dos columnas (cp,lambda) }
\NormalTok{    lambda_Cp<-}\StringTok{ }\NormalTok{xx_percentaje}
\NormalTok{    lambda_Cp_clean<-}\KeywordTok{list}\NormalTok{()}
    \ControlFlowTok{for}\NormalTok{(j }\ControlFlowTok{in} \DecValTok{1}\OperatorTok{:}\KeywordTok{length}\NormalTok{(lambda_Cp))\{}
\NormalTok{      cp_lmb<-}\StringTok{ }\NormalTok{lambda_Cp[[j]]}
\NormalTok{      cp_lmb<-cp_lmb[}\KeywordTok{order}\NormalTok{(cp_lmb[,}\DecValTok{2}\NormalTok{]),]}
      
      
\NormalTok{      TSR_}\DecValTok{1}\NormalTok{<-cp_lmb[,}\DecValTok{2}\NormalTok{]}
\NormalTok{      Cp_}\DecValTok{1}\NormalTok{<-cp_lmb[,}\DecValTok{1}\NormalTok{]}
      
\NormalTok{      V_tsr<-}\StringTok{ }\KeywordTok{seq}\NormalTok{(}\FloatTok{0.05}\NormalTok{,}\KeywordTok{max}\NormalTok{(TSR_}\DecValTok{1}\NormalTok{),}\DataTypeTok{by=}\KeywordTok{max}\NormalTok{(TSR_}\DecValTok{1}\NormalTok{)}\OperatorTok{/}\DecValTok{8}\NormalTok{)}
\NormalTok{      TSR_}\DecValTok{2}\NormalTok{<-}\StringTok{ }\KeywordTok{vector}\NormalTok{()}
\NormalTok{      Cp_}\DecValTok{2}\NormalTok{<-}\StringTok{ }\KeywordTok{vector}\NormalTok{()}
      
      \ControlFlowTok{for}\NormalTok{(i }\ControlFlowTok{in} \DecValTok{1}\OperatorTok{:}\KeywordTok{length}\NormalTok{(V_tsr))\{}
        
\NormalTok{        Cp_}\DecValTok{2}\NormalTok{[i]<-}\StringTok{ }\NormalTok{Cp_}\DecValTok{1}\NormalTok{[}\KeywordTok{which.min}\NormalTok{(}\KeywordTok{abs}\NormalTok{(TSR_}\DecValTok{1}\OperatorTok{-}\NormalTok{V_tsr[i]))]}
\NormalTok{        TSR_}\DecValTok{2}\NormalTok{[i]<-TSR_}\DecValTok{1}\NormalTok{[}\KeywordTok{which.min}\NormalTok{(}\KeywordTok{abs}\NormalTok{(TSR_}\DecValTok{1}\OperatorTok{-}\NormalTok{V_tsr[i]))]}
        
\NormalTok{      \}}
\NormalTok{      validacion<-}\KeywordTok{cbind}\NormalTok{(}\KeywordTok{unique}\NormalTok{(Cp_}\DecValTok{2}\NormalTok{),}\KeywordTok{unique}\NormalTok{(TSR_}\DecValTok{2}\NormalTok{))}
\NormalTok{      validacion_}\DecValTok{1}\NormalTok{<-}\StringTok{ }\NormalTok{validacion[}\DecValTok{1}\OperatorTok{:}\KeywordTok{which.max}\NormalTok{(validacion[,}\DecValTok{1}\NormalTok{]),]}
\NormalTok{      validacion_}\DecValTok{2}\NormalTok{<-}\StringTok{ }\NormalTok{validacion[(}\KeywordTok{which.max}\NormalTok{(validacion[,}\DecValTok{1}\NormalTok{])}\OperatorTok{+}\DecValTok{1}\NormalTok{)}\OperatorTok{:}\KeywordTok{length}\NormalTok{(validacion[,}\DecValTok{1}\NormalTok{]),]}
\NormalTok{      indeeex<-}\StringTok{ }\KeywordTok{vector}\NormalTok{()}
\NormalTok{      rr<-}\StringTok{ }\DecValTok{1} 
      
      \ControlFlowTok{if}\NormalTok{(}\KeywordTok{length}\NormalTok{(validacion_}\DecValTok{2}\NormalTok{)}\OperatorTok{==}\DecValTok{2}\NormalTok{)\{}
\NormalTok{        validacion_}\DecValTok{2}\NormalTok{<-}\StringTok{ }\NormalTok{validacion_}\DecValTok{2}
\NormalTok{      \}}\ControlFlowTok{else}\NormalTok{\{}
        \ControlFlowTok{for}\NormalTok{ (i }\ControlFlowTok{in} \DecValTok{1}\OperatorTok{:}\KeywordTok{length}\NormalTok{(validacion_}\DecValTok{2}\NormalTok{[,}\DecValTok{1}\NormalTok{])) \{}
          
          
          \ControlFlowTok{if}\NormalTok{(i}\OperatorTok{==}\KeywordTok{length}\NormalTok{(validacion_}\DecValTok{2}\NormalTok{[,}\DecValTok{1}\NormalTok{]))\{}\ControlFlowTok{break}\NormalTok{\}}\ControlFlowTok{else}\NormalTok{\{}
            
            \ControlFlowTok{if}\NormalTok{(validacion_}\DecValTok{2}\NormalTok{[i,}\DecValTok{1}\NormalTok{] }\OperatorTok{<}\StringTok{ }\NormalTok{validacion_}\DecValTok{2}\NormalTok{[(i}\OperatorTok{+}\DecValTok{1}\NormalTok{),}\DecValTok{1}\NormalTok{])\{}
\NormalTok{              indeeex[rr]<-}\StringTok{ }\KeywordTok{as.numeric}\NormalTok{(i) }
\NormalTok{              rr<-rr}\OperatorTok{+}\DecValTok{1}
              
              
\NormalTok{            \}}
            
\NormalTok{          \}}
\NormalTok{        \}}
        
\NormalTok{      \}}
      
      
      \ControlFlowTok{if}\NormalTok{(}\KeywordTok{length}\NormalTok{(indeeex)}\OperatorTok{==}\DecValTok{0}\NormalTok{)\{}
\NormalTok{        validacion_}\DecValTok{2}\NormalTok{<-}\StringTok{ }\NormalTok{validacion_}\DecValTok{2}
\NormalTok{      \}}\ControlFlowTok{else}\NormalTok{\{}
\NormalTok{        validacion_}\DecValTok{2}\NormalTok{<-validacion_}\DecValTok{2}\NormalTok{[}\OperatorTok{-}\NormalTok{indeeex,]}
\NormalTok{      \}}
      
\NormalTok{      clean_table<-}\KeywordTok{rbind}\NormalTok{(validacion_}\DecValTok{1}\NormalTok{,validacion_}\DecValTok{2}\NormalTok{)}
      
      
\NormalTok{      lambda_Cp_clean[[j]]<-}\StringTok{ }\NormalTok{clean_table}
      
\NormalTok{    \}}
    
\NormalTok{    lista_Cps_nueva[[groups_ind]]<-}\StringTok{ }\NormalTok{lambda_Cp_clean}
\NormalTok{    nombres_gra[groups_ind]<-}\StringTok{ }\NormalTok{nombre_grafica}
    
\NormalTok{  \} }
  
\NormalTok{  vector_nombre_vel<-}\StringTok{ }\KeywordTok{c}\NormalTok{(}\FloatTok{10.34}\NormalTok{,}\FloatTok{5.47}\NormalTok{,}\FloatTok{6.04}\NormalTok{,}\FloatTok{7.29}\NormalTok{,}\FloatTok{8.33}\NormalTok{,}\FloatTok{9.36}\NormalTok{)}
  
  
  \ControlFlowTok{for}\NormalTok{ (porcentaje }\ControlFlowTok{in} \DecValTok{1}\OperatorTok{:}\KeywordTok{length}\NormalTok{(lista_Cps_nueva[[}\DecValTok{1}\NormalTok{]])) \{}
    
\NormalTok{    lista_cpmsVmax<-}\StringTok{ }\KeywordTok{lapply}\NormalTok{(lista_Cps_nueva,}\StringTok{"[["}\NormalTok{,porcentaje)}
    
\NormalTok{    x_max<-}\KeywordTok{max}\NormalTok{(}\KeywordTok{sapply}\NormalTok{(lista_cpmsVmax, }\ControlFlowTok{function}\NormalTok{(x) }\KeywordTok{max}\NormalTok{(x[,}\DecValTok{2}\NormalTok{])))}
\NormalTok{    y_max<-}\KeywordTok{max}\NormalTok{(}\KeywordTok{sapply}\NormalTok{(lista_cpmsVmax, }\ControlFlowTok{function}\NormalTok{(x) }\KeywordTok{max}\NormalTok{(x[,}\DecValTok{1}\NormalTok{])))}
    
    
    \KeywordTok{dir.create}\NormalTok{(}\KeywordTok{paste0}\NormalTok{(}\KeywordTok{here}\NormalTok{(),}\StringTok{"/graficos_Cp_juntos/"}\NormalTok{))}
    
    \CommentTok{#jpeg(paste0(here(),"/graficos_Cp_juntos/",porcentaje,".jpeg"))}
    \KeywordTok{tiff}\NormalTok{(}\KeywordTok{paste0}\NormalTok{(}\KeywordTok{here}\NormalTok{(),}\StringTok{"/graficos_Cp_juntos/"}\NormalTok{,porcentaje,}\StringTok{".tiff"}\NormalTok{), }\DataTypeTok{width =} \DecValTok{7}\NormalTok{, }\DataTypeTok{height =}\DecValTok{7}\NormalTok{, }\DataTypeTok{units =} \StringTok{'in'}\NormalTok{, }\DataTypeTok{res =} \DecValTok{300}\NormalTok{)}
\NormalTok{    colores<-}\StringTok{ }\KeywordTok{c}\NormalTok{(}\StringTok{"orange"}\NormalTok{,}\StringTok{"red"}\NormalTok{,}\StringTok{"blue"}\NormalTok{,}\StringTok{"dodgerblue4"}\NormalTok{,}\StringTok{"purple"}\NormalTok{)}
\NormalTok{    pch_dif<-}\KeywordTok{c}\NormalTok{(}\DecValTok{0}\OperatorTok{:}\DecValTok{5}\NormalTok{)}
    \ControlFlowTok{for}\NormalTok{(i }\ControlFlowTok{in} \DecValTok{1}\OperatorTok{:}\NormalTok{(}\KeywordTok{length}\NormalTok{(lista_cpmsVmax)))\{}
\NormalTok{      x<-}\StringTok{ }\NormalTok{lista_cpmsVmax[[i]][,}\DecValTok{2}\NormalTok{]}
\NormalTok{      y<-}\StringTok{ }\NormalTok{lista_cpmsVmax[[i]][,}\DecValTok{1}\NormalTok{]}
\NormalTok{      fit5<-}\KeywordTok{lm}\NormalTok{(y}\OperatorTok{~}\KeywordTok{poly}\NormalTok{(x,grados,}\DataTypeTok{raw=}\OtherTok{TRUE}\NormalTok{))}
\NormalTok{      xx <-}\StringTok{ }\KeywordTok{seq}\NormalTok{(}\KeywordTok{min}\NormalTok{(x),}\KeywordTok{max}\NormalTok{(x), }\DataTypeTok{by=}\FloatTok{0.01}\NormalTok{)}
      
      \KeywordTok{plot}\NormalTok{(}\OtherTok{NULL}\NormalTok{,}\DataTypeTok{xlim=}\KeywordTok{c}\NormalTok{(}\DecValTok{0}\NormalTok{,(x_max}\OperatorTok{+}\FloatTok{0.2}\NormalTok{)),}
           \DataTypeTok{ylim =} \KeywordTok{c}\NormalTok{(}\DecValTok{0}\NormalTok{,(y_max}\OperatorTok{+}\FloatTok{0.01}\NormalTok{)),}\DataTypeTok{cex=}\FloatTok{0.005}\NormalTok{, }\DataTypeTok{yaxt =}\StringTok{"n"}\NormalTok{,}
           \DataTypeTok{xlab =} \StringTok{"TSR"}\NormalTok{, }\DataTypeTok{ylab =} \StringTok{"Cp"}\NormalTok{, }\DataTypeTok{bty=}\StringTok{'L'}\NormalTok{)}
      \KeywordTok{par}\NormalTok{(}\DataTypeTok{new=}\NormalTok{T)}
      \KeywordTok{lines}\NormalTok{(xx, }\KeywordTok{predict}\NormalTok{(fit5, }\KeywordTok{data.frame}\NormalTok{(}\DataTypeTok{x=}\NormalTok{xx)), }\DataTypeTok{col=}\NormalTok{colores[i],}\DataTypeTok{lwd=}\DecValTok{2}\NormalTok{)}
\NormalTok{      tabla_maxcp<-}\KeywordTok{cbind}\NormalTok{(xx,}\KeywordTok{predict}\NormalTok{(fit5, }\KeywordTok{data.frame}\NormalTok{(}\DataTypeTok{x=}\NormalTok{xx)))}
      \KeywordTok{par}\NormalTok{(}\DataTypeTok{new=}\NormalTok{T)}
\NormalTok{    \}}
    
    \KeywordTok{axis}\NormalTok{(}\DecValTok{2}\NormalTok{, }\DataTypeTok{at=}\KeywordTok{unique}\NormalTok{(}\KeywordTok{round}\NormalTok{(}\KeywordTok{seq}\NormalTok{(}\DecValTok{0}\NormalTok{,(y_max}\OperatorTok{+}\FloatTok{0.02}\NormalTok{), }\DataTypeTok{by=}\KeywordTok{round}\NormalTok{((y_max}\OperatorTok{/}\DecValTok{10}\NormalTok{),}\DataTypeTok{digits =} \DecValTok{4}\NormalTok{)),}\DataTypeTok{digits =} \DecValTok{2}\NormalTok{)),}\DataTypeTok{las=}\DecValTok{2}\NormalTok{)}
    
\NormalTok{    leyenda<-}\KeywordTok{paste0}\NormalTok{(nombres_gra)}
    
    
    \KeywordTok{legend}\NormalTok{(}\StringTok{"topright"}\NormalTok{, }\DataTypeTok{inset=}\KeywordTok{c}\NormalTok{(}\DecValTok{0}\NormalTok{,}\DecValTok{0}\NormalTok{),leyenda,}
           \DataTypeTok{text.col =}\NormalTok{ colores,}\DataTypeTok{ncol =} \DecValTok{1}\NormalTok{,}\DataTypeTok{cex =} \DecValTok{1}\NormalTok{)}
    
\NormalTok{    titulo<-}\StringTok{ }\KeywordTok{paste0}\NormalTok{(}\StringTok{"Comparación de gráficas Cp-TSR }\CharTok{\textbackslash{}n}\StringTok{ con el túnel de viento al 100 %"}\NormalTok{)}
    \KeywordTok{title}\NormalTok{(}\DataTypeTok{main =}\NormalTok{ titulo)}
    
    \KeywordTok{dev.off}\NormalTok{()}
    
    
\NormalTok{  \}}
  
\NormalTok{\} }
\end{Highlighting}
\end{Shaded}

Paquetes necesarios

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{library}\NormalTok{(stringr)}
\KeywordTok{library}\NormalTok{(magrittr)}
\KeywordTok{library}\NormalTok{(here)}
\KeywordTok{library}\NormalTok{(dplyr)}
\KeywordTok{library}\NormalTok{(ggplot2)}
\KeywordTok{library}\NormalTok{(minpack.lm)}
\end{Highlighting}
\end{Shaded}

Funciones de extracciónd de datos y de tratamiento de valores con los
que se crea un única tabla que contiene toda la información de los
experimentos, de acuerdo a la filosofía de trabajo del paquete
``dplyr''.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{procesador <-}\StringTok{ }\ControlFlowTok{function}\NormalTok{(path_to_csv)\{}
  
\NormalTok{  path_to_txt <-}\StringTok{ }\KeywordTok{str_replace}\NormalTok{(path_to_csv, }\DataTypeTok{pattern =} \StringTok{'csv'}\NormalTok{,}\DataTypeTok{replacement =} \StringTok{'txt'}\NormalTok{)}
  
\NormalTok{  path_to_speed <-}\StringTok{ }\KeywordTok{str_split}\NormalTok{(path_to_csv, }\StringTok{'/'}\NormalTok{, }\DataTypeTok{simplify =} \OtherTok{TRUE}\NormalTok{)}
\NormalTok{  path_to_speed <-}\StringTok{ }\NormalTok{path_to_speed[}\OperatorTok{-}\KeywordTok{length}\NormalTok{(path_to_speed)]}
\NormalTok{  path_to_speed <-}\StringTok{ }\KeywordTok{paste}\NormalTok{(path_to_speed, }\DataTypeTok{collapse=}\StringTok{'/'}\NormalTok{)}
  
\NormalTok{  path_to_speed_mean <-}\StringTok{ }\KeywordTok{paste}\NormalTok{(path_to_speed,}\StringTok{"Vviento_mean.txt"}\NormalTok{,}\DataTypeTok{sep =} \StringTok{'/'}\NormalTok{)}
\NormalTok{  path_to_speed <-}\StringTok{ }\KeywordTok{paste}\NormalTok{(path_to_speed,}\StringTok{"Vviento.txt"}\NormalTok{,}\DataTypeTok{sep =} \StringTok{'/'}\NormalTok{)}
  
  \ControlFlowTok{if}\NormalTok{(}\OperatorTok{!}\KeywordTok{file.exists}\NormalTok{(path_to_speed_mean))\{}
    
\NormalTok{    speed_mean <-}\StringTok{ }\KeywordTok{mean}\NormalTok{(}\KeywordTok{read.table}\NormalTok{(path_to_speed)[,}\DecValTok{1}\NormalTok{])}
    \KeywordTok{write.table}\NormalTok{(speed_mean,}\DataTypeTok{file =}\NormalTok{ path_to_speed_mean)}
\NormalTok{  \}}\ControlFlowTok{else}\NormalTok{\{}
\NormalTok{    speed_mean<-}\StringTok{ }\KeywordTok{read.table}\NormalTok{(path_to_speed_mean)}
    \ControlFlowTok{if}\NormalTok{(}\KeywordTok{is.na}\NormalTok{(speed_mean))\{}
\NormalTok{      speed_mean <-}\StringTok{ }\KeywordTok{mean}\NormalTok{(}\KeywordTok{read.table}\NormalTok{(path_to_speed)[,}\DecValTok{1}\NormalTok{])}
      \KeywordTok{write.table}\NormalTok{(speed_mean,}\DataTypeTok{file =}\NormalTok{ path_to_speed_mean) }
\NormalTok{    \} }\ControlFlowTok{else}\NormalTok{\{}
\NormalTok{      speed_mean <-}\StringTok{ }\NormalTok{speed_mean[}\DecValTok{1}\NormalTok{,}\DecValTok{1}\NormalTok{]}
\NormalTok{    \}}
\NormalTok{  \}}
  
  
  
\NormalTok{  rpm<-}\KeywordTok{colMeans}\NormalTok{(}\KeywordTok{as.data.frame}\NormalTok{(}\KeywordTok{read.table}\NormalTok{(path_to_txt)))}
  
\NormalTok{  y<-}\KeywordTok{read.table}\NormalTok{(path_to_csv, }\DataTypeTok{sep =}\StringTok{","}\NormalTok{ )}
  \CommentTok{# El CSV que ofrece el BK es kk esta todo separado por comas}
\NormalTok{  volts_amps<-}\StringTok{ }\KeywordTok{colMeans}\NormalTok{(}\KeywordTok{as.data.frame}\NormalTok{(}\KeywordTok{cbind}\NormalTok{(}\KeywordTok{as.numeric}\NormalTok{(}\KeywordTok{paste0}\NormalTok{(y[,}\DecValTok{1}\NormalTok{],}\StringTok{"."}\NormalTok{,y[,}\DecValTok{2}\NormalTok{])),}
                                            \KeywordTok{as.numeric}\NormalTok{(y[,}\DecValTok{3}\NormalTok{]}\OperatorTok{+}\NormalTok{y[,}\DecValTok{4}\NormalTok{]}\OperatorTok{*}\DecValTok{10}\OperatorTok{^}\NormalTok{(}\OperatorTok{-}\DecValTok{4}\NormalTok{)))))}
  
\NormalTok{  ##introduzco las velocidades del experimento piloto: Vel}
\NormalTok{  processed_file <-}\KeywordTok{as.data.frame}\NormalTok{( }\KeywordTok{cbind}\NormalTok{(rpm[}\DecValTok{1}\NormalTok{],speed_mean, volts_amps[}\DecValTok{1}\NormalTok{], volts_amps[}\DecValTok{2}\NormalTok{]))}
  \KeywordTok{names}\NormalTok{(processed_file)<-}\StringTok{ }\KeywordTok{c}\NormalTok{(}\StringTok{"RPM"}\NormalTok{,}\StringTok{"m/s"}\NormalTok{,}\StringTok{"V"}\NormalTok{, }\StringTok{"A"}\NormalTok{)}
  
  \KeywordTok{return}\NormalTok{(processed_file)}
\NormalTok{\}}
\NormalTok{df_mutate<-}\ControlFlowTok{function}\NormalTok{(tabla_cruda)\{}
\NormalTok{  df<-}\StringTok{ }\NormalTok{tabla_cruda}
\NormalTok{  df }\OperatorTok{%<>%}\StringTok{ }\KeywordTok{mutate}\NormalTok{(}\DataTypeTok{experimento=} \KeywordTok{factor}\NormalTok{( }
    \KeywordTok{ifelse}\NormalTok{(}\KeywordTok{str_detect}\NormalTok{(archivos, }\StringTok{'concentrador'}\NormalTok{), }\StringTok{'concentrador'}\NormalTok{,}
           \KeywordTok{ifelse}\NormalTok{(}\KeywordTok{str_detect}\NormalTok{(archivos, }\StringTok{'piloto'}\NormalTok{), }\StringTok{'piloto'}\NormalTok{,}\StringTok{'pared'}\NormalTok{)}
\NormalTok{    ) }
\NormalTok{  )}
\NormalTok{  )}
\NormalTok{  df }\OperatorTok{%<>%}\StringTok{ }\KeywordTok{mutate}\NormalTok{(}\DataTypeTok{angulo=}  \KeywordTok{str_extract}\NormalTok{(archivos,}\DataTypeTok{pattern =} \StringTok{"concentrador/[0-9]+"}\NormalTok{) ) }\OperatorTok{%>%}\StringTok{ }
\StringTok{    }\KeywordTok{mutate}\NormalTok{(}\DataTypeTok{angulo =}  \KeywordTok{factor}\NormalTok{(}\KeywordTok{str_remove}\NormalTok{(angulo,}\DataTypeTok{pattern =} \StringTok{"concentrador/"}\NormalTok{) ),}
           \DataTypeTok{porcentaje=}\KeywordTok{str_extract}\NormalTok{(archivos, }\DataTypeTok{pattern =} \StringTok{"prueba_[0-9]+"}\NormalTok{)) }\OperatorTok{%>%}\StringTok{ }
\StringTok{    }\KeywordTok{mutate}\NormalTok{(}\DataTypeTok{porcentaje=}\KeywordTok{factor}\NormalTok{(}\KeywordTok{str_remove}\NormalTok{(porcentaje,}\DataTypeTok{pattern =} \StringTok{"prueba_"}\NormalTok{))) }\OperatorTok{%>%}\StringTok{ }
\StringTok{    }\KeywordTok{mutate}\NormalTok{(}\DataTypeTok{resistencia=}\KeywordTok{str_extract}\NormalTok{(archivos, }\DataTypeTok{pattern =} \StringTok{"[0-9]+.csv"}\NormalTok{)) }\OperatorTok{%>%}\StringTok{ }
\StringTok{    }\KeywordTok{mutate}\NormalTok{(}\DataTypeTok{resistencia=}\KeywordTok{factor}\NormalTok{(}\KeywordTok{str_remove}\NormalTok{(resistencia,}\DataTypeTok{pattern =} \StringTok{".csv"}\NormalTok{)), }
           \DataTypeTok{watts =}\NormalTok{ V}\OperatorTok{*}\NormalTok{A,}
           \DataTypeTok{wind_power =} \FloatTok{0.5}\OperatorTok{*}\FloatTok{1.2}\OperatorTok{*}\FloatTok{0.27}\OperatorTok{*}\FloatTok{0.45}\OperatorTok{*}\NormalTok{(}\StringTok{`}\DataTypeTok{m/s}\StringTok{`}\NormalTok{)}\OperatorTok{^}\DecValTok{3}\NormalTok{,}
           \DataTypeTok{TSR =}\NormalTok{ RPM}\OperatorTok{*}\DecValTok{2}\OperatorTok{*}\NormalTok{pi}\OperatorTok{*}\NormalTok{r}\OperatorTok{/}\DecValTok{60}\OperatorTok{/}\StringTok{`}\DataTypeTok{m/s}\StringTok{`}\NormalTok{,}
           \DataTypeTok{cp =}\NormalTok{ watts}\OperatorTok{/}\NormalTok{wind_power)}
  
 
  
\NormalTok{  df}\OperatorTok{%<>%}\StringTok{ }\KeywordTok{mutate}\NormalTok{(}\DataTypeTok{V_viento_correcion=} \KeywordTok{ifelse}\NormalTok{(df}\OperatorTok{$}\NormalTok{experimento }\OperatorTok{!=}\StringTok{ "piloto"}\NormalTok{, (df}\OperatorTok{$}\StringTok{`}\DataTypeTok{m/s}\StringTok{`}\NormalTok{)}\OperatorTok{/}\FloatTok{0.7}\NormalTok{, df}\OperatorTok{$}\StringTok{`}\DataTypeTok{m/s}\StringTok{`}\NormalTok{))}
\NormalTok{  df}\OperatorTok{%<>%}\StringTok{ }\KeywordTok{mutate}\NormalTok{(}\DataTypeTok{wind_power_correccion =} \FloatTok{0.5}\OperatorTok{*}\FloatTok{1.2}\OperatorTok{*}\FloatTok{0.27}\OperatorTok{*}\FloatTok{0.45}\OperatorTok{*}\NormalTok{(df}\OperatorTok{$}\NormalTok{V_viento_correcion)}\OperatorTok{^}\DecValTok{3}\NormalTok{,}
                \DataTypeTok{TSR_correc =}\NormalTok{ RPM}\OperatorTok{*}\DecValTok{2}\OperatorTok{*}\NormalTok{pi}\OperatorTok{*}\NormalTok{r}\OperatorTok{/}\DecValTok{60}\OperatorTok{/}\NormalTok{df}\OperatorTok{$}\NormalTok{V_viento_correcion,}
                \DataTypeTok{cp_correc =}\NormalTok{ watts}\OperatorTok{/}\NormalTok{wind_power_correccion)}
  
  
\NormalTok{  df}\OperatorTok{%<>%}\StringTok{ }\KeywordTok{mutate}\NormalTok{(}\DataTypeTok{V_viento_alfa=} \KeywordTok{ifelse}\NormalTok{(df}\OperatorTok{$}\NormalTok{experimento }\OperatorTok{!=}\StringTok{ "piloto"}\NormalTok{, ((df}\OperatorTok{$}\StringTok{`}\DataTypeTok{m/s}\StringTok{`}\NormalTok{)}\OperatorTok{/}\FloatTok{0.7}\NormalTok{)}\OperatorTok{/}\FloatTok{1.85}\NormalTok{,( df}\OperatorTok{$}\StringTok{`}\DataTypeTok{m/s}\StringTok{`}\NormalTok{)}\OperatorTok{/}\FloatTok{1.85}\NormalTok{))}
\NormalTok{  df}\OperatorTok{%<>%}\StringTok{ }\KeywordTok{mutate}\NormalTok{(}\DataTypeTok{wind_power_alfa =} \FloatTok{0.5}\OperatorTok{*}\FloatTok{1.2}\OperatorTok{*}\FloatTok{0.50}\OperatorTok{*}\FloatTok{0.45}\OperatorTok{*}\NormalTok{(df}\OperatorTok{$}\NormalTok{V_viento_alfa)}\OperatorTok{^}\DecValTok{3}\NormalTok{,}
                \DataTypeTok{TSR_alfa =}\NormalTok{ RPM}\OperatorTok{*}\DecValTok{2}\OperatorTok{*}\NormalTok{pi}\OperatorTok{*}\NormalTok{r}\OperatorTok{/}\DecValTok{60}\OperatorTok{/}\NormalTok{df}\OperatorTok{$}\NormalTok{V_viento_alfa,}\DataTypeTok{watts_alfa=}\NormalTok{watts}\OperatorTok{/}\FloatTok{1.85}\NormalTok{,}
                \DataTypeTok{cp_alfa =}\NormalTok{ watts_alfa}\OperatorTok{/}\NormalTok{wind_power_alfa)}
  
  
  

  
  \KeywordTok{return}\NormalTok{(df)}
  
\NormalTok{\}}
\end{Highlighting}
\end{Shaded}

Funciones para realizar la correción de los datos de velocidad de giro
del aerogenerador.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{ajuste_RPM_Resistencia_so<-}\StringTok{ }\ControlFlowTok{function}\NormalTok{(df,tabla_sinout)\{}
\NormalTok{  group_number<-}\KeywordTok{length}\NormalTok{(}\KeywordTok{attr}\NormalTok{(}\KeywordTok{group_by}\NormalTok{(df,experimento,angulo,porcentaje), }\StringTok{"group"}\NormalTok{))}
\NormalTok{  r<-}\StringTok{ }\NormalTok{(}\OperatorTok{-}\DecValTok{2}\NormalTok{)}
  
  
\NormalTok{  lista_rpm_resistencia<-}\StringTok{ }\KeywordTok{list}\NormalTok{()}
\NormalTok{  nombres_lista<-}\StringTok{ }\KeywordTok{vector}\NormalTok{()}
\NormalTok{  titulos_grafico<-}\StringTok{ }\KeywordTok{vector}\NormalTok{()}
\NormalTok{  tabladenombres<-}\StringTok{ }\KeywordTok{matrix}\NormalTok{(}\OperatorTok{-}\DecValTok{31}\NormalTok{,}\DataTypeTok{ncol =} \DecValTok{3}\NormalTok{, }\DataTypeTok{nrow =}\NormalTok{ group_number)}
  \ControlFlowTok{for}\NormalTok{ (grupos }\ControlFlowTok{in} \DecValTok{1}\OperatorTok{:}\NormalTok{group_number) \{}
\NormalTok{    grupos_rpm_resistencia<-}\StringTok{ }\NormalTok{df }\OperatorTok{%>%}\StringTok{ }\KeywordTok{group_by}\NormalTok{(.,experimento,angulo,porcentaje) }\OperatorTok{%>%}\StringTok{ }\KeywordTok{select_groups}\NormalTok{(grupos)}
    
\NormalTok{    tabla_resistencia_rpm<-}\StringTok{ }\KeywordTok{as.data.frame}\NormalTok{(}\KeywordTok{cbind}\NormalTok{(}\KeywordTok{as.numeric}\NormalTok{(grupos_rpm_resistencia}\OperatorTok{$}\NormalTok{RPM),}\KeywordTok{as.data.frame}\NormalTok{(grupos_rpm_resistencia}\OperatorTok{$}\NormalTok{resistencia)))}
    \KeywordTok{colnames}\NormalTok{(tabla_resistencia_rpm)<-}\StringTok{ }\KeywordTok{c}\NormalTok{(}\StringTok{"RPM"}\NormalTok{, }\StringTok{"Omhnios"}\NormalTok{)}
    
\NormalTok{    nombre_tabla<-}\StringTok{ }\KeywordTok{unique}\NormalTok{(}\KeywordTok{paste}\NormalTok{(grupos_rpm_resistencia}\OperatorTok{$}\NormalTok{experimento,grupos_rpm_resistencia}\OperatorTok{$}\NormalTok{angulo,grupos_rpm_resistencia}\OperatorTok{$}\NormalTok{porcentaje,}\DataTypeTok{sep =} \StringTok{"_"}\NormalTok{))}
    
    \ControlFlowTok{if}\NormalTok{(}\KeywordTok{is.na}\NormalTok{(grupos_rpm_resistencia}\OperatorTok{$}\NormalTok{angulo))\{}
\NormalTok{      titulo_graph<-}\StringTok{ }\KeywordTok{unique}\NormalTok{(}\KeywordTok{paste0}\NormalTok{(grupos_rpm_resistencia}\OperatorTok{$}\NormalTok{experimento,}\StringTok{"-"}\NormalTok{,grupos_rpm_resistencia}\OperatorTok{$}\NormalTok{porcentaje,}\StringTok{"%"}\NormalTok{))}
\NormalTok{    \}}\ControlFlowTok{else}\NormalTok{\{}
\NormalTok{      titulo_graph<-}\StringTok{ }\KeywordTok{unique}\NormalTok{(}\KeywordTok{paste0}\NormalTok{(grupos_rpm_resistencia}\OperatorTok{$}\NormalTok{experimento,}\StringTok{"-"}\NormalTok{,grupos_rpm_resistencia}\OperatorTok{$}\NormalTok{angulo,}\StringTok{"º-"}\NormalTok{,grupos_rpm_resistencia}\OperatorTok{$}\NormalTok{porcentaje,}\StringTok{"%"}\NormalTok{))}
\NormalTok{    \}}
\NormalTok{    titulos_grafico[grupos]<-}\StringTok{ }\NormalTok{titulo_graph}
\NormalTok{    lista_rpm_resistencia[[grupos]]<-}\StringTok{ }\NormalTok{tabla_resistencia_rpm}
\NormalTok{    nombres_lista[grupos]<-}\StringTok{ }\NormalTok{nombre_tabla}
\NormalTok{    tabladenombres[grupos,}\DecValTok{1}\NormalTok{]<-}\KeywordTok{as.character}\NormalTok{(grupos_rpm_resistencia}\OperatorTok{$}\NormalTok{experimento[}\DecValTok{1}\NormalTok{])}
\NormalTok{    tabladenombres[grupos,}\DecValTok{2}\NormalTok{]<-}\StringTok{ }\KeywordTok{as.character}\NormalTok{(grupos_rpm_resistencia}\OperatorTok{$}\NormalTok{angulo[}\DecValTok{1}\NormalTok{])}
\NormalTok{    tabladenombres[grupos,}\DecValTok{3}\NormalTok{]<-}\StringTok{ }\KeywordTok{as.character}\NormalTok{(grupos_rpm_resistencia}\OperatorTok{$}\NormalTok{porcentaje[}\DecValTok{1}\NormalTok{])}
\NormalTok{  \}}
  
\NormalTok{  ordenando<-}\StringTok{ }\ControlFlowTok{function}\NormalTok{(ordenando)\{}
    \KeywordTok{return}\NormalTok{(ordenando[}\KeywordTok{order}\NormalTok{(}\KeywordTok{as.numeric}\NormalTok{(}\KeywordTok{as.character}\NormalTok{(ordenando}\OperatorTok{$}\NormalTok{Omhnios))),] ) }
\NormalTok{  \}}
\NormalTok{  lista_rpm_resistencia_ordenada<-}\KeywordTok{lapply}\NormalTok{(lista_rpm_resistencia, ordenando)}
  
  
\NormalTok{  lista_coef<-}\KeywordTok{list}\NormalTok{()}
  \ControlFlowTok{for}\NormalTok{ (pruebas }\ControlFlowTok{in} \DecValTok{1}\OperatorTok{:}\KeywordTok{length}\NormalTok{(lista_rpm_resistencia_ordenada)) \{}
    \KeywordTok{dir.create}\NormalTok{(}\KeywordTok{paste0}\NormalTok{(}\KeywordTok{here}\NormalTok{(),}\StringTok{"/graficos_RPM_Resistencia_sinout/"}\NormalTok{))}
    
    \CommentTok{#jpeg(paste0(here(),"/graficos_RPM_Resistencia/",nombres_lista[pruebas],".jpeg"))}
    \KeywordTok{tiff}\NormalTok{(}\KeywordTok{paste0}\NormalTok{(}\KeywordTok{here}\NormalTok{(),}\StringTok{"/graficos_RPM_Resistencia/"}\NormalTok{,nombres_lista[pruebas],}\StringTok{".tiff"}\NormalTok{), }\DataTypeTok{width =} \DecValTok{7}\NormalTok{, }\DataTypeTok{height =}\DecValTok{7}\NormalTok{, }\DataTypeTok{units =} \StringTok{'in'}\NormalTok{, }\DataTypeTok{res =} \DecValTok{300}\NormalTok{)}
    
    
    
\NormalTok{    x<-}\KeywordTok{as.numeric}\NormalTok{(}\KeywordTok{as.character}\NormalTok{(lista_rpm_resistencia_ordenada[[pruebas]][,}\DecValTok{2}\NormalTok{]))}
\NormalTok{    x_so<-tabla_sinout[[pruebas]][,}\DecValTok{2}\NormalTok{]}
\NormalTok{    y<-}\StringTok{ }\KeywordTok{as.numeric}\NormalTok{(}\KeywordTok{as.character}\NormalTok{(lista_rpm_resistencia_ordenada[[pruebas]][,}\DecValTok{1}\NormalTok{]))}
\NormalTok{    y_so<-tabla_sinout[[pruebas]][,}\DecValTok{1}\NormalTok{]}
    
    \CommentTok{#dat<-as.data.frame(cbind(tabla_sinout[[pruebas]][,2],tabla_sinout[[pruebas]][,1]))}
    \CommentTok{#names(dat)<- c("x","y")}
    \CommentTok{#f <- function(x,a,b) \{a * exp(b * x)\}}
    \CommentTok{#fm0 <- nls(log(y) ~ log(f(x, a, b)),dat, start = c(a = 1, b = 1))}
    
    \CommentTok{#nls(y_so ~ f(x_so, a, b), start = coef(fm0))}
    
    
\NormalTok{    m<-}\KeywordTok{nls}\NormalTok{(y}\OperatorTok{~}\NormalTok{a}\OperatorTok{*}\NormalTok{x}\OperatorTok{/}\NormalTok{(b}\OperatorTok{+}\NormalTok{x))}
\NormalTok{    m_so_}\DecValTok{1}\NormalTok{<-}\ControlFlowTok{function}\NormalTok{(y_so,x_so)\{}
      \KeywordTok{return}\NormalTok{(}\KeywordTok{nls}\NormalTok{(y_so}\OperatorTok{~}\NormalTok{a}\OperatorTok{*}\NormalTok{x_so}\OperatorTok{/}\NormalTok{(b}\OperatorTok{+}\NormalTok{x_so)))}
\NormalTok{    \}}
\NormalTok{    m_so_}\DecValTok{2}\NormalTok{<-}\ControlFlowTok{function}\NormalTok{(y_so,x_so)\{}
      \KeywordTok{return}\NormalTok{(}\KeywordTok{nlsLM}\NormalTok{(y_so}\OperatorTok{~}\NormalTok{a}\OperatorTok{*}\NormalTok{x_so}\OperatorTok{/}\NormalTok{(b}\OperatorTok{+}\NormalTok{x_so)))}
\NormalTok{    \}}
\NormalTok{    m_so<-}\KeywordTok{tryCatch}\NormalTok{(}\KeywordTok{m_so_1}\NormalTok{(y_so,x_so), }\DataTypeTok{error=}\ControlFlowTok{function}\NormalTok{(e) }\KeywordTok{m_so_2}\NormalTok{(y_so,x_so))}
    
    
    
    
\NormalTok{    coefa_so<-}\KeywordTok{coef}\NormalTok{(m_so)[}\DecValTok{1}\NormalTok{]}
\NormalTok{    coefb_so<-}\StringTok{ }\KeywordTok{coef}\NormalTok{(m_so)[}\DecValTok{2}\NormalTok{]}
\NormalTok{    x_so_seq<-}\StringTok{ }\KeywordTok{seq}\NormalTok{(}\DecValTok{0}\NormalTok{,}\DecValTok{8000}\NormalTok{,}\DataTypeTok{by=}\DecValTok{1}\NormalTok{)}
\NormalTok{    y_so_seq<-}\StringTok{ }\NormalTok{coefa_so}\OperatorTok{*}\NormalTok{x_so_seq}\OperatorTok{/}\NormalTok{(coefb_so}\OperatorTok{+}\NormalTok{x_so_seq)}
    
\NormalTok{    coefa <-}\KeywordTok{coef}\NormalTok{(m)[}\DecValTok{1}\NormalTok{]}
\NormalTok{    coefb <-}\StringTok{ }\KeywordTok{coef}\NormalTok{(m)[}\DecValTok{2}\NormalTok{]}
\NormalTok{    x_seq<-}\StringTok{ }\KeywordTok{seq}\NormalTok{(}\DecValTok{0}\NormalTok{,}\DecValTok{8000}\NormalTok{,}\DataTypeTok{by=}\DecValTok{1}\NormalTok{)}
\NormalTok{    y_seq<-}\StringTok{ }\NormalTok{coefa}\OperatorTok{*}\NormalTok{x_seq}\OperatorTok{/}\NormalTok{(coefb}\OperatorTok{+}\NormalTok{x_seq)}
    
    
    
    
    
    \KeywordTok{plot}\NormalTok{(}\OtherTok{NULL}\NormalTok{,}\DataTypeTok{xlim=}\KeywordTok{c}\NormalTok{(}\DecValTok{0}\NormalTok{,}\DecValTok{8000}\NormalTok{),}
         \DataTypeTok{ylim =} \KeywordTok{c}\NormalTok{(}\DecValTok{0}\NormalTok{,(}\KeywordTok{max}\NormalTok{(y_so_seq)}\OperatorTok{+}\NormalTok{(}\KeywordTok{max}\NormalTok{(y_so_seq))}\OperatorTok{/}\DecValTok{5}\NormalTok{)),}\DataTypeTok{cex=}\FloatTok{0.005}\NormalTok{, }\DataTypeTok{yaxt =}\StringTok{"n"}\NormalTok{,}
         \DataTypeTok{xlab =}  \KeywordTok{expression}\NormalTok{(}\KeywordTok{paste}\NormalTok{(}\StringTok{"Resistencia ("}\NormalTok{,Omega,}\StringTok{")"}\NormalTok{)), }\DataTypeTok{ylab =} \StringTok{"Velocidad Angular (RPM)"}\NormalTok{, }\DataTypeTok{bty=}\StringTok{'L'}\NormalTok{)}
    \KeywordTok{par}\NormalTok{(}\DataTypeTok{new=}\NormalTok{T)}
    \CommentTok{#lines(x,predict(m),lty=2,col="red",lwd=1)}
    \KeywordTok{lines}\NormalTok{(x_seq,y_seq,}\DataTypeTok{lty=}\DecValTok{2}\NormalTok{, }\DataTypeTok{col=}\StringTok{"red"}\NormalTok{,}\DataTypeTok{lwd=}\DecValTok{1}\NormalTok{)}
    \KeywordTok{par}\NormalTok{(}\DataTypeTok{new=}\NormalTok{T)}
    \CommentTok{#lines(x_so,predict(m_so),lty=2,col="blue",lwd=1)}
    \KeywordTok{lines}\NormalTok{(x_so_seq,y_so_seq,}\DataTypeTok{lty=}\DecValTok{2}\NormalTok{,}\DataTypeTok{col=}\StringTok{"blue"}\NormalTok{,}\DataTypeTok{lwd=}\DecValTok{1}\NormalTok{)}
    
    \KeywordTok{points}\NormalTok{(x_so,y_so, }\DataTypeTok{pch=} \DecValTok{4}\NormalTok{, }\DataTypeTok{col=}\StringTok{"blue"}\NormalTok{)}
    
    
    
\NormalTok{    x_dif<-}\KeywordTok{length}\NormalTok{(}\KeywordTok{setdiff}\NormalTok{(x, x_so))}
\NormalTok{    y_dif<-}\KeywordTok{length}\NormalTok{(}\KeywordTok{setdiff}\NormalTok{(}\KeywordTok{round}\NormalTok{(y,r),}\KeywordTok{round}\NormalTok{(y_so,r)))}
    
    
    \ControlFlowTok{while}\NormalTok{(x_dif }\OperatorTok{!=}\StringTok{ }\NormalTok{y_dif)\{}
\NormalTok{      y_dif<-}\KeywordTok{length}\NormalTok{(}\KeywordTok{setdiff}\NormalTok{(}\KeywordTok{round}\NormalTok{(y,r),}\KeywordTok{round}\NormalTok{(y_so,r)))}
\NormalTok{      r<-r}\OperatorTok{+}\DecValTok{1}\NormalTok{\}}
    
    
    \ControlFlowTok{if}\NormalTok{(x_dif}\OperatorTok{==}\NormalTok{y_dif)\{}
      \KeywordTok{points}\NormalTok{(}\KeywordTok{setdiff}\NormalTok{(x, x_so),}\KeywordTok{setdiff}\NormalTok{(}\KeywordTok{round}\NormalTok{(y,r),}\KeywordTok{round}\NormalTok{(y_so,r)), }\DataTypeTok{pch=}\DecValTok{20}\NormalTok{, }\DataTypeTok{col=}\StringTok{"red"}\NormalTok{, }\DataTypeTok{cex=}\FloatTok{1.5}\NormalTok{)}
      
\NormalTok{    \}}
    
    
    
    
    
    
\NormalTok{    subtitle_nom<-}\StringTok{ }\KeywordTok{paste0}\NormalTok{(}\StringTok{"Experimento = "}\NormalTok{,titulos_grafico[pruebas])}
\NormalTok{    maintitle<-}\StringTok{ }\KeywordTok{paste0}\NormalTok{(}\StringTok{"Gráfica Velocidad Angular-Resistencia }\CharTok{\textbackslash{}n}\StringTok{"}\NormalTok{,subtitle_nom)}
    \KeywordTok{par}\NormalTok{(}\DataTypeTok{new=}\NormalTok{T)}
    \KeywordTok{axis}\NormalTok{(}\DecValTok{2}\NormalTok{, }\DataTypeTok{at=}\KeywordTok{seq}\NormalTok{(}\DecValTok{0}\NormalTok{,(}\KeywordTok{max}\NormalTok{(y_so_seq)}\OperatorTok{+}\NormalTok{(}\KeywordTok{max}\NormalTok{(y_so_seq))}\OperatorTok{/}\DecValTok{5}\NormalTok{), }\DataTypeTok{by=}\KeywordTok{round}\NormalTok{((}\KeywordTok{max}\NormalTok{(y_so_seq)}\OperatorTok{+}\NormalTok{(}\KeywordTok{max}\NormalTok{(y_so_seq))}\OperatorTok{/}\DecValTok{5}\NormalTok{)}\OperatorTok{/}\DecValTok{10}\NormalTok{,}\OperatorTok{-}\DecValTok{1}\NormalTok{)),}\DataTypeTok{las=}\DecValTok{2}\NormalTok{)}
    \KeywordTok{title}\NormalTok{(}\DataTypeTok{main =}\NormalTok{ maintitle)}
    
\NormalTok{    R_sinVA<-}\StringTok{ }\KeywordTok{paste0}\NormalTok{(}\StringTok{"Regresión sin VA"}\NormalTok{,}\StringTok{" (Correlación= "}\NormalTok{,}\KeywordTok{as.character}\NormalTok{(}\KeywordTok{round}\NormalTok{(}\KeywordTok{cor}\NormalTok{(y_so,}\KeywordTok{predict}\NormalTok{(m_so)),}\DecValTok{3}\NormalTok{)),}\StringTok{")"}\NormalTok{)}
\NormalTok{    R_conVA<-}\StringTok{ }\KeywordTok{paste0}\NormalTok{(}\StringTok{"Regresión con VA"}\NormalTok{,}\StringTok{" (Correlación= "}\NormalTok{,}\KeywordTok{as.character}\NormalTok{(}\KeywordTok{round}\NormalTok{(}\KeywordTok{cor}\NormalTok{(y,}\KeywordTok{predict}\NormalTok{(m)),}\DecValTok{3}\NormalTok{)),}\StringTok{")"}\NormalTok{)}
    
    
    \KeywordTok{legend}\NormalTok{(}\StringTok{"right"}\NormalTok{, }\DataTypeTok{inset=}\KeywordTok{c}\NormalTok{(}\DecValTok{0}\NormalTok{,}\DecValTok{0}\NormalTok{),}
           \DataTypeTok{legend =} \KeywordTok{c}\NormalTok{(R_sinVA,R_conVA,}\StringTok{"Valores comunes"}\NormalTok{, }\StringTok{"Valores atípicos "}\NormalTok{),}
           \DataTypeTok{pch =} \KeywordTok{c}\NormalTok{(}\OtherTok{NA}\NormalTok{,}\OtherTok{NA}\NormalTok{, }\DecValTok{4}\NormalTok{,}\DecValTok{20}\NormalTok{),}
           \DataTypeTok{lty =} \KeywordTok{c}\NormalTok{(}\DecValTok{2}\NormalTok{,}\DecValTok{2}\NormalTok{,}\OtherTok{NA}\NormalTok{,}\OtherTok{NA}\NormalTok{), }
           \DataTypeTok{col =} \KeywordTok{c}\NormalTok{(}\StringTok{"blue"}\NormalTok{,}\StringTok{"red"}\NormalTok{,}\StringTok{"black"}\NormalTok{,}\StringTok{"red"}\NormalTok{),}\DataTypeTok{ncol =} \DecValTok{1}\NormalTok{,}\DataTypeTok{cex =} \DecValTok{1}\NormalTok{)}
    
    \KeywordTok{dev.off}\NormalTok{()}
    
\NormalTok{    correlacion_sino<-}\KeywordTok{cor}\NormalTok{(y_so,}\KeywordTok{predict}\NormalTok{(m_so))}
\NormalTok{    correlacion_cono<-}\KeywordTok{cor}\NormalTok{(y,}\KeywordTok{predict}\NormalTok{(m))}
    \ControlFlowTok{if}\NormalTok{(correlacion_sino}\OperatorTok{>=}\StringTok{ }\NormalTok{correlacion_cono)\{}
\NormalTok{      aa<-}\StringTok{ }\NormalTok{coefa_so}
\NormalTok{      bb<-}\StringTok{ }\NormalTok{coefb_so}
\NormalTok{    \}}\ControlFlowTok{else}\NormalTok{\{}
\NormalTok{      aa<-}\StringTok{ }\NormalTok{coefa}
\NormalTok{      bb<-coefb}
\NormalTok{    \}}
    
\NormalTok{    coef_tabla<-}\StringTok{ }\KeywordTok{cbind}\NormalTok{(}\KeywordTok{as.character}\NormalTok{(tabladenombres[pruebas,}\DecValTok{1}\NormalTok{]),}\KeywordTok{as.character}\NormalTok{(tabladenombres[pruebas,}\DecValTok{2}\NormalTok{]),}
                       \KeywordTok{as.character}\NormalTok{(tabladenombres[pruebas,}\DecValTok{3}\NormalTok{]),aa,bb)  }
    \KeywordTok{names}\NormalTok{(coef_tabla)<-}\KeywordTok{c}\NormalTok{(}\StringTok{"Experimento"}\NormalTok{,}\StringTok{"Angulo"}\NormalTok{,}\StringTok{"Porcentaje"}\NormalTok{,}\StringTok{"a"}\NormalTok{,}\StringTok{"b"}\NormalTok{)}
    
\NormalTok{    lista_coef[[pruebas]]<-coef_tabla}
    
\NormalTok{  \}}
  
  \KeywordTok{return}\NormalTok{(lista_coef) }
  
\NormalTok{\}}
\NormalTok{add_coef<-}\ControlFlowTok{function}\NormalTok{(df,coeficientes_RPM)\{}
\NormalTok{  df }\OperatorTok{%<>%}\StringTok{ }\KeywordTok{mutate}\NormalTok{(}\DataTypeTok{coef_a=} \OperatorTok{-}\DecValTok{31}\NormalTok{,}\DataTypeTok{coef_b=}\OperatorTok{-}\DecValTok{31}\NormalTok{)}
\NormalTok{  vector_logico<-}\StringTok{ }\KeywordTok{list}\NormalTok{()}
  \ControlFlowTok{for}\NormalTok{ (i }\ControlFlowTok{in} \DecValTok{1}\OperatorTok{:}\KeywordTok{length}\NormalTok{(coeficientes_RPM[,}\DecValTok{1}\NormalTok{])) \{}
    \ControlFlowTok{if}\NormalTok{(coeficientes_RPM[i,}\DecValTok{1}\NormalTok{]}\OperatorTok{==}\StringTok{"concentrador"}\NormalTok{)\{}
\NormalTok{      vector_logico[[i]]<-}\StringTok{ }\KeywordTok{c}\NormalTok{(coeficientes_RPM[i,}\DecValTok{1}\NormalTok{]}\OperatorTok{==}\NormalTok{df}\OperatorTok{$}\NormalTok{experimento }\OperatorTok{&}\StringTok{ }\NormalTok{coeficientes_RPM[i,}\DecValTok{2}\NormalTok{]}\OperatorTok{==}\NormalTok{df}\OperatorTok{$}\NormalTok{angulo }\OperatorTok{&}\StringTok{ }\NormalTok{coeficientes_RPM[i,}\DecValTok{3}\NormalTok{]}\OperatorTok{==}\NormalTok{df}\OperatorTok{$}\NormalTok{porcentaje)}
      
\NormalTok{    \}}\ControlFlowTok{else}\NormalTok{\{}
\NormalTok{      vector_logico[[i]]<-}\StringTok{ }\KeywordTok{c}\NormalTok{(coeficientes_RPM[i,}\DecValTok{1}\NormalTok{]}\OperatorTok{==}\NormalTok{df}\OperatorTok{$}\NormalTok{experimento }\OperatorTok{&}\StringTok{ }\NormalTok{coeficientes_RPM[i,}\DecValTok{3}\NormalTok{]}\OperatorTok{==}\NormalTok{df}\OperatorTok{$}\NormalTok{porcentaje)}
      
\NormalTok{    \}}
\NormalTok{  \}}
  \ControlFlowTok{for}\NormalTok{ (j }\ControlFlowTok{in} \DecValTok{1}\OperatorTok{:}\KeywordTok{length}\NormalTok{(vector_logico)) \{}
\NormalTok{    df }\OperatorTok{%<>%}\StringTok{ }\KeywordTok{mutate}\NormalTok{(}\DataTypeTok{coef_a=}\KeywordTok{replace}\NormalTok{(coef_a, vector_logico[[j]],}\KeywordTok{as.numeric}\NormalTok{(}\KeywordTok{as.character}\NormalTok{( coeficientes_RPM[j,}\DecValTok{4}\NormalTok{]))),}
                   \DataTypeTok{coef_b=}\KeywordTok{replace}\NormalTok{(coef_b, vector_logico[[j]],}\KeywordTok{as.numeric}\NormalTok{(}\KeywordTok{as.character}\NormalTok{( coeficientes_RPM[j,}\DecValTok{5}\NormalTok{]))))}
\NormalTok{  \}}
  
\NormalTok{  df }\OperatorTok{%<>%}\StringTok{ }\KeywordTok{mutate}\NormalTok{(}\DataTypeTok{RPM_regresion=}\NormalTok{ (}\KeywordTok{as.numeric}\NormalTok{(}\KeywordTok{as.character}\NormalTok{(coef_a)) }\OperatorTok{*}\KeywordTok{as.numeric}\NormalTok{(}\KeywordTok{as.character}\NormalTok{(resistencia)))}\OperatorTok{/}\NormalTok{(}\KeywordTok{as.numeric}\NormalTok{(}\KeywordTok{as.character}\NormalTok{(coef_b))}\OperatorTok{+}\KeywordTok{as.numeric}\NormalTok{(}\KeywordTok{as.character}\NormalTok{(resistencia))))}
\NormalTok{  df }\OperatorTok{%<>%}\StringTok{ }\KeywordTok{mutate}\NormalTok{(}\DataTypeTok{diff_rpm=}\NormalTok{RPM}\OperatorTok{-}\NormalTok{RPM_regresion, }\DataTypeTok{TSR_regresion_est =}\NormalTok{ RPM_regresion}\OperatorTok{*}\DecValTok{2}\OperatorTok{*}\NormalTok{pi}\OperatorTok{*}\NormalTok{r}\OperatorTok{/}\DecValTok{60}\OperatorTok{/}\NormalTok{Vviento_estandar,}\DataTypeTok{TSR_regresion_lectura =}\NormalTok{ RPM_regresion}\OperatorTok{*}\DecValTok{2}\OperatorTok{*}\NormalTok{pi}\OperatorTok{*}\NormalTok{r}\OperatorTok{/}\DecValTok{60}\OperatorTok{/}\StringTok{`}\DataTypeTok{m/s}\StringTok{`}\NormalTok{)}
\NormalTok{  df }\OperatorTok{%<>%}\StringTok{ }\KeywordTok{mutate}\NormalTok{(}\DataTypeTok{TSR_regresion_corr =}\NormalTok{ RPM_regresion}\OperatorTok{*}\DecValTok{2}\OperatorTok{*}\NormalTok{pi}\OperatorTok{*}\NormalTok{r}\OperatorTok{/}\DecValTok{60}\OperatorTok{/}\NormalTok{V_viento_correcion)}
  
  
\NormalTok{\}}
\end{Highlighting}
\end{Shaded}

Funciones para realizar los ploteos de las gráficas de potencia y Cp.

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{#Ploteos de curvas Cp-lambda de cada experimento}
\NormalTok{ploteo_experimento_corr_RPM_regresion<-}\StringTok{ }\ControlFlowTok{function}\NormalTok{(datos,grados)\{}
\NormalTok{  df<-datos}
  
\NormalTok{  select_groups <-}\StringTok{ }\ControlFlowTok{function}\NormalTok{(data, groups) \{}
\NormalTok{    data[}\KeywordTok{sort}\NormalTok{(}\KeywordTok{unlist}\NormalTok{(}\KeywordTok{attr}\NormalTok{(data, }\StringTok{"indices"}\NormalTok{)[ groups ])) }\OperatorTok{+}\StringTok{ }\DecValTok{1}\NormalTok{, ]}
\NormalTok{  \}}
  
\NormalTok{  group_number<-}\KeywordTok{length}\NormalTok{(}\KeywordTok{attr}\NormalTok{(}\KeywordTok{group_by}\NormalTok{(df,experimento,angulo), }\StringTok{"group"}\NormalTok{))}
  \ControlFlowTok{for}\NormalTok{ (groups_ind }\ControlFlowTok{in} \DecValTok{1}\OperatorTok{:}\NormalTok{group_number) \{}
    
\NormalTok{    xx<-}\StringTok{ }\NormalTok{df }\OperatorTok{%>%}\StringTok{ }\KeywordTok{group_by}\NormalTok{(.,experimento,angulo) }\OperatorTok{%>%}\StringTok{ }\KeywordTok{select_groups}\NormalTok{(groups_ind)}
\NormalTok{    nombre_}\DecValTok{1}\NormalTok{<-}\KeywordTok{as.character}\NormalTok{(xx}\OperatorTok{$}\NormalTok{experimento[}\DecValTok{1}\NormalTok{])}
\NormalTok{    nombre_}\DecValTok{2}\NormalTok{<-}\KeywordTok{as.character}\NormalTok{(xx}\OperatorTok{$}\NormalTok{angulo[}\DecValTok{1}\NormalTok{])}
\NormalTok{    nombre<-}\KeywordTok{paste}\NormalTok{(nombre_}\DecValTok{1}\NormalTok{,nombre_}\DecValTok{2}\NormalTok{,}\DataTypeTok{sep =} \StringTok{"_"}\NormalTok{)}
    
    \ControlFlowTok{if}\NormalTok{(}\KeywordTok{is.na}\NormalTok{(nombre_}\DecValTok{2}\NormalTok{))\{}
\NormalTok{      nombre_grafica<-}\StringTok{ }\NormalTok{nombre_}\DecValTok{1}
\NormalTok{    \}}\ControlFlowTok{else}\NormalTok{\{}
\NormalTok{      nombre_grafica<-}\KeywordTok{paste}\NormalTok{(nombre_}\DecValTok{1}\NormalTok{,}\StringTok{" "}\NormalTok{,nombre_}\DecValTok{2}\NormalTok{,}\StringTok{"º"}\NormalTok{,}\DataTypeTok{sep =} \StringTok{""}\NormalTok{)}
\NormalTok{    \}}
    
\NormalTok{    percentaje_number<-}\KeywordTok{length}\NormalTok{(}\KeywordTok{attr}\NormalTok{(}\KeywordTok{group_by}\NormalTok{(xx,porcentaje), }\StringTok{"group"}\NormalTok{) )}
\NormalTok{    xx_percentaje<-}\KeywordTok{list}\NormalTok{()}
    \ControlFlowTok{for}\NormalTok{ (per }\ControlFlowTok{in} \DecValTok{1}\OperatorTok{:}\NormalTok{percentaje_number) \{}
\NormalTok{      xx_perc<-}\StringTok{ }\NormalTok{xx }\OperatorTok{%>%}\StringTok{ }\KeywordTok{group_by}\NormalTok{(.,porcentaje) }\OperatorTok{%>%}\StringTok{ }\KeywordTok{select_groups}\NormalTok{(per)}
\NormalTok{      xx_perc<-}\KeywordTok{cbind}\NormalTok{(xx_perc}\OperatorTok{$}\NormalTok{cp_correc,xx_perc}\OperatorTok{$}\NormalTok{TSR_regresion_corr,xx_perc}\OperatorTok{$}\NormalTok{V_viento_correcion)}
      \KeywordTok{colnames}\NormalTok{(xx_perc)<-}\StringTok{ }\KeywordTok{c}\NormalTok{(}\StringTok{"cp"}\NormalTok{,}\StringTok{"TSR"}\NormalTok{, }\StringTok{"Vviento"}\NormalTok{)}
\NormalTok{      xx_percentaje[[per]]<-}\StringTok{ }\NormalTok{xx_perc}
      
\NormalTok{    \}}
    
    
    
    
\NormalTok{    ##lambda_cp es una tabla de dos columnas (cp,lambda) }
\NormalTok{    lambda_Cp<-}\StringTok{ }\NormalTok{xx_percentaje}
\NormalTok{    lambda_Cp_clean<-}\KeywordTok{list}\NormalTok{()}
    \ControlFlowTok{for}\NormalTok{(j }\ControlFlowTok{in} \DecValTok{1}\OperatorTok{:}\KeywordTok{length}\NormalTok{(lambda_Cp))\{}
\NormalTok{      cp_lmb<-}\StringTok{ }\NormalTok{lambda_Cp[[j]]}
\NormalTok{      cp_lmb<-cp_lmb[}\KeywordTok{order}\NormalTok{(cp_lmb[,}\DecValTok{2}\NormalTok{]),]}
      
      
\NormalTok{      TSR_}\DecValTok{1}\NormalTok{<-cp_lmb[,}\DecValTok{2}\NormalTok{]}
\NormalTok{      Cp_}\DecValTok{1}\NormalTok{<-cp_lmb[,}\DecValTok{1}\NormalTok{]}
      
\NormalTok{      V_tsr<-}\StringTok{ }\KeywordTok{seq}\NormalTok{(}\FloatTok{0.05}\NormalTok{,}\KeywordTok{max}\NormalTok{(TSR_}\DecValTok{1}\NormalTok{),}\DataTypeTok{by=}\KeywordTok{max}\NormalTok{(TSR_}\DecValTok{1}\NormalTok{)}\OperatorTok{/}\DecValTok{8}\NormalTok{)}
\NormalTok{      TSR_}\DecValTok{2}\NormalTok{<-}\StringTok{ }\KeywordTok{vector}\NormalTok{()}
\NormalTok{      Cp_}\DecValTok{2}\NormalTok{<-}\StringTok{ }\KeywordTok{vector}\NormalTok{()}
      
      \ControlFlowTok{for}\NormalTok{(i }\ControlFlowTok{in} \DecValTok{1}\OperatorTok{:}\KeywordTok{length}\NormalTok{(V_tsr))\{}
        
\NormalTok{        Cp_}\DecValTok{2}\NormalTok{[i]<-}\StringTok{ }\NormalTok{Cp_}\DecValTok{1}\NormalTok{[}\KeywordTok{which.min}\NormalTok{(}\KeywordTok{abs}\NormalTok{(TSR_}\DecValTok{1}\OperatorTok{-}\NormalTok{V_tsr[i]))]}
\NormalTok{        TSR_}\DecValTok{2}\NormalTok{[i]<-TSR_}\DecValTok{1}\NormalTok{[}\KeywordTok{which.min}\NormalTok{(}\KeywordTok{abs}\NormalTok{(TSR_}\DecValTok{1}\OperatorTok{-}\NormalTok{V_tsr[i]))]}
        
\NormalTok{      \}}
\NormalTok{      validacion<-}\KeywordTok{cbind}\NormalTok{(}\KeywordTok{unique}\NormalTok{(Cp_}\DecValTok{2}\NormalTok{),}\KeywordTok{unique}\NormalTok{(TSR_}\DecValTok{2}\NormalTok{))}
\NormalTok{      validacion_}\DecValTok{1}\NormalTok{<-}\StringTok{ }\NormalTok{validacion[}\DecValTok{1}\OperatorTok{:}\KeywordTok{which.max}\NormalTok{(validacion[,}\DecValTok{1}\NormalTok{]),]}
\NormalTok{      validacion_}\DecValTok{2}\NormalTok{<-}\StringTok{ }\NormalTok{validacion[(}\KeywordTok{which.max}\NormalTok{(validacion[,}\DecValTok{1}\NormalTok{])}\OperatorTok{+}\DecValTok{1}\NormalTok{)}\OperatorTok{:}\KeywordTok{length}\NormalTok{(validacion[,}\DecValTok{1}\NormalTok{]),]}
\NormalTok{      indeeex<-}\StringTok{ }\KeywordTok{vector}\NormalTok{()}
\NormalTok{      rr<-}\StringTok{ }\DecValTok{1} 
      \ControlFlowTok{if}\NormalTok{(}\KeywordTok{length}\NormalTok{(validacion_}\DecValTok{2}\NormalTok{)}\OperatorTok{==}\DecValTok{2}\NormalTok{)\{}
\NormalTok{        validacion_}\DecValTok{2}\NormalTok{<-}\StringTok{ }\NormalTok{validacion_}\DecValTok{2}
\NormalTok{      \}}\ControlFlowTok{else}\NormalTok{\{}
        \ControlFlowTok{for}\NormalTok{ (i }\ControlFlowTok{in} \DecValTok{1}\OperatorTok{:}\KeywordTok{length}\NormalTok{(validacion_}\DecValTok{2}\NormalTok{[,}\DecValTok{1}\NormalTok{])) \{}
          
          
          \ControlFlowTok{if}\NormalTok{(i}\OperatorTok{==}\KeywordTok{length}\NormalTok{(validacion_}\DecValTok{2}\NormalTok{[,}\DecValTok{1}\NormalTok{]))\{}\ControlFlowTok{break}\NormalTok{\}}\ControlFlowTok{else}\NormalTok{\{}
            
            \ControlFlowTok{if}\NormalTok{(validacion_}\DecValTok{2}\NormalTok{[i,}\DecValTok{1}\NormalTok{] }\OperatorTok{<}\StringTok{ }\NormalTok{validacion_}\DecValTok{2}\NormalTok{[(i}\OperatorTok{+}\DecValTok{1}\NormalTok{),}\DecValTok{1}\NormalTok{])\{}
\NormalTok{              indeeex[rr]<-}\StringTok{ }\KeywordTok{as.numeric}\NormalTok{(i) }
\NormalTok{              rr<-rr}\OperatorTok{+}\DecValTok{1}
              
              
\NormalTok{            \}}
            
\NormalTok{          \}}
\NormalTok{        \}}
        
\NormalTok{      \}}
      
      \ControlFlowTok{if}\NormalTok{(}\KeywordTok{length}\NormalTok{(indeeex)}\OperatorTok{==}\DecValTok{0}\NormalTok{)\{}
\NormalTok{        validacion_}\DecValTok{2}\NormalTok{<-}\StringTok{ }\NormalTok{validacion_}\DecValTok{2}
\NormalTok{      \}}\ControlFlowTok{else}\NormalTok{\{}
\NormalTok{        validacion_}\DecValTok{2}\NormalTok{<-validacion_}\DecValTok{2}\NormalTok{[}\OperatorTok{-}\NormalTok{indeeex,]}
\NormalTok{      \}}
      
\NormalTok{      clean_table<-}\KeywordTok{rbind}\NormalTok{(validacion_}\DecValTok{1}\NormalTok{,validacion_}\DecValTok{2}\NormalTok{)}
      
      
\NormalTok{      lambda_Cp_clean[[j]]<-}\StringTok{ }\NormalTok{clean_table}
      
\NormalTok{    \}}
    
    
    
    
    
    
    \KeywordTok{dir.create}\NormalTok{(}\KeywordTok{paste0}\NormalTok{(}\KeywordTok{here}\NormalTok{(),}\StringTok{"/graficos_RPMreg_corr_fit"}\NormalTok{,grados,}\StringTok{"/"}\NormalTok{))}
    
    \CommentTok{#jpeg(paste0(here(),"/graficos_RPMreg_media_fit",grados,"/",nombre,".jpeg"))}
    \KeywordTok{tiff}\NormalTok{(}\KeywordTok{paste0}\NormalTok{(}\KeywordTok{here}\NormalTok{(),}\StringTok{"/graficos_RPMreg_corr_fit"}\NormalTok{,grados,}\StringTok{"/"}\NormalTok{,nombre,}\StringTok{".tiff"}\NormalTok{), }\DataTypeTok{width =} \DecValTok{7}\NormalTok{, }\DataTypeTok{height =}\DecValTok{7}\NormalTok{, }\DataTypeTok{units =} \StringTok{'in'}\NormalTok{, }\DataTypeTok{res =} \DecValTok{300}\NormalTok{)}
    
    
    
    
\NormalTok{    lambda_Cp<-}\StringTok{ }\NormalTok{lambda_Cp_clean}
\NormalTok{    colores<-}\StringTok{ }\KeywordTok{c}\NormalTok{(}\StringTok{"orange"}\NormalTok{,}\StringTok{"red"}\NormalTok{,}\StringTok{"blue"}\NormalTok{,}\StringTok{"dodgerblue4"}\NormalTok{,}\StringTok{"purple"}\NormalTok{,}\StringTok{"black"}\NormalTok{)}
\NormalTok{    pch_dif<-}\KeywordTok{c}\NormalTok{(}\DecValTok{0}\OperatorTok{:}\DecValTok{5}\NormalTok{)}
    
    \ControlFlowTok{for}\NormalTok{(i }\ControlFlowTok{in} \DecValTok{1}\OperatorTok{:}\KeywordTok{length}\NormalTok{(lambda_Cp))\{}
      \CommentTok{#en caso de que sea mejor añadir el origen}
      \CommentTok{#x<- c(0,lambda_Cp[[i]][,2])}
      \CommentTok{#y<- c(0,lambda_Cp[[i]][,1])}
\NormalTok{      x<-}\StringTok{ }\NormalTok{lambda_Cp[[i]][,}\DecValTok{2}\NormalTok{]}
\NormalTok{      y<-}\StringTok{ }\NormalTok{lambda_Cp[[i]][,}\DecValTok{1}\NormalTok{]}
\NormalTok{      fit5<-}\KeywordTok{lm}\NormalTok{(y}\OperatorTok{~}\KeywordTok{poly}\NormalTok{(x,grados,}\DataTypeTok{raw=}\OtherTok{TRUE}\NormalTok{))}
\NormalTok{      xx <-}\StringTok{ }\KeywordTok{seq}\NormalTok{(}\KeywordTok{min}\NormalTok{(x),}\KeywordTok{max}\NormalTok{(x), }\DataTypeTok{by=}\FloatTok{0.01}\NormalTok{)}
      
      \KeywordTok{plot}\NormalTok{(}\OtherTok{NULL}\NormalTok{,}\DataTypeTok{xlim=}\KeywordTok{c}\NormalTok{(}\DecValTok{0}\NormalTok{,}\DecValTok{2}\NormalTok{),}
           \DataTypeTok{ylim =} \KeywordTok{c}\NormalTok{(}\DecValTok{0}\NormalTok{,}\FloatTok{0.22}\NormalTok{),}\DataTypeTok{cex=}\FloatTok{0.005}\NormalTok{, }\DataTypeTok{yaxt =}\StringTok{"n"}\NormalTok{,}
           \DataTypeTok{xlab =} \StringTok{"TSR"}\NormalTok{, }\DataTypeTok{ylab =} \StringTok{"Cp"}\NormalTok{, }\DataTypeTok{bty=}\StringTok{'L'}\NormalTok{)}
      \KeywordTok{par}\NormalTok{(}\DataTypeTok{new=}\NormalTok{T)}
      \KeywordTok{lines}\NormalTok{(xx, }\KeywordTok{predict}\NormalTok{(fit5, }\KeywordTok{data.frame}\NormalTok{(}\DataTypeTok{x=}\NormalTok{xx)), }\DataTypeTok{col=}\NormalTok{colores[i],}\DataTypeTok{lwd=}\DecValTok{2}\NormalTok{)}
\NormalTok{      cp_max<-}\KeywordTok{max}\NormalTok{(}\KeywordTok{predict}\NormalTok{(fit5, }\KeywordTok{data.frame}\NormalTok{(}\DataTypeTok{x=}\NormalTok{xx)))}
\NormalTok{      lambda_max<-}\StringTok{ }\NormalTok{xx[}\KeywordTok{which.max}\NormalTok{(}\KeywordTok{predict}\NormalTok{(fit5, }\KeywordTok{data.frame}\NormalTok{(}\DataTypeTok{x=}\NormalTok{xx)))]}
      \KeywordTok{points}\NormalTok{(x,y, }\DataTypeTok{pch=}\NormalTok{ pch_dif[i])}
      \KeywordTok{par}\NormalTok{(}\DataTypeTok{new=}\NormalTok{T)}
\NormalTok{    \}}
    
    \KeywordTok{axis}\NormalTok{(}\DecValTok{2}\NormalTok{, }\DataTypeTok{at=}\KeywordTok{seq}\NormalTok{(}\DecValTok{0}\NormalTok{,}\FloatTok{0.25}\NormalTok{, }\DataTypeTok{by=}\FloatTok{0.05}\NormalTok{),}\DataTypeTok{las=}\DecValTok{2}\NormalTok{)}
\NormalTok{    V_viento<-}\KeywordTok{sapply}\NormalTok{(xx_percentaje,}\StringTok{"["}\NormalTok{,}\DecValTok{1}\NormalTok{,}\DecValTok{3}\NormalTok{)}
    
\NormalTok{    leyenda_veintos<-}\KeywordTok{paste0}\NormalTok{(}\KeywordTok{round}\NormalTok{(V_viento,}\DataTypeTok{digits =} \DecValTok{2}\NormalTok{), }\StringTok{" m/s"}\NormalTok{)}
\NormalTok{    orden_leyenda<-}\KeywordTok{cbind}\NormalTok{(V_viento,leyenda_veintos,pch_dif,colores)}
\NormalTok{    orden_leyenda<-orden_leyenda[}\KeywordTok{order}\NormalTok{(}\KeywordTok{as.numeric}\NormalTok{(orden_leyenda[,}\DecValTok{1}\NormalTok{]), }\DataTypeTok{decreasing =} \OtherTok{TRUE}\NormalTok{),]}
    
    \KeywordTok{legend}\NormalTok{(}\StringTok{"topright"}\NormalTok{, }\DataTypeTok{inset=}\KeywordTok{c}\NormalTok{(}\DecValTok{0}\NormalTok{,}\DecValTok{0}\NormalTok{),orden_leyenda[,}\DecValTok{2}\NormalTok{],}\DataTypeTok{pch =} \KeywordTok{as.numeric}\NormalTok{(orden_leyenda[,}\DecValTok{3}\NormalTok{]),}
           \DataTypeTok{text.col =}\NormalTok{ orden_leyenda[,}\DecValTok{4}\NormalTok{],}\DataTypeTok{ncol =} \DecValTok{1}\NormalTok{,}\DataTypeTok{cex =} \DecValTok{1}\NormalTok{)}
    
\NormalTok{    subtitle_nom<-}\StringTok{ }\KeywordTok{paste0}\NormalTok{(}\StringTok{"Experimento = "}\NormalTok{,nombre_grafica)}
\NormalTok{    maintitle<-}\StringTok{ }\KeywordTok{paste0}\NormalTok{(}\StringTok{"Gráfica CP-TSR }\CharTok{\textbackslash{}n}\StringTok{"}\NormalTok{,subtitle_nom)}
    \KeywordTok{title}\NormalTok{(}\DataTypeTok{main =}\NormalTok{ maintitle)}
    
    \KeywordTok{dev.off}\NormalTok{()}
    
\NormalTok{  \}}
  
\NormalTok{\}}

\CommentTok{#Ploteos de graficas de potencia}
\NormalTok{grafica_Potencia_V<-}\ControlFlowTok{function}\NormalTok{(df,xlimite,ylimite,V)\{}
\NormalTok{  select_groups <-}\StringTok{ }\ControlFlowTok{function}\NormalTok{(data, groups) \{}
\NormalTok{    data[}\KeywordTok{sort}\NormalTok{(}\KeywordTok{unlist}\NormalTok{(}\KeywordTok{attr}\NormalTok{(data, }\StringTok{"indices"}\NormalTok{)[ groups ])) }\OperatorTok{+}\StringTok{ }\DecValTok{1}\NormalTok{, ]}
\NormalTok{  \}}
  
\NormalTok{  group_number<-}\KeywordTok{length}\NormalTok{(}\KeywordTok{attr}\NormalTok{(}\KeywordTok{group_by}\NormalTok{(df,experimento,angulo), }\StringTok{"group"}\NormalTok{))}
\NormalTok{  lista_watts_Vviento<-}\StringTok{ }\KeywordTok{list}\NormalTok{()}
\NormalTok{  nombres_expr<-}\KeywordTok{vector}\NormalTok{()}
  \ControlFlowTok{for}\NormalTok{ (groups_ind }\ControlFlowTok{in} \DecValTok{1}\OperatorTok{:}\NormalTok{group_number) \{}
    
\NormalTok{    xx<-}\StringTok{ }\NormalTok{df }\OperatorTok{%>%}\StringTok{ }\KeywordTok{group_by}\NormalTok{(.,experimento,angulo) }\OperatorTok{%>%}\StringTok{ }\KeywordTok{select_groups}\NormalTok{(groups_ind)}
\NormalTok{    nombre_}\DecValTok{1}\NormalTok{<-}\KeywordTok{as.character}\NormalTok{(xx}\OperatorTok{$}\NormalTok{experimento[}\DecValTok{1}\NormalTok{])}
\NormalTok{    nombre_}\DecValTok{2}\NormalTok{<-}\KeywordTok{as.character}\NormalTok{(xx}\OperatorTok{$}\NormalTok{angulo[}\DecValTok{1}\NormalTok{])}
\NormalTok{    nombre<-}\KeywordTok{paste}\NormalTok{(nombre_}\DecValTok{1}\NormalTok{,nombre_}\DecValTok{2}\NormalTok{,}\DataTypeTok{sep =} \StringTok{"_"}\NormalTok{)}
    
    
\NormalTok{    percentaje_number<-}\KeywordTok{length}\NormalTok{(}\KeywordTok{attr}\NormalTok{(}\KeywordTok{group_by}\NormalTok{(xx,porcentaje), }\StringTok{"group"}\NormalTok{) )}
\NormalTok{    xx_percentaje<-}\KeywordTok{list}\NormalTok{()}
    \ControlFlowTok{for}\NormalTok{ (per }\ControlFlowTok{in} \DecValTok{1}\OperatorTok{:}\NormalTok{percentaje_number) \{}
\NormalTok{      xx_perc<-}\StringTok{ }\NormalTok{xx }\OperatorTok{%>%}\StringTok{ }\KeywordTok{group_by}\NormalTok{(.,porcentaje) }\OperatorTok{%>%}\StringTok{ }\KeywordTok{select_groups}\NormalTok{(per)}
\NormalTok{      V_select<-}\StringTok{ }\KeywordTok{as.name}\NormalTok{(}\KeywordTok{paste0}\NormalTok{(}\StringTok{"xx_perc$"}\NormalTok{,V))}
      
      \ControlFlowTok{if}\NormalTok{(V}\OperatorTok{==}\DecValTok{1}\NormalTok{)\{}
\NormalTok{        xx_perc<-}\KeywordTok{cbind}\NormalTok{(xx_perc}\OperatorTok{$}\NormalTok{cp_est,xx_perc}\OperatorTok{$}\NormalTok{watts,xx_perc}\OperatorTok{$}\NormalTok{V_viento_correcion)}
\NormalTok{      \}}\ControlFlowTok{else}\NormalTok{\{}
\NormalTok{        xx_perc<-}\KeywordTok{cbind}\NormalTok{(xx_perc}\OperatorTok{$}\NormalTok{cp_est,xx_perc}\OperatorTok{$}\NormalTok{watts,xx_perc}\OperatorTok{$}\NormalTok{Vviento_estandar)}
\NormalTok{      \}}
      \KeywordTok{colnames}\NormalTok{(xx_perc)<-}\StringTok{ }\KeywordTok{c}\NormalTok{(}\StringTok{"cp"}\NormalTok{,}\StringTok{"watts"}\NormalTok{, }\StringTok{"Vviento"}\NormalTok{)}
\NormalTok{      xx_percentaje[[per]]<-}\StringTok{ }\NormalTok{xx_perc}
      
\NormalTok{    \}}
\NormalTok{    lista_watts_Vviento[[groups_ind]]<-}\StringTok{ }\NormalTok{xx_percentaje}
\NormalTok{    nombres_expr[groups_ind]<-}\StringTok{ }\NormalTok{nombre}
\NormalTok{  \}}
  
  \KeywordTok{names}\NormalTok{(lista_watts_Vviento)<-}\StringTok{ }\NormalTok{nombres_expr}
  
\NormalTok{  lista_watts_Vviento_max<-}\KeywordTok{list}\NormalTok{()}
  \ControlFlowTok{for}\NormalTok{ (i }\ControlFlowTok{in} \DecValTok{1}\OperatorTok{:}\KeywordTok{length}\NormalTok{(lista_watts_Vviento)) \{}
    
\NormalTok{    df_watts_Vviento<-}\StringTok{ }\KeywordTok{data.frame}\NormalTok{(}\KeywordTok{matrix}\NormalTok{(}\KeywordTok{unlist}\NormalTok{(}\KeywordTok{lapply}\NormalTok{(lista_watts_Vviento[[i]],}
                                                       \ControlFlowTok{function}\NormalTok{(x) x[}\KeywordTok{which.max}\NormalTok{(x[,}\DecValTok{1}\NormalTok{]),}\DecValTok{2}\OperatorTok{:}\DecValTok{3}\NormalTok{])),}
                                         \DataTypeTok{nrow=}\DecValTok{6}\NormalTok{, }\DataTypeTok{byrow=}\NormalTok{T))}
    \KeywordTok{names}\NormalTok{(df_watts_Vviento)<-}\StringTok{ }\KeywordTok{c}\NormalTok{(}\StringTok{"Watss"}\NormalTok{,}\StringTok{"Vviento"}\NormalTok{)}
\NormalTok{    lista_watts_Vviento_max[[i]]<-}\StringTok{ }\NormalTok{df_watts_Vviento}
\NormalTok{  \}}
  \KeywordTok{names}\NormalTok{(lista_watts_Vviento_max)<-}\StringTok{ }\NormalTok{nombres_expr}
  
  \KeywordTok{dir.create}\NormalTok{(}\KeywordTok{paste0}\NormalTok{(}\KeywordTok{here}\NormalTok{(),}\StringTok{"/graficos_Potencia_V/"}\NormalTok{))}
  
  \CommentTok{#jpeg(paste0(here(),"/graficos_Potencia_V/grafica_Potencia_V.jpeg"))}
  \KeywordTok{tiff}\NormalTok{(}\KeywordTok{paste0}\NormalTok{(}\KeywordTok{here}\NormalTok{(),}\StringTok{"/graficos_Potencia_V/grafica_Potencia_V.tiff"}\NormalTok{), }\DataTypeTok{width =} \DecValTok{7}\NormalTok{, }\DataTypeTok{height =}\DecValTok{7}\NormalTok{, }\DataTypeTok{units =} \StringTok{'in'}\NormalTok{, }\DataTypeTok{res =} \DecValTok{300}\NormalTok{)}
  
  
\NormalTok{  colores<-}\StringTok{ }\KeywordTok{c}\NormalTok{(}\StringTok{"orange"}\NormalTok{,}\StringTok{"red"}\NormalTok{,}\StringTok{"blue"}\NormalTok{,}\StringTok{"dodgerblue4"}\NormalTok{,}\StringTok{"purple"}\NormalTok{,}\StringTok{"black"}\NormalTok{)}
\NormalTok{  pch_dif<-}\KeywordTok{c}\NormalTok{(}\DecValTok{0}\OperatorTok{:}\DecValTok{5}\NormalTok{)}
\NormalTok{  correlacion<-}\StringTok{ }\KeywordTok{vector}\NormalTok{()}
\NormalTok{  lista_coef<-}\KeywordTok{list}\NormalTok{()}
  \ControlFlowTok{for}\NormalTok{(i }\ControlFlowTok{in} \DecValTok{1}\OperatorTok{:}\KeywordTok{length}\NormalTok{(lista_watts_Vviento_max))\{}
    \CommentTok{#en caso de que sea mejor añadir el origen}
    \CommentTok{#x<- c(0,lambda_Cp[[i]][,2])}
    \CommentTok{#y<- c(0,lambda_Cp[[i]][,1])}
\NormalTok{    x<-}\StringTok{ }\NormalTok{lista_watts_Vviento_max[[i]][,}\DecValTok{2}\NormalTok{]}
\NormalTok{    y<-}\StringTok{ }\NormalTok{lista_watts_Vviento_max[[i]][,}\DecValTok{1}\NormalTok{]}
\NormalTok{    fit_curva<-}\KeywordTok{nls}\NormalTok{(y}\OperatorTok{~}\NormalTok{b}\OperatorTok{+}\NormalTok{a}\OperatorTok{*}\NormalTok{x}\OperatorTok{^}\DecValTok{3}\NormalTok{,}\DataTypeTok{start =} \KeywordTok{list}\NormalTok{(}\DataTypeTok{a=}\DecValTok{0}\NormalTok{, }\DataTypeTok{b=}\DecValTok{0}\NormalTok{))}
\NormalTok{    xx <-}\StringTok{ }\KeywordTok{seq}\NormalTok{(}\KeywordTok{min}\NormalTok{(x),xlimite[}\DecValTok{2}\NormalTok{], }\DataTypeTok{by=}\FloatTok{0.1}\NormalTok{)}
    
    \KeywordTok{plot}\NormalTok{(}\OtherTok{NULL}\NormalTok{,}\DataTypeTok{xlim=}\NormalTok{xlimite,}
         \DataTypeTok{ylim =}\NormalTok{ ylimite,}\DataTypeTok{cex=}\FloatTok{0.005}\NormalTok{, }\DataTypeTok{yaxt =}\StringTok{"n"}\NormalTok{,}
         \DataTypeTok{xlab =} \StringTok{"Velocidad del viento (m/s)"}\NormalTok{, }\DataTypeTok{ylab =} \StringTok{"Potencia (W)"}\NormalTok{, }\DataTypeTok{bty=}\StringTok{'L'}\NormalTok{)}
    \KeywordTok{title}\NormalTok{(}\DataTypeTok{main=} \StringTok{"Curvas de potencia"}\NormalTok{)}
    \KeywordTok{par}\NormalTok{(}\DataTypeTok{new=}\NormalTok{T)}
    \KeywordTok{lines}\NormalTok{(xx, }\KeywordTok{predict}\NormalTok{(fit_curva, }\KeywordTok{data.frame}\NormalTok{(}\DataTypeTok{x=}\NormalTok{xx)), }\DataTypeTok{col=}\NormalTok{colores[i],}\DataTypeTok{lwd=}\DecValTok{1}\NormalTok{,}\DataTypeTok{lty=}\DecValTok{2}\NormalTok{)}
    \KeywordTok{points}\NormalTok{(x,y, }\DataTypeTok{pch=}\NormalTok{ pch_dif[i])}
    \KeywordTok{par}\NormalTok{(}\DataTypeTok{new=}\NormalTok{T)}
\NormalTok{    correlacion[i]<-}\StringTok{ }\KeywordTok{cor}\NormalTok{(y,}\KeywordTok{predict}\NormalTok{(fit_curva))}
\NormalTok{    lista_coef[[i]]<-}\StringTok{ }\KeywordTok{coef}\NormalTok{(fit_curva)}
\NormalTok{  \}}
  
  \KeywordTok{axis}\NormalTok{(}\DecValTok{2}\NormalTok{, }\DataTypeTok{at=}\KeywordTok{seq}\NormalTok{(}\DecValTok{0}\NormalTok{,ylimite[}\DecValTok{2}\NormalTok{], }\DataTypeTok{by=}\KeywordTok{round}\NormalTok{(ylimite[}\DecValTok{2}\NormalTok{]}\OperatorTok{/}\DecValTok{7}\NormalTok{,}\DecValTok{0}\NormalTok{)),}\DataTypeTok{las=}\DecValTok{2}\NormalTok{)}
  
\NormalTok{  titulos_graficos<-}\ControlFlowTok{function}\NormalTok{(df)\{}
\NormalTok{    group_number<-}\KeywordTok{length}\NormalTok{(}\KeywordTok{attr}\NormalTok{(}\KeywordTok{group_by}\NormalTok{(df,experimento,angulo,porcentaje), }\StringTok{"group"}\NormalTok{))}
\NormalTok{    lista_rpm_resistencia<-}\StringTok{ }\KeywordTok{list}\NormalTok{()}
\NormalTok{    nombres_lista<-}\StringTok{ }\KeywordTok{vector}\NormalTok{()}
\NormalTok{    titulos_grafico<-}\StringTok{ }\KeywordTok{vector}\NormalTok{()}
\NormalTok{    tabladenombres<-}\StringTok{ }\KeywordTok{matrix}\NormalTok{(}\OperatorTok{-}\DecValTok{31}\NormalTok{,}\DataTypeTok{ncol =} \DecValTok{3}\NormalTok{, }\DataTypeTok{nrow =}\NormalTok{ group_number)}
    \ControlFlowTok{for}\NormalTok{ (grupos }\ControlFlowTok{in} \DecValTok{1}\OperatorTok{:}\NormalTok{group_number) \{}
\NormalTok{      grupos_rpm_resistencia<-}\StringTok{ }\NormalTok{df }\OperatorTok{%>%}\StringTok{ }\KeywordTok{group_by}\NormalTok{(.,experimento,angulo,porcentaje) }\OperatorTok{%>%}\StringTok{ }\KeywordTok{select_groups}\NormalTok{(grupos)}
      
\NormalTok{      tabla_resistencia_rpm<-}\StringTok{ }\KeywordTok{as.data.frame}\NormalTok{(}\KeywordTok{cbind}\NormalTok{(}\KeywordTok{as.numeric}\NormalTok{(grupos_rpm_resistencia}\OperatorTok{$}\NormalTok{RPM),}\KeywordTok{as.data.frame}\NormalTok{(grupos_rpm_resistencia}\OperatorTok{$}\NormalTok{resistencia)))}
      \KeywordTok{colnames}\NormalTok{(tabla_resistencia_rpm)<-}\StringTok{ }\KeywordTok{c}\NormalTok{(}\StringTok{"RPM"}\NormalTok{, }\StringTok{"Omhnios"}\NormalTok{)}
      
\NormalTok{      nombre_tabla<-}\StringTok{ }\KeywordTok{unique}\NormalTok{(}\KeywordTok{paste}\NormalTok{(grupos_rpm_resistencia}\OperatorTok{$}\NormalTok{experimento,grupos_rpm_resistencia}\OperatorTok{$}\NormalTok{angulo,grupos_rpm_resistencia}\OperatorTok{$}\NormalTok{porcentaje,}\DataTypeTok{sep =} \StringTok{"_"}\NormalTok{))}
      
      \ControlFlowTok{if}\NormalTok{(}\KeywordTok{is.na}\NormalTok{(grupos_rpm_resistencia}\OperatorTok{$}\NormalTok{angulo))\{}
\NormalTok{        titulo_graph<-}\StringTok{ }\KeywordTok{unique}\NormalTok{(}\KeywordTok{paste0}\NormalTok{(grupos_rpm_resistencia}\OperatorTok{$}\NormalTok{experimento))}
\NormalTok{      \}}\ControlFlowTok{else}\NormalTok{\{}
\NormalTok{        titulo_graph<-}\StringTok{ }\KeywordTok{unique}\NormalTok{(}\KeywordTok{paste0}\NormalTok{(grupos_rpm_resistencia}\OperatorTok{$}\NormalTok{experimento,}\StringTok{"-"}\NormalTok{,grupos_rpm_resistencia}\OperatorTok{$}\NormalTok{angulo,}\StringTok{"º"}\NormalTok{))}
\NormalTok{      \}}
\NormalTok{      titulos_grafico[grupos]<-}\StringTok{ }\NormalTok{titulo_graph}
\NormalTok{      lista_rpm_resistencia[[grupos]]<-}\StringTok{ }\NormalTok{tabla_resistencia_rpm}
\NormalTok{      nombres_lista[grupos]<-}\StringTok{ }\NormalTok{nombre_tabla}
\NormalTok{      tabladenombres[grupos,}\DecValTok{1}\NormalTok{]<-}\KeywordTok{as.character}\NormalTok{(grupos_rpm_resistencia}\OperatorTok{$}\NormalTok{experimento[}\DecValTok{1}\NormalTok{])}
\NormalTok{      tabladenombres[grupos,}\DecValTok{2}\NormalTok{]<-}\StringTok{ }\KeywordTok{as.character}\NormalTok{(grupos_rpm_resistencia}\OperatorTok{$}\NormalTok{angulo[}\DecValTok{1}\NormalTok{])}
\NormalTok{      tabladenombres[grupos,}\DecValTok{3}\NormalTok{]<-}\StringTok{ }\KeywordTok{as.character}\NormalTok{(grupos_rpm_resistencia}\OperatorTok{$}\NormalTok{porcentaje[}\DecValTok{1}\NormalTok{])}
\NormalTok{    \}}
    \KeywordTok{return}\NormalTok{(}\KeywordTok{unique}\NormalTok{(titulos_grafico))}
    
\NormalTok{  \}}
\NormalTok{  nombres_df<-}\StringTok{ }\KeywordTok{titulos_graficos}\NormalTok{(df)}
  
  
\NormalTok{  leyenda<-}\StringTok{ }\KeywordTok{paste0}\NormalTok{(nombres_df,}\StringTok{" (Cor= "}\NormalTok{,}\KeywordTok{round}\NormalTok{(correlacion,}\DecValTok{4}\NormalTok{),}\StringTok{")"}\NormalTok{)}
  
  \KeywordTok{legend}\NormalTok{(}\StringTok{"topleft"}\NormalTok{,}\DataTypeTok{y.intersp =} \FloatTok{0.75}\NormalTok{,}\DataTypeTok{seg.len =} \FloatTok{0.9}\NormalTok{,}
         \DataTypeTok{bty=}\StringTok{"n"}\NormalTok{, }\DataTypeTok{bg=}\StringTok{"transparent"}\NormalTok{,}\DataTypeTok{inset=}\KeywordTok{c}\NormalTok{(}\DecValTok{0}\NormalTok{,}\DecValTok{0}\NormalTok{),}
         \DataTypeTok{legend =}\NormalTok{ leyenda,}\DataTypeTok{lty =} \KeywordTok{c}\NormalTok{(}\DecValTok{2}\NormalTok{,}\DecValTok{2}\NormalTok{,}\DecValTok{2}\NormalTok{,}\DecValTok{2}\NormalTok{,}\DecValTok{2}\NormalTok{),}\DataTypeTok{lwd =} \KeywordTok{c}\NormalTok{(}\DecValTok{2}\NormalTok{,}\DecValTok{2}\NormalTok{,}\DecValTok{2}\NormalTok{,}\DecValTok{2}\NormalTok{,}\DecValTok{2}\NormalTok{),}\DataTypeTok{col =}\NormalTok{ colores[}\DecValTok{1}\OperatorTok{:}\DecValTok{5}\NormalTok{],}\DataTypeTok{ncol =} \DecValTok{1}\NormalTok{,}\DataTypeTok{cex =} \DecValTok{1}\NormalTok{)}
  \KeywordTok{dev.off}\NormalTok{()}
  
\NormalTok{  tabladenombress<-}\ControlFlowTok{function}\NormalTok{(df)\{}
\NormalTok{    group_number<-}\KeywordTok{length}\NormalTok{(}\KeywordTok{attr}\NormalTok{(}\KeywordTok{group_by}\NormalTok{(df,experimento,angulo), }\StringTok{"group"}\NormalTok{))}
\NormalTok{    tabladenombres<-}\StringTok{ }\KeywordTok{matrix}\NormalTok{(}\OperatorTok{-}\DecValTok{31}\NormalTok{,}\DataTypeTok{ncol =} \DecValTok{2}\NormalTok{, }\DataTypeTok{nrow =}\NormalTok{ group_number)}
    \ControlFlowTok{for}\NormalTok{ (grupos }\ControlFlowTok{in} \DecValTok{1}\OperatorTok{:}\NormalTok{group_number) \{}
\NormalTok{      grupos_rpm_resistencia<-}\StringTok{ }\NormalTok{df }\OperatorTok{%>%}\StringTok{ }\KeywordTok{group_by}\NormalTok{(.,experimento,angulo) }\OperatorTok{%>%}\StringTok{ }\KeywordTok{select_groups}\NormalTok{(grupos)}
\NormalTok{      tabladenombres[grupos,}\DecValTok{1}\NormalTok{]<-}\KeywordTok{as.character}\NormalTok{(grupos_rpm_resistencia}\OperatorTok{$}\NormalTok{experimento[}\DecValTok{1}\NormalTok{])}
\NormalTok{      tabladenombres[grupos,}\DecValTok{2}\NormalTok{]<-}\StringTok{ }\KeywordTok{as.character}\NormalTok{(grupos_rpm_resistencia}\OperatorTok{$}\NormalTok{angulo[}\DecValTok{1}\NormalTok{])}
\NormalTok{    \}}
    \KeywordTok{return}\NormalTok{(}\KeywordTok{as.data.frame}\NormalTok{(tabladenombres))}
\NormalTok{  \}}
  
\NormalTok{  tablanombres<-}\KeywordTok{tabladenombress}\NormalTok{(df)}
  
\NormalTok{  coeficientes_P_V<-}\KeywordTok{data.frame}\NormalTok{(}\KeywordTok{matrix}\NormalTok{(}\KeywordTok{unlist}\NormalTok{(lista_coef),}\DataTypeTok{nrow=}\DecValTok{5}\NormalTok{, }\DataTypeTok{byrow=}\NormalTok{T))}
  
\NormalTok{  coef_tabla<-}\StringTok{ }\KeywordTok{cbind}\NormalTok{(tablanombres,coeficientes_P_V) }
  \KeywordTok{names}\NormalTok{(coef_tabla)<-}\KeywordTok{c}\NormalTok{(}\StringTok{"Experimento"}\NormalTok{,}\StringTok{"Angulo"}\NormalTok{,}\StringTok{"a"}\NormalTok{,}\StringTok{"b"}\NormalTok{)}
  
  \KeywordTok{return}\NormalTok{(coef_tabla)}
  
\NormalTok{\}}

\CommentTok{#ploteos de gráficas de potencia con la correción modelo/prototipo}
\NormalTok{grafica_Potencia_V_alfa<-}\ControlFlowTok{function}\NormalTok{(df,xlimite,ylimite)\{}
\NormalTok{  select_groups <-}\StringTok{ }\ControlFlowTok{function}\NormalTok{(data, groups) \{}
\NormalTok{    data[}\KeywordTok{sort}\NormalTok{(}\KeywordTok{unlist}\NormalTok{(}\KeywordTok{attr}\NormalTok{(data, }\StringTok{"indices"}\NormalTok{)[ groups ])) }\OperatorTok{+}\StringTok{ }\DecValTok{1}\NormalTok{, ]}
\NormalTok{  \}}
  
\NormalTok{  group_number<-}\KeywordTok{length}\NormalTok{(}\KeywordTok{attr}\NormalTok{(}\KeywordTok{group_by}\NormalTok{(df,experimento,angulo), }\StringTok{"group"}\NormalTok{))}
\NormalTok{  lista_watts_Vviento_modelo<-}\StringTok{ }\KeywordTok{list}\NormalTok{()}
\NormalTok{  lista_watts_Vviento_prototipo<-}\StringTok{ }\KeywordTok{list}\NormalTok{()}
  
\NormalTok{  nombres_expr<-}\KeywordTok{vector}\NormalTok{()}
  \ControlFlowTok{for}\NormalTok{ (groups_ind }\ControlFlowTok{in} \DecValTok{1}\OperatorTok{:}\NormalTok{group_number) \{}
    
\NormalTok{    xx<-}\StringTok{ }\NormalTok{df }\OperatorTok{%>%}\StringTok{ }\KeywordTok{group_by}\NormalTok{(.,experimento,angulo) }\OperatorTok{%>%}\StringTok{ }\KeywordTok{select_groups}\NormalTok{(groups_ind)}
\NormalTok{    nombre_}\DecValTok{1}\NormalTok{<-}\KeywordTok{as.character}\NormalTok{(xx}\OperatorTok{$}\NormalTok{experimento[}\DecValTok{1}\NormalTok{])}
\NormalTok{    nombre_}\DecValTok{2}\NormalTok{<-}\KeywordTok{as.character}\NormalTok{(xx}\OperatorTok{$}\NormalTok{angulo[}\DecValTok{1}\NormalTok{])}
\NormalTok{    nombre<-}\KeywordTok{paste}\NormalTok{(nombre_}\DecValTok{1}\NormalTok{,nombre_}\DecValTok{2}\NormalTok{,}\DataTypeTok{sep =} \StringTok{"_"}\NormalTok{)}
    
    
\NormalTok{    percentaje_number<-}\KeywordTok{length}\NormalTok{(}\KeywordTok{attr}\NormalTok{(}\KeywordTok{group_by}\NormalTok{(xx,porcentaje), }\StringTok{"group"}\NormalTok{) )}
\NormalTok{    xx_percentaje_modelo<-}\KeywordTok{list}\NormalTok{()}
\NormalTok{    xx_percentaje_prototipo<-}\KeywordTok{list}\NormalTok{()}
    
    \ControlFlowTok{for}\NormalTok{ (per }\ControlFlowTok{in} \DecValTok{1}\OperatorTok{:}\NormalTok{percentaje_number) \{}
\NormalTok{      xx_perc<-}\StringTok{ }\NormalTok{xx }\OperatorTok{%>%}\StringTok{ }\KeywordTok{group_by}\NormalTok{(.,porcentaje) }\OperatorTok{%>%}\StringTok{ }\KeywordTok{select_groups}\NormalTok{(per)}
      
\NormalTok{      xx_perc_modelo<-}\KeywordTok{cbind}\NormalTok{(xx_perc}\OperatorTok{$}\NormalTok{cp_est,xx_perc}\OperatorTok{$}\NormalTok{watts,xx_perc}\OperatorTok{$}\NormalTok{V_viento_correcion)}
      \KeywordTok{colnames}\NormalTok{(xx_perc_modelo)<-}\StringTok{ }\KeywordTok{c}\NormalTok{(}\StringTok{"cp"}\NormalTok{,}\StringTok{"watts"}\NormalTok{, }\StringTok{"Vviento"}\NormalTok{)}
\NormalTok{      xx_percentaje_modelo[[per]]<-}\StringTok{ }\NormalTok{xx_perc_modelo}
      
      
\NormalTok{      xx_perc_prototipo<-}\KeywordTok{cbind}\NormalTok{(xx_perc}\OperatorTok{$}\NormalTok{cp_alfa,xx_perc}\OperatorTok{$}\NormalTok{watts_alfa,xx_perc}\OperatorTok{$}\NormalTok{V_viento_alfa)}
      \KeywordTok{colnames}\NormalTok{(xx_perc_prototipo)<-}\StringTok{ }\KeywordTok{c}\NormalTok{(}\StringTok{"cp"}\NormalTok{,}\StringTok{"watts"}\NormalTok{, }\StringTok{"Vviento"}\NormalTok{)}
\NormalTok{      xx_percentaje_prototipo[[per]]<-}\StringTok{ }\NormalTok{xx_perc_prototipo}
      
      
\NormalTok{    \}}
\NormalTok{    lista_watts_Vviento_modelo[[groups_ind]]<-}\StringTok{ }\NormalTok{xx_percentaje_modelo}
\NormalTok{    lista_watts_Vviento_prototipo[[groups_ind]]<-}\StringTok{ }\NormalTok{xx_percentaje_prototipo}
    
\NormalTok{    nombres_expr[groups_ind]<-}\StringTok{ }\NormalTok{nombre}
\NormalTok{  \}}
  
  \KeywordTok{names}\NormalTok{(lista_watts_Vviento_modelo)<-}\StringTok{ }\NormalTok{nombres_expr}
  
\NormalTok{  lista_watts_Vviento_max_modelo<-}\KeywordTok{list}\NormalTok{()}
\NormalTok{  lista_watts_Vviento_max_prototipo<-}\KeywordTok{list}\NormalTok{()}
  
  \ControlFlowTok{for}\NormalTok{ (i }\ControlFlowTok{in} \DecValTok{1}\OperatorTok{:}\KeywordTok{length}\NormalTok{(lista_watts_Vviento_modelo)) \{}
    
\NormalTok{    df_watts_Vviento_modelo<-}\StringTok{ }\KeywordTok{data.frame}\NormalTok{(}\KeywordTok{matrix}\NormalTok{(}\KeywordTok{unlist}\NormalTok{(}\KeywordTok{lapply}\NormalTok{(lista_watts_Vviento_modelo[[i]],}
                                                              \ControlFlowTok{function}\NormalTok{(x) x[}\KeywordTok{which.max}\NormalTok{(x[,}\DecValTok{1}\NormalTok{]),}\DecValTok{2}\OperatorTok{:}\DecValTok{3}\NormalTok{])),}
                                                \DataTypeTok{nrow=}\DecValTok{6}\NormalTok{, }\DataTypeTok{byrow=}\NormalTok{T))}
    \KeywordTok{names}\NormalTok{(df_watts_Vviento_modelo)<-}\StringTok{ }\KeywordTok{c}\NormalTok{(}\StringTok{"Watss"}\NormalTok{,}\StringTok{"Vviento"}\NormalTok{)}
\NormalTok{    lista_watts_Vviento_max_modelo[[i]]<-}\StringTok{ }\NormalTok{df_watts_Vviento_modelo}
    
\NormalTok{    df_watts_Vviento_prototipo<-}\StringTok{ }\KeywordTok{data.frame}\NormalTok{(}\KeywordTok{matrix}\NormalTok{(}\KeywordTok{unlist}\NormalTok{(}\KeywordTok{lapply}\NormalTok{(lista_watts_Vviento_prototipo[[i]],}
                                                                 \ControlFlowTok{function}\NormalTok{(x) x[}\KeywordTok{which.max}\NormalTok{(x[,}\DecValTok{1}\NormalTok{]),}\DecValTok{2}\OperatorTok{:}\DecValTok{3}\NormalTok{])),}
                                                   \DataTypeTok{nrow=}\DecValTok{6}\NormalTok{, }\DataTypeTok{byrow=}\NormalTok{T))}
    \KeywordTok{names}\NormalTok{(df_watts_Vviento_modelo)<-}\StringTok{ }\KeywordTok{c}\NormalTok{(}\StringTok{"Watss"}\NormalTok{,}\StringTok{"Vviento"}\NormalTok{)}
\NormalTok{    lista_watts_Vviento_max_prototipo[[i]]<-}\StringTok{ }\NormalTok{df_watts_Vviento_prototipo}
    
    
\NormalTok{  \}}
  \KeywordTok{names}\NormalTok{(lista_watts_Vviento_max_modelo)<-}\StringTok{ }\NormalTok{nombres_expr}
  
  \KeywordTok{dir.create}\NormalTok{(}\KeywordTok{paste0}\NormalTok{(}\KeywordTok{here}\NormalTok{(),}\StringTok{"/graficos_Potencia_V/"}\NormalTok{))}
  
  \CommentTok{#jpeg(paste0(here(),"/graficos_Potencia_V/grafica_Potencia_V.jpeg"))}
  \KeywordTok{tiff}\NormalTok{(}\KeywordTok{paste0}\NormalTok{(}\KeywordTok{here}\NormalTok{(),}\StringTok{"/graficos_Potencia_V/grafica_Potencia_V_comparativa.tiff"}\NormalTok{), }\DataTypeTok{width =} \DecValTok{7}\NormalTok{, }\DataTypeTok{height =}\DecValTok{7}\NormalTok{, }\DataTypeTok{units =} \StringTok{'in'}\NormalTok{, }\DataTypeTok{res =} \DecValTok{300}\NormalTok{)}
  
  
\NormalTok{  colores<-}\StringTok{ }\KeywordTok{c}\NormalTok{(}\StringTok{"orange"}\NormalTok{,}\StringTok{"red"}\NormalTok{,}\StringTok{"blue"}\NormalTok{,}\StringTok{"dodgerblue4"}\NormalTok{,}\StringTok{"purple"}\NormalTok{,}\StringTok{"black"}\NormalTok{)}
\NormalTok{  pch_dif<-}\KeywordTok{c}\NormalTok{(}\DecValTok{0}\OperatorTok{:}\DecValTok{5}\NormalTok{)}
\NormalTok{  correlacion<-}\StringTok{ }\KeywordTok{vector}\NormalTok{()}
\NormalTok{  lista_coef_modelo<-}\KeywordTok{list}\NormalTok{()}
\NormalTok{  lista_coef_prototipo<-}\KeywordTok{list}\NormalTok{()}
  \ControlFlowTok{for}\NormalTok{(i }\ControlFlowTok{in} \DecValTok{1}\OperatorTok{:}\KeywordTok{length}\NormalTok{(lista_watts_Vviento_max_modelo))\{}
    \CommentTok{#en caso de que sea mejor añadir el origen}
    \CommentTok{#x<- c(0,lambda_Cp[[i]][,2])}
    \CommentTok{#y<- c(0,lambda_Cp[[i]][,1])}
\NormalTok{    x_modelo<-}\StringTok{ }\NormalTok{lista_watts_Vviento_max_modelo[[i]][,}\DecValTok{2}\NormalTok{]}
\NormalTok{    y_modelo<-}\StringTok{ }\NormalTok{lista_watts_Vviento_max_modelo[[i]][,}\DecValTok{1}\NormalTok{]}
\NormalTok{    fit_curva_modelo<-}\KeywordTok{nls}\NormalTok{(y_modelo}\OperatorTok{~}\NormalTok{b}\OperatorTok{+}\NormalTok{a}\OperatorTok{*}\NormalTok{x_modelo}\OperatorTok{^}\DecValTok{3}\NormalTok{,}\DataTypeTok{start =} \KeywordTok{list}\NormalTok{(}\DataTypeTok{a=}\DecValTok{0}\NormalTok{, }\DataTypeTok{b=}\DecValTok{0}\NormalTok{))}
\NormalTok{    xx_modelo <-}\StringTok{ }\KeywordTok{seq}\NormalTok{(}\KeywordTok{min}\NormalTok{(x_modelo),xlimite[}\DecValTok{2}\NormalTok{], }\DataTypeTok{by=}\FloatTok{0.1}\NormalTok{)}
    
    
\NormalTok{    x_prototipo<-}\StringTok{ }\NormalTok{lista_watts_Vviento_max_prototipo[[i]][,}\DecValTok{2}\NormalTok{]}
\NormalTok{    y_prototipo<-}\StringTok{ }\NormalTok{lista_watts_Vviento_max_prototipo[[i]][,}\DecValTok{1}\NormalTok{]}
\NormalTok{    fit_curva_prototipo<-}\KeywordTok{nls}\NormalTok{(y_prototipo}\OperatorTok{~}\NormalTok{b}\OperatorTok{+}\NormalTok{a}\OperatorTok{*}\NormalTok{x_prototipo}\OperatorTok{^}\DecValTok{3}\NormalTok{,}\DataTypeTok{start =} \KeywordTok{list}\NormalTok{(}\DataTypeTok{a=}\DecValTok{0}\NormalTok{, }\DataTypeTok{b=}\DecValTok{0}\NormalTok{))}
\NormalTok{    xx_prototipo <-}\StringTok{ }\KeywordTok{seq}\NormalTok{(}\KeywordTok{min}\NormalTok{(x_prototipo),xlimite[}\DecValTok{2}\NormalTok{], }\DataTypeTok{by=}\FloatTok{0.1}\NormalTok{)}
    
    
    
    
    \KeywordTok{plot}\NormalTok{(}\OtherTok{NULL}\NormalTok{,}\DataTypeTok{xlim=}\NormalTok{xlimite,}
         \DataTypeTok{ylim =}\NormalTok{ ylimite,}\DataTypeTok{cex=}\FloatTok{0.005}\NormalTok{, }\DataTypeTok{yaxt =}\StringTok{"n"}\NormalTok{,}
         \DataTypeTok{xlab =} \StringTok{"Velocidad del viento (m/s)"}\NormalTok{, }\DataTypeTok{ylab =} \StringTok{"Potencia (W)"}\NormalTok{, }\DataTypeTok{bty=}\StringTok{'L'}\NormalTok{)}
    \KeywordTok{title}\NormalTok{(}\DataTypeTok{main=} \StringTok{"Curvas de potencia"}\NormalTok{)}
    \KeywordTok{par}\NormalTok{(}\DataTypeTok{new=}\NormalTok{T)}
    
    \KeywordTok{lines}\NormalTok{(xx_modelo, }\KeywordTok{predict}\NormalTok{(fit_curva_modelo, }\KeywordTok{data.frame}\NormalTok{(}\DataTypeTok{x_modelo=}\NormalTok{xx_modelo)), }\DataTypeTok{col=}\NormalTok{colores[i],}\DataTypeTok{lwd=}\DecValTok{1}\NormalTok{,}\DataTypeTok{lty=}\DecValTok{2}\NormalTok{)}
    
    \KeywordTok{lines}\NormalTok{(xx_prototipo, }\KeywordTok{predict}\NormalTok{(fit_curva_prototipo, }\KeywordTok{data.frame}\NormalTok{(}\DataTypeTok{x_prototipo=}\NormalTok{xx_prototipo)), }\DataTypeTok{col=}\NormalTok{colores[i],}\DataTypeTok{lwd=}\DecValTok{1}\NormalTok{,}\DataTypeTok{lty=}\DecValTok{1}\NormalTok{)}
    
    
    \KeywordTok{par}\NormalTok{(}\DataTypeTok{new=}\NormalTok{T)}
\NormalTok{    lista_coef_modelo[[i]]<-}\StringTok{ }\KeywordTok{coef}\NormalTok{(fit_curva_modelo)}
\NormalTok{    lista_coef_prototipo[[i]]<-}\StringTok{ }\KeywordTok{coef}\NormalTok{(fit_curva_prototipo)}
    
\NormalTok{  \}}
  
  \KeywordTok{axis}\NormalTok{(}\DecValTok{2}\NormalTok{, }\DataTypeTok{at=}\KeywordTok{seq}\NormalTok{(}\DecValTok{0}\NormalTok{,ylimite[}\DecValTok{2}\NormalTok{], }\DataTypeTok{by=}\KeywordTok{round}\NormalTok{(ylimite[}\DecValTok{2}\NormalTok{]}\OperatorTok{/}\DecValTok{7}\NormalTok{,}\DecValTok{0}\NormalTok{)),}\DataTypeTok{las=}\DecValTok{2}\NormalTok{)}
  
\NormalTok{  titulos_graficos<-}\ControlFlowTok{function}\NormalTok{(df)\{}
\NormalTok{    group_number<-}\KeywordTok{length}\NormalTok{(}\KeywordTok{attr}\NormalTok{(}\KeywordTok{group_by}\NormalTok{(df,experimento,angulo,porcentaje), }\StringTok{"group"}\NormalTok{))}
\NormalTok{    lista_rpm_resistencia<-}\StringTok{ }\KeywordTok{list}\NormalTok{()}
\NormalTok{    nombres_lista<-}\StringTok{ }\KeywordTok{vector}\NormalTok{()}
\NormalTok{    titulos_grafico<-}\StringTok{ }\KeywordTok{vector}\NormalTok{()}
\NormalTok{    tabladenombres<-}\StringTok{ }\KeywordTok{matrix}\NormalTok{(}\OperatorTok{-}\DecValTok{31}\NormalTok{,}\DataTypeTok{ncol =} \DecValTok{3}\NormalTok{, }\DataTypeTok{nrow =}\NormalTok{ group_number)}
    \ControlFlowTok{for}\NormalTok{ (grupos }\ControlFlowTok{in} \DecValTok{1}\OperatorTok{:}\NormalTok{group_number) \{}
\NormalTok{      grupos_rpm_resistencia<-}\StringTok{ }\NormalTok{df }\OperatorTok{%>%}\StringTok{ }\KeywordTok{group_by}\NormalTok{(.,experimento,angulo,porcentaje) }\OperatorTok{%>%}\StringTok{ }\KeywordTok{select_groups}\NormalTok{(grupos)}
      
\NormalTok{      tabla_resistencia_rpm<-}\StringTok{ }\KeywordTok{as.data.frame}\NormalTok{(}\KeywordTok{cbind}\NormalTok{(}\KeywordTok{as.numeric}\NormalTok{(grupos_rpm_resistencia}\OperatorTok{$}\NormalTok{RPM),}\KeywordTok{as.data.frame}\NormalTok{(grupos_rpm_resistencia}\OperatorTok{$}\NormalTok{resistencia)))}
      \KeywordTok{colnames}\NormalTok{(tabla_resistencia_rpm)<-}\StringTok{ }\KeywordTok{c}\NormalTok{(}\StringTok{"RPM"}\NormalTok{, }\StringTok{"Omhnios"}\NormalTok{)}
      
\NormalTok{      nombre_tabla<-}\StringTok{ }\KeywordTok{unique}\NormalTok{(}\KeywordTok{paste}\NormalTok{(grupos_rpm_resistencia}\OperatorTok{$}\NormalTok{experimento,grupos_rpm_resistencia}\OperatorTok{$}\NormalTok{angulo,grupos_rpm_resistencia}\OperatorTok{$}\NormalTok{porcentaje,}\DataTypeTok{sep =} \StringTok{"_"}\NormalTok{))}
      
      \ControlFlowTok{if}\NormalTok{(}\KeywordTok{is.na}\NormalTok{(grupos_rpm_resistencia}\OperatorTok{$}\NormalTok{angulo))\{}
\NormalTok{        titulo_graph<-}\StringTok{ }\KeywordTok{unique}\NormalTok{(}\KeywordTok{paste0}\NormalTok{(grupos_rpm_resistencia}\OperatorTok{$}\NormalTok{experimento))}
\NormalTok{      \}}\ControlFlowTok{else}\NormalTok{\{}
\NormalTok{        titulo_graph<-}\StringTok{ }\KeywordTok{unique}\NormalTok{(}\KeywordTok{paste0}\NormalTok{(grupos_rpm_resistencia}\OperatorTok{$}\NormalTok{experimento,}\StringTok{"-"}\NormalTok{,grupos_rpm_resistencia}\OperatorTok{$}\NormalTok{angulo,}\StringTok{"º"}\NormalTok{))}
\NormalTok{      \}}
\NormalTok{      titulos_grafico[grupos]<-}\StringTok{ }\NormalTok{titulo_graph}
\NormalTok{      lista_rpm_resistencia[[grupos]]<-}\StringTok{ }\NormalTok{tabla_resistencia_rpm}
\NormalTok{      nombres_lista[grupos]<-}\StringTok{ }\NormalTok{nombre_tabla}
\NormalTok{      tabladenombres[grupos,}\DecValTok{1}\NormalTok{]<-}\KeywordTok{as.character}\NormalTok{(grupos_rpm_resistencia}\OperatorTok{$}\NormalTok{experimento[}\DecValTok{1}\NormalTok{])}
\NormalTok{      tabladenombres[grupos,}\DecValTok{2}\NormalTok{]<-}\StringTok{ }\KeywordTok{as.character}\NormalTok{(grupos_rpm_resistencia}\OperatorTok{$}\NormalTok{angulo[}\DecValTok{1}\NormalTok{])}
\NormalTok{      tabladenombres[grupos,}\DecValTok{3}\NormalTok{]<-}\StringTok{ }\KeywordTok{as.character}\NormalTok{(grupos_rpm_resistencia}\OperatorTok{$}\NormalTok{porcentaje[}\DecValTok{1}\NormalTok{])}
\NormalTok{    \}}
    \KeywordTok{return}\NormalTok{(}\KeywordTok{unique}\NormalTok{(titulos_grafico))}
    
\NormalTok{  \}}
\NormalTok{  nombres_df<-}\StringTok{ }\KeywordTok{titulos_graficos}\NormalTok{(df)}
  
  
\NormalTok{  leyenda<-}\StringTok{ }\KeywordTok{paste0}\NormalTok{(nombres_df)}
  
  \KeywordTok{legend}\NormalTok{(}\StringTok{"topleft"}\NormalTok{,}\DataTypeTok{y.intersp =} \FloatTok{0.75}\NormalTok{,}\DataTypeTok{seg.len =} \FloatTok{1.2}\NormalTok{,}
         \DataTypeTok{bty=}\StringTok{"n"}\NormalTok{, }\DataTypeTok{bg=}\StringTok{"transparent"}\NormalTok{,}\DataTypeTok{inset=}\KeywordTok{c}\NormalTok{(}\DecValTok{0}\NormalTok{,}\DecValTok{0}\NormalTok{),}
         \DataTypeTok{legend =}\NormalTok{ leyenda,}\DataTypeTok{lty =} \KeywordTok{c}\NormalTok{(}\DecValTok{1}\NormalTok{,}\DecValTok{1}\NormalTok{,}\DecValTok{1}\NormalTok{,}\DecValTok{1}\NormalTok{,}\DecValTok{1}\NormalTok{),}\DataTypeTok{lwd =} \KeywordTok{c}\NormalTok{(}\DecValTok{2}\NormalTok{,}\DecValTok{2}\NormalTok{,}\DecValTok{2}\NormalTok{,}\DecValTok{2}\NormalTok{,}\DecValTok{2}\NormalTok{),}\DataTypeTok{col =}\NormalTok{ colores[}\DecValTok{1}\OperatorTok{:}\DecValTok{5}\NormalTok{],}\DataTypeTok{ncol =} \DecValTok{1}\NormalTok{,}\DataTypeTok{cex =} \DecValTok{1}\NormalTok{)}
  \KeywordTok{dev.off}\NormalTok{()}
  
\NormalTok{  tabladenombress<-}\ControlFlowTok{function}\NormalTok{(df)\{}
\NormalTok{    group_number<-}\KeywordTok{length}\NormalTok{(}\KeywordTok{attr}\NormalTok{(}\KeywordTok{group_by}\NormalTok{(df,experimento,angulo), }\StringTok{"group"}\NormalTok{))}
\NormalTok{    tabladenombres<-}\StringTok{ }\KeywordTok{matrix}\NormalTok{(}\OperatorTok{-}\DecValTok{31}\NormalTok{,}\DataTypeTok{ncol =} \DecValTok{2}\NormalTok{, }\DataTypeTok{nrow =}\NormalTok{ group_number)}
    \ControlFlowTok{for}\NormalTok{ (grupos }\ControlFlowTok{in} \DecValTok{1}\OperatorTok{:}\NormalTok{group_number) \{}
\NormalTok{      grupos_rpm_resistencia<-}\StringTok{ }\NormalTok{df }\OperatorTok{%>%}\StringTok{ }\KeywordTok{group_by}\NormalTok{(.,experimento,angulo) }\OperatorTok{%>%}\StringTok{ }\KeywordTok{select_groups}\NormalTok{(grupos)}
\NormalTok{      tabladenombres[grupos,}\DecValTok{1}\NormalTok{]<-}\KeywordTok{as.character}\NormalTok{(grupos_rpm_resistencia}\OperatorTok{$}\NormalTok{experimento[}\DecValTok{1}\NormalTok{])}
\NormalTok{      tabladenombres[grupos,}\DecValTok{2}\NormalTok{]<-}\StringTok{ }\KeywordTok{as.character}\NormalTok{(grupos_rpm_resistencia}\OperatorTok{$}\NormalTok{angulo[}\DecValTok{1}\NormalTok{])}
\NormalTok{    \}}
    \KeywordTok{return}\NormalTok{(}\KeywordTok{as.data.frame}\NormalTok{(tabladenombres))}
\NormalTok{  \}}
  
\NormalTok{  tablanombres<-}\KeywordTok{tabladenombress}\NormalTok{(df)}
  
\NormalTok{  coeficientes_P_V_modelo<-}\KeywordTok{data.frame}\NormalTok{(}\KeywordTok{matrix}\NormalTok{(}\KeywordTok{unlist}\NormalTok{(lista_coef_modelo),}\DataTypeTok{nrow=}\DecValTok{5}\NormalTok{, }\DataTypeTok{byrow=}\NormalTok{T))}
\NormalTok{  coeficientes_P_V_prototipo<-}\KeywordTok{data.frame}\NormalTok{(}\KeywordTok{matrix}\NormalTok{(}\KeywordTok{unlist}\NormalTok{(lista_coef_prototipo),}\DataTypeTok{nrow=}\DecValTok{5}\NormalTok{, }\DataTypeTok{byrow=}\NormalTok{T))}
  
\NormalTok{  coef_tabla<-}\StringTok{ }\KeywordTok{cbind}\NormalTok{(tablanombres,coeficientes_P_V_prototipo) }
  \KeywordTok{names}\NormalTok{(coef_tabla)<-}\KeywordTok{c}\NormalTok{(}\StringTok{"Experimento"}\NormalTok{,}\StringTok{"Angulo"}\NormalTok{,}\StringTok{"a"}\NormalTok{,}\StringTok{"b"}\NormalTok{)}
  
  \KeywordTok{return}\NormalTok{(coef_tabla)}
  
\NormalTok{\}}

\CommentTok{#ploteos de curvs Cp-lambda comparativas}
\NormalTok{ploteo_CPmax10<-}\StringTok{ }\ControlFlowTok{function}\NormalTok{(datos,grados)\{}
\NormalTok{  df<-datos}
\NormalTok{  select_groups <-}\StringTok{ }\ControlFlowTok{function}\NormalTok{(data, groups) \{}
\NormalTok{    data[}\KeywordTok{sort}\NormalTok{(}\KeywordTok{unlist}\NormalTok{(}\KeywordTok{attr}\NormalTok{(data, }\StringTok{"indices"}\NormalTok{)[ groups ])) }\OperatorTok{+}\StringTok{ }\DecValTok{1}\NormalTok{, ]}
\NormalTok{  \}}
  
\NormalTok{  lista_Cpmax_total<-}\KeywordTok{list}\NormalTok{()}
\NormalTok{  lista_Cps_nueva<-}\KeywordTok{list}\NormalTok{()}
\NormalTok{  nombres_gra<-}\StringTok{ }\KeywordTok{vector}\NormalTok{()}
\NormalTok{  group_number<-}\KeywordTok{length}\NormalTok{(}\KeywordTok{attr}\NormalTok{(}\KeywordTok{group_by}\NormalTok{(df,experimento,angulo), }\StringTok{"group"}\NormalTok{))}
  \ControlFlowTok{for}\NormalTok{ (groups_ind }\ControlFlowTok{in} \DecValTok{1}\OperatorTok{:}\NormalTok{group_number) \{}
    
\NormalTok{    xx<-}\StringTok{ }\NormalTok{df }\OperatorTok{%>%}\StringTok{ }\KeywordTok{group_by}\NormalTok{(.,experimento,angulo) }\OperatorTok{%>%}\StringTok{ }\KeywordTok{select_groups}\NormalTok{(groups_ind)}
\NormalTok{    percentaje_number<-}\KeywordTok{length}\NormalTok{(}\KeywordTok{attr}\NormalTok{(}\KeywordTok{group_by}\NormalTok{(xx,porcentaje), }\StringTok{"group"}\NormalTok{) )}
    
\NormalTok{    nombre_}\DecValTok{1}\NormalTok{<-}\KeywordTok{as.character}\NormalTok{(xx}\OperatorTok{$}\NormalTok{experimento[}\DecValTok{1}\NormalTok{])}
\NormalTok{    nombre_}\DecValTok{2}\NormalTok{<-}\KeywordTok{as.character}\NormalTok{(xx}\OperatorTok{$}\NormalTok{angulo[}\DecValTok{1}\NormalTok{])}
\NormalTok{    nombre<-}\KeywordTok{paste}\NormalTok{(nombre_}\DecValTok{1}\NormalTok{,nombre_}\DecValTok{2}\NormalTok{,}\DataTypeTok{sep =} \StringTok{"_"}\NormalTok{)}
    
    \ControlFlowTok{if}\NormalTok{(}\KeywordTok{is.na}\NormalTok{(nombre_}\DecValTok{2}\NormalTok{))\{}
\NormalTok{      nombre_grafica<-}\StringTok{ }\NormalTok{nombre_}\DecValTok{1}
\NormalTok{    \}}\ControlFlowTok{else}\NormalTok{\{}
\NormalTok{      nombre_grafica<-}\KeywordTok{paste}\NormalTok{(nombre_}\DecValTok{1}\NormalTok{,}\StringTok{" "}\NormalTok{,nombre_}\DecValTok{2}\NormalTok{,}\StringTok{"º"}\NormalTok{,}\DataTypeTok{sep =} \StringTok{""}\NormalTok{)}
\NormalTok{    \}}
    
\NormalTok{    xx_percentaje<-}\KeywordTok{list}\NormalTok{()}
    \ControlFlowTok{for}\NormalTok{ (per }\ControlFlowTok{in} \DecValTok{1}\OperatorTok{:}\NormalTok{percentaje_number) \{}
\NormalTok{      xx_perc<-}\StringTok{ }\NormalTok{xx }\OperatorTok{%>%}\StringTok{ }\KeywordTok{group_by}\NormalTok{(.,porcentaje) }\OperatorTok{%>%}\StringTok{ }\KeywordTok{select_groups}\NormalTok{(per)}
\NormalTok{      xx_perc<-}\KeywordTok{cbind}\NormalTok{(xx_perc}\OperatorTok{$}\NormalTok{cp_alfa,xx_perc}\OperatorTok{$}\NormalTok{TSR_alfa,xx_perc}\OperatorTok{$}\NormalTok{V_viento_alfa)}
      \KeywordTok{colnames}\NormalTok{(xx_perc)<-}\StringTok{ }\KeywordTok{c}\NormalTok{(}\StringTok{"cp"}\NormalTok{,}\StringTok{"TSR"}\NormalTok{, }\StringTok{"Vviento"}\NormalTok{)}
\NormalTok{      xx_percentaje[[per]]<-}\StringTok{ }\NormalTok{xx_perc}
      
\NormalTok{    \}}
    
    
    
    
\NormalTok{    ##lambda_cp es una tabla de dos columnas (cp,lambda) }
\NormalTok{    lambda_Cp<-}\StringTok{ }\NormalTok{xx_percentaje}
\NormalTok{    lambda_Cp_clean<-}\KeywordTok{list}\NormalTok{()}
    \ControlFlowTok{for}\NormalTok{(j }\ControlFlowTok{in} \DecValTok{1}\OperatorTok{:}\KeywordTok{length}\NormalTok{(lambda_Cp))\{}
\NormalTok{      cp_lmb<-}\StringTok{ }\NormalTok{lambda_Cp[[j]]}
\NormalTok{      cp_lmb<-cp_lmb[}\KeywordTok{order}\NormalTok{(cp_lmb[,}\DecValTok{2}\NormalTok{]),]}
      
      
\NormalTok{      TSR_}\DecValTok{1}\NormalTok{<-cp_lmb[,}\DecValTok{2}\NormalTok{]}
\NormalTok{      Cp_}\DecValTok{1}\NormalTok{<-cp_lmb[,}\DecValTok{1}\NormalTok{]}
      
\NormalTok{      V_tsr<-}\StringTok{ }\KeywordTok{seq}\NormalTok{(}\FloatTok{0.05}\NormalTok{,}\KeywordTok{max}\NormalTok{(TSR_}\DecValTok{1}\NormalTok{),}\DataTypeTok{by=}\KeywordTok{max}\NormalTok{(TSR_}\DecValTok{1}\NormalTok{)}\OperatorTok{/}\DecValTok{8}\NormalTok{)}
\NormalTok{      TSR_}\DecValTok{2}\NormalTok{<-}\StringTok{ }\KeywordTok{vector}\NormalTok{()}
\NormalTok{      Cp_}\DecValTok{2}\NormalTok{<-}\StringTok{ }\KeywordTok{vector}\NormalTok{()}
      
      \ControlFlowTok{for}\NormalTok{(i }\ControlFlowTok{in} \DecValTok{1}\OperatorTok{:}\KeywordTok{length}\NormalTok{(V_tsr))\{}
        
\NormalTok{        Cp_}\DecValTok{2}\NormalTok{[i]<-}\StringTok{ }\NormalTok{Cp_}\DecValTok{1}\NormalTok{[}\KeywordTok{which.min}\NormalTok{(}\KeywordTok{abs}\NormalTok{(TSR_}\DecValTok{1}\OperatorTok{-}\NormalTok{V_tsr[i]))]}
\NormalTok{        TSR_}\DecValTok{2}\NormalTok{[i]<-TSR_}\DecValTok{1}\NormalTok{[}\KeywordTok{which.min}\NormalTok{(}\KeywordTok{abs}\NormalTok{(TSR_}\DecValTok{1}\OperatorTok{-}\NormalTok{V_tsr[i]))]}
        
\NormalTok{      \}}
\NormalTok{      validacion<-}\KeywordTok{cbind}\NormalTok{(}\KeywordTok{unique}\NormalTok{(Cp_}\DecValTok{2}\NormalTok{),}\KeywordTok{unique}\NormalTok{(TSR_}\DecValTok{2}\NormalTok{))}
\NormalTok{      validacion_}\DecValTok{1}\NormalTok{<-}\StringTok{ }\NormalTok{validacion[}\DecValTok{1}\OperatorTok{:}\KeywordTok{which.max}\NormalTok{(validacion[,}\DecValTok{1}\NormalTok{]),]}
\NormalTok{      validacion_}\DecValTok{2}\NormalTok{<-}\StringTok{ }\NormalTok{validacion[(}\KeywordTok{which.max}\NormalTok{(validacion[,}\DecValTok{1}\NormalTok{])}\OperatorTok{+}\DecValTok{1}\NormalTok{)}\OperatorTok{:}\KeywordTok{length}\NormalTok{(validacion[,}\DecValTok{1}\NormalTok{]),]}
\NormalTok{      indeeex<-}\StringTok{ }\KeywordTok{vector}\NormalTok{()}
\NormalTok{      rr<-}\StringTok{ }\DecValTok{1} 
      
      \ControlFlowTok{if}\NormalTok{(}\KeywordTok{length}\NormalTok{(validacion_}\DecValTok{2}\NormalTok{)}\OperatorTok{==}\DecValTok{2}\NormalTok{)\{}
\NormalTok{        validacion_}\DecValTok{2}\NormalTok{<-}\StringTok{ }\NormalTok{validacion_}\DecValTok{2}
\NormalTok{      \}}\ControlFlowTok{else}\NormalTok{\{}
        \ControlFlowTok{for}\NormalTok{ (i }\ControlFlowTok{in} \DecValTok{1}\OperatorTok{:}\KeywordTok{length}\NormalTok{(validacion_}\DecValTok{2}\NormalTok{[,}\DecValTok{1}\NormalTok{])) \{}
          
          
          \ControlFlowTok{if}\NormalTok{(i}\OperatorTok{==}\KeywordTok{length}\NormalTok{(validacion_}\DecValTok{2}\NormalTok{[,}\DecValTok{1}\NormalTok{]))\{}\ControlFlowTok{break}\NormalTok{\}}\ControlFlowTok{else}\NormalTok{\{}
            
            \ControlFlowTok{if}\NormalTok{(validacion_}\DecValTok{2}\NormalTok{[i,}\DecValTok{1}\NormalTok{] }\OperatorTok{<}\StringTok{ }\NormalTok{validacion_}\DecValTok{2}\NormalTok{[(i}\OperatorTok{+}\DecValTok{1}\NormalTok{),}\DecValTok{1}\NormalTok{])\{}
\NormalTok{              indeeex[rr]<-}\StringTok{ }\KeywordTok{as.numeric}\NormalTok{(i) }
\NormalTok{              rr<-rr}\OperatorTok{+}\DecValTok{1}
              
              
\NormalTok{            \}}
            
\NormalTok{          \}}
\NormalTok{        \}}
        
\NormalTok{      \}}
      
      
      \ControlFlowTok{if}\NormalTok{(}\KeywordTok{length}\NormalTok{(indeeex)}\OperatorTok{==}\DecValTok{0}\NormalTok{)\{}
\NormalTok{        validacion_}\DecValTok{2}\NormalTok{<-}\StringTok{ }\NormalTok{validacion_}\DecValTok{2}
\NormalTok{      \}}\ControlFlowTok{else}\NormalTok{\{}
\NormalTok{        validacion_}\DecValTok{2}\NormalTok{<-validacion_}\DecValTok{2}\NormalTok{[}\OperatorTok{-}\NormalTok{indeeex,]}
\NormalTok{      \}}
      
\NormalTok{      clean_table<-}\KeywordTok{rbind}\NormalTok{(validacion_}\DecValTok{1}\NormalTok{,validacion_}\DecValTok{2}\NormalTok{)}
      
      
\NormalTok{      lambda_Cp_clean[[j]]<-}\StringTok{ }\NormalTok{clean_table}
      
\NormalTok{    \}}
    
\NormalTok{    lista_Cps_nueva[[groups_ind]]<-}\StringTok{ }\NormalTok{lambda_Cp_clean}
\NormalTok{    nombres_gra[groups_ind]<-}\StringTok{ }\NormalTok{nombre_grafica}
    
\NormalTok{  \} }
  
\NormalTok{  vector_nombre_vel<-}\StringTok{ }\KeywordTok{c}\NormalTok{(}\FloatTok{10.34}\NormalTok{,}\FloatTok{5.47}\NormalTok{,}\FloatTok{6.04}\NormalTok{,}\FloatTok{7.29}\NormalTok{,}\FloatTok{8.33}\NormalTok{,}\FloatTok{9.36}\NormalTok{)}
  
  
  \ControlFlowTok{for}\NormalTok{ (porcentaje }\ControlFlowTok{in} \DecValTok{1}\OperatorTok{:}\KeywordTok{length}\NormalTok{(lista_Cps_nueva[[}\DecValTok{1}\NormalTok{]])) \{}
    
\NormalTok{    lista_cpmsVmax<-}\StringTok{ }\KeywordTok{lapply}\NormalTok{(lista_Cps_nueva,}\StringTok{"[["}\NormalTok{,porcentaje)}
    
\NormalTok{    x_max<-}\KeywordTok{max}\NormalTok{(}\KeywordTok{sapply}\NormalTok{(lista_cpmsVmax, }\ControlFlowTok{function}\NormalTok{(x) }\KeywordTok{max}\NormalTok{(x[,}\DecValTok{2}\NormalTok{])))}
\NormalTok{    y_max<-}\KeywordTok{max}\NormalTok{(}\KeywordTok{sapply}\NormalTok{(lista_cpmsVmax, }\ControlFlowTok{function}\NormalTok{(x) }\KeywordTok{max}\NormalTok{(x[,}\DecValTok{1}\NormalTok{])))}
    
    
    \KeywordTok{dir.create}\NormalTok{(}\KeywordTok{paste0}\NormalTok{(}\KeywordTok{here}\NormalTok{(),}\StringTok{"/graficos_Cp_juntos/"}\NormalTok{))}
    
    \CommentTok{#jpeg(paste0(here(),"/graficos_Cp_juntos/",porcentaje,".jpeg"))}
    \KeywordTok{tiff}\NormalTok{(}\KeywordTok{paste0}\NormalTok{(}\KeywordTok{here}\NormalTok{(),}\StringTok{"/graficos_Cp_juntos/"}\NormalTok{,porcentaje,}\StringTok{".tiff"}\NormalTok{), }\DataTypeTok{width =} \DecValTok{7}\NormalTok{, }\DataTypeTok{height =}\DecValTok{7}\NormalTok{, }\DataTypeTok{units =} \StringTok{'in'}\NormalTok{, }\DataTypeTok{res =} \DecValTok{300}\NormalTok{)}
\NormalTok{    colores<-}\StringTok{ }\KeywordTok{c}\NormalTok{(}\StringTok{"orange"}\NormalTok{,}\StringTok{"red"}\NormalTok{,}\StringTok{"blue"}\NormalTok{,}\StringTok{"dodgerblue4"}\NormalTok{,}\StringTok{"purple"}\NormalTok{)}
\NormalTok{    pch_dif<-}\KeywordTok{c}\NormalTok{(}\DecValTok{0}\OperatorTok{:}\DecValTok{5}\NormalTok{)}
    \ControlFlowTok{for}\NormalTok{(i }\ControlFlowTok{in} \DecValTok{1}\OperatorTok{:}\NormalTok{(}\KeywordTok{length}\NormalTok{(lista_cpmsVmax)))\{}
\NormalTok{      x<-}\StringTok{ }\NormalTok{lista_cpmsVmax[[i]][,}\DecValTok{2}\NormalTok{]}
\NormalTok{      y<-}\StringTok{ }\NormalTok{lista_cpmsVmax[[i]][,}\DecValTok{1}\NormalTok{]}
\NormalTok{      fit5<-}\KeywordTok{lm}\NormalTok{(y}\OperatorTok{~}\KeywordTok{poly}\NormalTok{(x,grados,}\DataTypeTok{raw=}\OtherTok{TRUE}\NormalTok{))}
\NormalTok{      xx <-}\StringTok{ }\KeywordTok{seq}\NormalTok{(}\KeywordTok{min}\NormalTok{(x),}\KeywordTok{max}\NormalTok{(x), }\DataTypeTok{by=}\FloatTok{0.01}\NormalTok{)}
      
      \KeywordTok{plot}\NormalTok{(}\OtherTok{NULL}\NormalTok{,}\DataTypeTok{xlim=}\KeywordTok{c}\NormalTok{(}\DecValTok{0}\NormalTok{,(x_max}\OperatorTok{+}\FloatTok{0.2}\NormalTok{)),}
           \DataTypeTok{ylim =} \KeywordTok{c}\NormalTok{(}\DecValTok{0}\NormalTok{,(y_max}\OperatorTok{+}\FloatTok{0.01}\NormalTok{)),}\DataTypeTok{cex=}\FloatTok{0.005}\NormalTok{, }\DataTypeTok{yaxt =}\StringTok{"n"}\NormalTok{,}
           \DataTypeTok{xlab =} \StringTok{"TSR"}\NormalTok{, }\DataTypeTok{ylab =} \StringTok{"Cp"}\NormalTok{, }\DataTypeTok{bty=}\StringTok{'L'}\NormalTok{)}
      \KeywordTok{par}\NormalTok{(}\DataTypeTok{new=}\NormalTok{T)}
      \KeywordTok{lines}\NormalTok{(xx, }\KeywordTok{predict}\NormalTok{(fit5, }\KeywordTok{data.frame}\NormalTok{(}\DataTypeTok{x=}\NormalTok{xx)), }\DataTypeTok{col=}\NormalTok{colores[i],}\DataTypeTok{lwd=}\DecValTok{2}\NormalTok{)}
\NormalTok{      tabla_maxcp<-}\KeywordTok{cbind}\NormalTok{(xx,}\KeywordTok{predict}\NormalTok{(fit5, }\KeywordTok{data.frame}\NormalTok{(}\DataTypeTok{x=}\NormalTok{xx)))}
      \KeywordTok{par}\NormalTok{(}\DataTypeTok{new=}\NormalTok{T)}
\NormalTok{    \}}
    
    \KeywordTok{axis}\NormalTok{(}\DecValTok{2}\NormalTok{, }\DataTypeTok{at=}\KeywordTok{unique}\NormalTok{(}\KeywordTok{round}\NormalTok{(}\KeywordTok{seq}\NormalTok{(}\DecValTok{0}\NormalTok{,(y_max}\OperatorTok{+}\FloatTok{0.02}\NormalTok{), }\DataTypeTok{by=}\KeywordTok{round}\NormalTok{((y_max}\OperatorTok{/}\DecValTok{10}\NormalTok{),}\DataTypeTok{digits =} \DecValTok{4}\NormalTok{)),}\DataTypeTok{digits =} \DecValTok{2}\NormalTok{)),}\DataTypeTok{las=}\DecValTok{2}\NormalTok{)}
    
\NormalTok{    leyenda<-}\KeywordTok{paste0}\NormalTok{(nombres_gra)}
    
    
    \KeywordTok{legend}\NormalTok{(}\StringTok{"topright"}\NormalTok{, }\DataTypeTok{inset=}\KeywordTok{c}\NormalTok{(}\DecValTok{0}\NormalTok{,}\DecValTok{0}\NormalTok{),leyenda,}
           \DataTypeTok{text.col =}\NormalTok{ colores,}\DataTypeTok{ncol =} \DecValTok{1}\NormalTok{,}\DataTypeTok{cex =} \DecValTok{1}\NormalTok{)}
    
\NormalTok{    titulo<-}\StringTok{ }\KeywordTok{paste0}\NormalTok{(}\StringTok{"Comparación de gráficas Cp-TSR }\CharTok{\textbackslash{}n}\StringTok{ con el túnel de viento al 100 %"}\NormalTok{)}
    \KeywordTok{title}\NormalTok{(}\DataTypeTok{main =}\NormalTok{ titulo)}
    
    \KeywordTok{dev.off}\NormalTok{()}
    
    
\NormalTok{  \}}
  
\NormalTok{\} }
\end{Highlighting}
\end{Shaded}

\subsubsection{Script de aplicación}\label{script-de-aplicacion}

You can also embed plots, for example:

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{library}\NormalTok{(here)}
\KeywordTok{source}\NormalTok{(}\KeywordTok{here}\NormalTok{(}\StringTok{'funciones_necesarias.R'}\NormalTok{),}\DataTypeTok{encoding =} \StringTok{"UTF-8"}\NormalTok{)}

\NormalTok{data_path<-}\StringTok{ }\KeywordTok{here}\NormalTok{(}\StringTok{'data/'}\NormalTok{)}
\NormalTok{archivos <-}\StringTok{ }\KeywordTok{list.files}\NormalTok{(data_path, }\DataTypeTok{pattern =} \StringTok{'csv'}\NormalTok{,}
                       \DataTypeTok{recursive =} \OtherTok{TRUE}\NormalTok{, }\DataTypeTok{full.names =} \OtherTok{TRUE}\NormalTok{)}

\NormalTok{r<-}\FloatTok{0.27}\OperatorTok{/}\DecValTok{2} \CommentTok{#radio del cacharro}


\CommentTok{#Aplicamos función "procesador" y creamos la tabla principal "df"}
\NormalTok{lista_procesada<-}\KeywordTok{lapply}\NormalTok{(archivos, procesador)}
\NormalTok{column_names <-}\StringTok{ }\KeywordTok{names}\NormalTok{(lista_procesada[[}\DecValTok{1}\NormalTok{]])}
\NormalTok{df <-}\StringTok{ }\KeywordTok{data.frame}\NormalTok{(}\KeywordTok{matrix}\NormalTok{(}\KeywordTok{unlist}\NormalTok{(lista_procesada), }
                        \DataTypeTok{nrow=}\KeywordTok{length}\NormalTok{(lista_procesada), }
                        \DataTypeTok{byrow=}\NormalTok{T),}\DataTypeTok{stringsAsFactors=}\OtherTok{FALSE}\NormalTok{)}
\KeywordTok{colnames}\NormalTok{(df) <-}\StringTok{ }\NormalTok{column_names}
\NormalTok{df<-}\StringTok{ }\KeywordTok{cbind}\NormalTok{(archivos,df)}


\CommentTok{#Realizamos modificaciones y calculos en tabla "df". Añadiendo columnas de potencia, Cp y TSR}

\NormalTok{df<-}\StringTok{ }\KeywordTok{df_mutate}\NormalTok{(df)}



\CommentTok{#Se ejecuta el script "tratamiento_outliers" para obtener una corrección de los valores atípicos}
\KeywordTok{source}\NormalTok{(}\KeywordTok{here}\NormalTok{(}\StringTok{'tratamiento_outliers.R'}\NormalTok{))}

\CommentTok{#Corrección de valores atípicos}
\NormalTok{coeficientes_RPM<-}\KeywordTok{ajuste_RPM_Resistencia_so}\NormalTok{(df,tablas_sin_outliers_ni_decreasing)}
\NormalTok{coeficientes_RPM<-}\KeywordTok{data.frame}\NormalTok{(}\KeywordTok{matrix}\NormalTok{(}\KeywordTok{unlist}\NormalTok{(coeficientes_RPM), }\DataTypeTok{nrow=}\DecValTok{30}\NormalTok{, }\DataTypeTok{byrow=}\NormalTok{T))}
\KeywordTok{names}\NormalTok{(coeficientes_RPM)<-}\StringTok{ }\KeywordTok{c}\NormalTok{(}\StringTok{"Experimento"}\NormalTok{,}\StringTok{"Angulo"}\NormalTok{,}\StringTok{"Porcentaje"}\NormalTok{,}\StringTok{"a"}\NormalTok{,}\StringTok{"b"}\NormalTok{)}


\CommentTok{#Se añaden coeficientes de la regresión a la tabla principal "df"}
\NormalTok{df<-}\KeywordTok{add_coef}\NormalTok{(df,coeficientes_RPM)}



\CommentTok{#Ploteamos curvas Cp-lambda}
\KeywordTok{ploteo_experimento_corr_RPM_regresion}\NormalTok{(df,}\DecValTok{3}\NormalTok{)}

\CommentTok{#Obtención de los Cp máximos}
\NormalTok{tabla_cpmax_tsr<-}\KeywordTok{ploteo_experimento_estandar_RPM_regresion_CPmax}\NormalTok{(df,}\DecValTok{3}\NormalTok{)}

\CommentTok{#Ploteos de Cp-lamdba comparativos}
\KeywordTok{ploteo_CPmax10}\NormalTok{(df,}\DecValTok{2}\NormalTok{)}

\CommentTok{#Ploteos de curva de potencia añadiendo los limites de las gráficas}
\NormalTok{limitex<-}\StringTok{ }\KeywordTok{c}\NormalTok{(}\DecValTok{0}\NormalTok{,}\DecValTok{11}\NormalTok{)}
\NormalTok{limitey<-}\StringTok{ }\KeywordTok{c}\NormalTok{(}\DecValTok{0}\NormalTok{,}\DecValTok{20}\NormalTok{)}
\NormalTok{coeficientes_Curva_P_V<-}\StringTok{ }\KeywordTok{grafica_Potencia_V}\NormalTok{(df,limitex,limitey,}\DecValTok{2}\NormalTok{)}
\KeywordTok{grafica_Potencia_V_alfa}\NormalTok{(df,limitex,limitey)}
\end{Highlighting}
\end{Shaded}

\subsubsection{Script para el tratamiento de valores
atípicos}\label{script-para-el-tratamiento-de-valores-atipicos}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{library}\NormalTok{(outliers)}
\NormalTok{outliers_prueba<-}\KeywordTok{ajuste_RPM_Resistencia}\NormalTok{(df)}
\NormalTok{RPM_outliers<-}\KeywordTok{sapply}\NormalTok{(outliers_prueba, }\StringTok{"["}\NormalTok{,,}\DecValTok{1}\NormalTok{)}
\NormalTok{Resistencia_outliers<-}\KeywordTok{sapply}\NormalTok{(outliers_prueba, }\StringTok{"["}\NormalTok{,,}\DecValTok{2}\NormalTok{)}
\NormalTok{Resistencia_outliers<-}\KeywordTok{sapply}\NormalTok{(Resistencia_outliers, }\ControlFlowTok{function}\NormalTok{(x) }\KeywordTok{as.numeric}\NormalTok{(}\KeywordTok{as.character}\NormalTok{(x)))}
\NormalTok{chisq_outlier<-}\KeywordTok{t}\NormalTok{(}\KeywordTok{sapply}\NormalTok{(RPM_outliers, chisq.out.test))}
\NormalTok{alternative_outlier<-}\StringTok{ }\NormalTok{chisq_outlier[,}\DecValTok{2}\NormalTok{]}
\NormalTok{alternative_outlier<-}\KeywordTok{str_extract_all}\NormalTok{(alternative_outlier,}\StringTok{"}\CharTok{\textbackslash{}\textbackslash{}}\StringTok{d+"}\NormalTok{)}
\NormalTok{make_outlier<-}\StringTok{ }\ControlFlowTok{function}\NormalTok{(x)\{}
 
  \KeywordTok{return}\NormalTok{( }\KeywordTok{paste}\NormalTok{(}\KeywordTok{as.numeric}\NormalTok{(x[}\DecValTok{1}\NormalTok{]),}\KeywordTok{as.numeric}\NormalTok{(x[}\DecValTok{2}\NormalTok{]), }\DataTypeTok{sep =} \StringTok{"."}\NormalTok{))}
\NormalTok{\}}
\NormalTok{alternative_outlier<-}\StringTok{ }\KeywordTok{sapply}\NormalTok{(alternative_outlier,make_outlier)}
\NormalTok{Eliminar_outlier<-}\StringTok{ }\ControlFlowTok{function}\NormalTok{(lista_rpms, vector_outliers)\{}
\NormalTok{  difff<-}\StringTok{ }\KeywordTok{abs}\NormalTok{(lista_rpms[}\KeywordTok{length}\NormalTok{(lista_rpms)]}\OperatorTok{-}\KeywordTok{as.numeric}\NormalTok{(vector_outliers))}
\ControlFlowTok{if}\NormalTok{(difff}\OperatorTok{<}\StringTok{ }\DecValTok{1}\NormalTok{)\{}
\NormalTok{  ret<-lista_rpms[}\OperatorTok{-}\KeywordTok{length}\NormalTok{(lista_rpms)]}
\NormalTok{\}}\ControlFlowTok{else}\NormalTok{\{ret<-}\StringTok{ }\NormalTok{lista_rpms\}}
 \KeywordTok{return}\NormalTok{(ret) }
\NormalTok{\}}
\NormalTok{RPM_sin_outliers<-}\StringTok{ }\KeywordTok{lapply}\NormalTok{(RPM_outliers, Eliminar_outlier, }\DataTypeTok{vector_outliers=}\NormalTok{alternative_outlier)}

\NormalTok{tabla_sin_outliers<-}\StringTok{ }\ControlFlowTok{function}\NormalTok{(resistencia,rpms)\{}
  \ControlFlowTok{if}\NormalTok{(}\KeywordTok{length}\NormalTok{(resistencia)}\OperatorTok{==}\KeywordTok{length}\NormalTok{(rpms))\{}
\NormalTok{   tabla<-}\KeywordTok{cbind}\NormalTok{(rpms,resistencia)}
\NormalTok{  \}}\ControlFlowTok{else}\NormalTok{\{}
\NormalTok{    tabla<-}\StringTok{ }\KeywordTok{cbind}\NormalTok{(rpms, resistencia[}\OperatorTok{-}\KeywordTok{length}\NormalTok{(resistencia)])}
\NormalTok{  \}}
  \KeywordTok{return}\NormalTok{(tabla)}
\NormalTok{\}}
\NormalTok{tablas_sin_ot<-}\KeywordTok{mapply}\NormalTok{(tabla_sin_outliers, }\DataTypeTok{rpms=}\NormalTok{RPM_sin_outliers, }\DataTypeTok{resistencia=}\NormalTok{Resistencia_outliers)}

\NormalTok{eliminar_decreasing<-}\ControlFlowTok{function}\NormalTok{(validacion)\{}
\NormalTok{  indeeex<-}\StringTok{ }\KeywordTok{vector}\NormalTok{()}
\NormalTok{  rr<-}\StringTok{ }\DecValTok{1} 
  
  \ControlFlowTok{for}\NormalTok{ (i }\ControlFlowTok{in} \DecValTok{1}\OperatorTok{:}\KeywordTok{length}\NormalTok{(validacion[,}\DecValTok{1}\NormalTok{])) \{}
    \ControlFlowTok{if}\NormalTok{(i}\OperatorTok{==}\KeywordTok{length}\NormalTok{(validacion[,}\DecValTok{1}\NormalTok{]))\{}\ControlFlowTok{break}\NormalTok{\}}\ControlFlowTok{else}\NormalTok{\{}
      
      \ControlFlowTok{if}\NormalTok{(validacion[i}\OperatorTok{+}\DecValTok{1}\NormalTok{,}\DecValTok{1}\NormalTok{] }\OperatorTok{<}\StringTok{ }\NormalTok{validacion[(i),}\DecValTok{1}\NormalTok{])\{}
\NormalTok{        indeeex[rr]<-}\StringTok{ }\KeywordTok{as.numeric}\NormalTok{(i}\OperatorTok{+}\DecValTok{1}\NormalTok{) }
\NormalTok{        rr<-rr}\OperatorTok{+}\DecValTok{1}
        
        
\NormalTok{      \}}
      
\NormalTok{    \}}
\NormalTok{  \}}
  
  \ControlFlowTok{if}\NormalTok{(}\KeywordTok{length}\NormalTok{(indeeex)}\OperatorTok{==}\DecValTok{0}\NormalTok{)\{}
\NormalTok{    validacion<-}\StringTok{ }\NormalTok{validacion}
\NormalTok{  \}}\ControlFlowTok{else}\NormalTok{\{}
\NormalTok{    validacion<-validacion[}\OperatorTok{-}\NormalTok{indeeex,]}
\NormalTok{  \}}
  
  \KeywordTok{return}\NormalTok{(validacion)}
\NormalTok{\}}

\NormalTok{tablas_sin_outliers_ni_decreasing<-}\KeywordTok{lapply}\NormalTok{(tablas_sin_ot, eliminar_decreasing)}
\end{Highlighting}
\end{Shaded}

\subsubsection{Script para el tratamiento de los datos aportados por
ERA-Interim}\label{script-para-el-tratamiento-de-los-datos-aportados-por-era-interim}

Este script es para analizar los datos aportados por el ERA-interim y
además obtener la energía anual esperada de la instalación. Además, se
incluyen las funciones generadoras de rosas de los vientos y diagramas
de barras.

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{#archivo binario .nc. }
\KeywordTok{library}\NormalTok{(RNetCDF)}
\KeywordTok{library}\NormalTok{(dplyr)}
\KeywordTok{library}\NormalTok{(here)}
\KeywordTok{library}\NormalTok{(openair)}
\KeywordTok{library}\NormalTok{(ggplot2)}
\CommentTok{#Creo un objeto string con el nombre completo del archivo}
\CommentTok{#PATH+nombre}
\NormalTok{inputpath<-}\StringTok{ }\KeywordTok{here}\NormalTok{()}

\NormalTok{inputfile<-}\KeywordTok{paste}\NormalTok{(inputpath,}\StringTok{"/bilbo1979_2017.nc"}\NormalTok{,}\DataTypeTok{sep=}\StringTok{""}\NormalTok{ )}

\CommentTok{#Acceder al contenido del archivo}
\CommentTok{# 2 pasos: 1.Abro el archivo; 2. Leo el archivo}
\NormalTok{SATALT_ini<-}\KeywordTok{open.nc}\NormalTok{(inputfile)}

\CommentTok{#Vemos un resumen del contenido}
\KeywordTok{print.nc}\NormalTok{(SATALT_ini)}

\CommentTok{#2.1 Leo el tiempo}
\NormalTok{time_}\DecValTok{1}\NormalTok{<-}\KeywordTok{var.get.nc}\NormalTok{(SATALT_ini,}\StringTok{"time"}\NormalTok{)}

\CommentTok{#2.2 Latitud}
\NormalTok{latitude_}\DecValTok{1}\NormalTok{<-}\KeywordTok{var.get.nc}\NormalTok{(SATALT_ini,}\StringTok{"latitude"}\NormalTok{)}

\CommentTok{#2.3 Longitud}
\NormalTok{longitude_}\DecValTok{1}\NormalTok{<-}\KeywordTok{var.get.nc}\NormalTok{(SATALT_ini,}\StringTok{"longitude"}\NormalTok{)}

\CommentTok{#localización del edificio}
\NormalTok{lonref0<-}\StringTok{ }\FloatTok{357.054}\NormalTok{; latref0<-}\StringTok{ }\FloatTok{43.258}

\NormalTok{idlon<-}\KeywordTok{which.min}\NormalTok{(}\KeywordTok{abs}\NormalTok{(longitude_}\DecValTok{1} \OperatorTok{-}\StringTok{ }\NormalTok{lonref0))}
\NormalTok{longitude_}\DecValTok{1}\NormalTok{[idlon]}

\NormalTok{idlat<-}\KeywordTok{which.min}\NormalTok{(}\KeywordTok{abs}\NormalTok{(latitude_}\DecValTok{1}\OperatorTok{-}\NormalTok{latref0))}
\NormalTok{latitude_}\DecValTok{1}\NormalTok{[idlat]}


\NormalTok{u10<-}\KeywordTok{var.get.nc}\NormalTok{(SATALT_ini,}\StringTok{"u10"}\NormalTok{, }\DataTypeTok{unpack =}\NormalTok{ T)}
\NormalTok{v10<-}\KeywordTok{var.get.nc}\NormalTok{(SATALT_ini,}\StringTok{"v10"}\NormalTok{,}\DataTypeTok{unpack =}\NormalTok{ T)}

\NormalTok{wind_abs =}\StringTok{ }\KeywordTok{sqrt}\NormalTok{(u10}\OperatorTok{^}\DecValTok{2} \OperatorTok{+}\StringTok{ }\NormalTok{v10}\OperatorTok{^}\DecValTok{2}\NormalTok{)}
\NormalTok{wind_dir_trig_to =}\StringTok{ }\KeywordTok{atan2}\NormalTok{(u10}\OperatorTok{/}\NormalTok{wind_abs, v10}\OperatorTok{/}\NormalTok{wind_abs) }
\NormalTok{wind_dir_trig_to_degrees =}\StringTok{ }\NormalTok{wind_dir_trig_to }\OperatorTok{*}\StringTok{ }\DecValTok{180}\OperatorTok{/}\NormalTok{pi ## -111.6 degrees}
\NormalTok{ind_dir_trig_from_degrees =}\StringTok{ }\NormalTok{wind_dir_trig_to_degrees }\OperatorTok{+}\StringTok{ }\DecValTok{180}\NormalTok{ ## 68.38 degrees}
\KeywordTok{summary}\NormalTok{(wind_abs)}

\NormalTok{tabla_loc<-}\KeywordTok{expand.grid}\NormalTok{(longitude_}\DecValTok{1}\NormalTok{,latitude_}\DecValTok{1}\NormalTok{)}
\NormalTok{tabla_loc_time<-}\StringTok{ }\KeywordTok{expand.grid}\NormalTok{(tabla_loc[,}\DecValTok{1}\NormalTok{],time_}\DecValTok{1}\NormalTok{)}
\NormalTok{tabla<-}\StringTok{ }\KeywordTok{as.data.frame}\NormalTok{(}\KeywordTok{cbind}\NormalTok{(tabla_loc_time[,}\DecValTok{1}\NormalTok{],tabla_loc[,}\DecValTok{2}\NormalTok{],tabla_loc_time[,}\DecValTok{2}\NormalTok{],}
\NormalTok{                            wind_abs,ind_dir_trig_from_degrees))}

\KeywordTok{names}\NormalTok{(tabla)<-}\StringTok{ }\KeywordTok{c}\NormalTok{(}\StringTok{"longitud"}\NormalTok{,}\StringTok{"latitud"}\NormalTok{,}\StringTok{"time"}\NormalTok{,}\StringTok{"ws"}\NormalTok{,}\StringTok{"wd"}\NormalTok{)}

\NormalTok{lon<-}\StringTok{ }\KeywordTok{unique}\NormalTok{(tabla}\OperatorTok{$}\NormalTok{longitud)}
\NormalTok{lat<-}\KeywordTok{unique}\NormalTok{(tabla}\OperatorTok{$}\NormalTok{latitud)}



\NormalTok{tabla_localizacion<-tabla[tabla}\OperatorTok{$}\NormalTok{longitud}\OperatorTok{==}\NormalTok{lon[}\DecValTok{2}\NormalTok{] }\OperatorTok{&}\StringTok{ }\NormalTok{tabla}\OperatorTok{$}\NormalTok{latitud}\OperatorTok{==}\NormalTok{lat[}\DecValTok{2}\NormalTok{],] }
\NormalTok{tabla_localizacion<-tabla_localizacion }\OperatorTok{%>%}\StringTok{ }\KeywordTok{mutate}\NormalTok{(}\DataTypeTok{grup_vel=}\KeywordTok{cut}\NormalTok{(tabla_localizacion}\OperatorTok{$}\NormalTok{ws,}
                                           \KeywordTok{seq}\NormalTok{(}\DecValTok{0}\NormalTok{,}\KeywordTok{max}\NormalTok{(tabla_localizacion}\OperatorTok{$}\NormalTok{ws),}\DataTypeTok{by=}\FloatTok{0.5}\NormalTok{),}
                                           \DataTypeTok{labels =} \KeywordTok{seq}\NormalTok{(}\FloatTok{0.5}\NormalTok{,}\KeywordTok{max}\NormalTok{(tabla_localizacion}\OperatorTok{$}\NormalTok{ws),}\DataTypeTok{by=}\FloatTok{0.5}\NormalTok{), }
                                           \DataTypeTok{include.lowest =}\NormalTok{ T,}\DataTypeTok{right =}\NormalTok{ T))}

\NormalTok{tabla_localizacion_altura<-}\StringTok{ }\KeywordTok{as.data.frame}\NormalTok{(tabla_localizacion }\OperatorTok{%>%}\StringTok{ }\KeywordTok{mutate}\NormalTok{(}\DataTypeTok{ws=}\NormalTok{ws}\OperatorTok{*}\KeywordTok{log}\NormalTok{(}\DecValTok{50}\OperatorTok{/}\DecValTok{1}\NormalTok{) }\OperatorTok{/}\StringTok{ }\KeywordTok{log}\NormalTok{(}\DecValTok{10}\OperatorTok{/}\DecValTok{1}\NormalTok{))) }
\NormalTok{tabla_localizacion_altura<-tabla_localizacion_altura }\OperatorTok{%>%}\StringTok{ }\KeywordTok{mutate}\NormalTok{(}\DataTypeTok{grup_vel=}\KeywordTok{cut}\NormalTok{(tabla_localizacion_altura}\OperatorTok{$}\NormalTok{ws,}
                       \KeywordTok{seq}\NormalTok{(}\DecValTok{0}\NormalTok{,}\KeywordTok{max}\NormalTok{(tabla_localizacion_altura}\OperatorTok{$}\NormalTok{ws),}\DataTypeTok{by=}\FloatTok{0.5}\NormalTok{),}
                       \DataTypeTok{labels =} \KeywordTok{seq}\NormalTok{(}\FloatTok{0.5}\NormalTok{,}\KeywordTok{max}\NormalTok{(tabla_localizacion_altura}\OperatorTok{$}\NormalTok{ws),}\DataTypeTok{by=}\FloatTok{0.5}\NormalTok{), }
                       \DataTypeTok{include.lowest =}\NormalTok{ T,}\DataTypeTok{right =}\NormalTok{ T))}



\NormalTok{### representamos windrose a la altura del edifcio}
\NormalTok{path_here<-}\KeywordTok{paste0}\NormalTok{(}\KeywordTok{here}\NormalTok{(),}\StringTok{"/graficas_rosas/"}\NormalTok{)}
\NormalTok{breaks_rose<-}\KeywordTok{length}\NormalTok{(}\KeywordTok{seq}\NormalTok{(}\DecValTok{0}\NormalTok{,}\KeywordTok{max}\NormalTok{(tabla_localizacion_altura}\OperatorTok{$}\NormalTok{ws),}\DataTypeTok{by=}\DecValTok{2}\NormalTok{))}


\KeywordTok{tiff}\NormalTok{(}\KeywordTok{paste0}\NormalTok{(path_here,}\StringTok{"rosa_elegida_he.tiff"}\NormalTok{), }\DataTypeTok{width =} \DecValTok{7}\NormalTok{, }\DataTypeTok{height =}\DecValTok{7}\NormalTok{, }\DataTypeTok{units =} \StringTok{'in'}\NormalTok{, }\DataTypeTok{res =} \DecValTok{300}\NormalTok{)}


\KeywordTok{windRose}\NormalTok{(tabla_localizacion_altura, }\DataTypeTok{angle =} \FloatTok{22.5}\NormalTok{,}
         \DataTypeTok{breaks =}\NormalTok{ breaks_rose,}\DataTypeTok{paddle =}\NormalTok{ F, }\DataTypeTok{annotate =}\NormalTok{ F,}
         \DataTypeTok{key.position =} \StringTok{"right"}\NormalTok{)}
\KeywordTok{dev.off}\NormalTok{()  }



\NormalTok{## REalizamos barplot comparativo}
\NormalTok{distribuciones_velocidad<-}\StringTok{ }\KeywordTok{table}\NormalTok{(tabla_localizacion_altura}\OperatorTok{$}\NormalTok{grup_vel)}
\NormalTok{dist_total<-}\KeywordTok{sum}\NormalTok{(distribuciones_velocidad)}
\NormalTok{distribuciones_velocidad_porcentaje<-}\StringTok{ }\NormalTok{distribuciones_velocidad}\OperatorTok{/}\NormalTok{dist_total}
\NormalTok{distribuciones_velocidad_anual<-}\StringTok{ }\NormalTok{distribuciones_velocidad_porcentaje}\OperatorTok{*}\DecValTok{8600}



\NormalTok{distribuciones_velocidad10<-}\StringTok{ }\KeywordTok{table}\NormalTok{(tabla_localizacion}\OperatorTok{$}\NormalTok{grup_vel)}
\NormalTok{dist_total10<-}\KeywordTok{sum}\NormalTok{(distribuciones_velocidad10)}
\NormalTok{distribuciones_velocidad_porcentaje10<-}\StringTok{ }\NormalTok{distribuciones_velocidad10}\OperatorTok{/}\NormalTok{dist_total10}
\NormalTok{distribuciones_velocidad_anual10<-}\StringTok{ }\NormalTok{distribuciones_velocidad_porcentaje10}\OperatorTok{*}\DecValTok{8600}


\NormalTok{add.col<-}\ControlFlowTok{function}\NormalTok{(df, new.col) \{n.row<-}\KeywordTok{dim}\NormalTok{(df)[}\DecValTok{1}\NormalTok{]}
\KeywordTok{length}\NormalTok{(new.col)<-n.row}
\KeywordTok{cbind}\NormalTok{(df, new.col)}
\NormalTok{\}}

\NormalTok{frame_barplot<-}\StringTok{ }\KeywordTok{as.data.frame}\NormalTok{(}\KeywordTok{add.col}\NormalTok{(distribuciones_velocidad_anual,distribuciones_velocidad_anual10))}
\NormalTok{frame_barplot<-}\StringTok{ }\KeywordTok{as.data.frame}\NormalTok{(}\KeywordTok{cbind}\NormalTok{(frame_barplot}\OperatorTok{$}\NormalTok{df,}\KeywordTok{ifelse}\NormalTok{(}\KeywordTok{is.na}\NormalTok{(frame_barplot}\OperatorTok{$}\NormalTok{new.col), }\DecValTok{0}\NormalTok{,frame_barplot}\OperatorTok{$}\NormalTok{new.col)))}
\KeywordTok{names}\NormalTok{(frame_barplot)<-}\StringTok{ }\KeywordTok{c}\NormalTok{(}\StringTok{"Dist_50"}\NormalTok{,}\StringTok{"Dist_10"}\NormalTok{)}
\KeywordTok{row.names}\NormalTok{(frame_barplot)<-}\StringTok{ }\KeywordTok{names}\NormalTok{(distribuciones_velocidad_anual)}


\KeywordTok{ggplot}\NormalTok{(frame_barplot)}\OperatorTok{+}
\StringTok{  }\KeywordTok{geom_bar}\NormalTok{(}\KeywordTok{aes}\NormalTok{(}\DataTypeTok{x=}\KeywordTok{as.numeric}\NormalTok{(}\KeywordTok{row.names}\NormalTok{(frame_barplot)),}\DataTypeTok{y=}\NormalTok{Dist_}\DecValTok{50}\NormalTok{),}\DataTypeTok{stat =} \StringTok{"identity"}\NormalTok{,}\DataTypeTok{alpha=}\NormalTok{.}\DecValTok{95}\NormalTok{,}\DataTypeTok{fill=}\StringTok{'lightblue'}\NormalTok{,}\DataTypeTok{color=}\StringTok{'lightblue4'}\NormalTok{, }\DataTypeTok{show.legend =}\NormalTok{ T)}\OperatorTok{+}
\StringTok{  }\KeywordTok{geom_bar}\NormalTok{(}\KeywordTok{aes}\NormalTok{(}\DataTypeTok{x=}\KeywordTok{as.numeric}\NormalTok{(}\KeywordTok{row.names}\NormalTok{(frame_barplot)),}\DataTypeTok{y=}\NormalTok{Dist_}\DecValTok{10}\NormalTok{),}\DataTypeTok{stat =} \StringTok{"identity"}\NormalTok{, }\DataTypeTok{alpha=}\NormalTok{.}\DecValTok{3}\NormalTok{,}\DataTypeTok{fill=}\StringTok{'pink'}\NormalTok{,}\DataTypeTok{color=}\StringTok{'red'}\NormalTok{,}\DataTypeTok{show.legend =}\NormalTok{ T)}\OperatorTok{+}
\KeywordTok{xlab}\NormalTok{(}\StringTok{"Velocidad del viento"}\NormalTok{)}\OperatorTok{+}
\KeywordTok{ylab}\NormalTok{(}\StringTok{"Horas anuales"}\NormalTok{) }\OperatorTok{+}
\StringTok{ }\KeywordTok{geom_point}\NormalTok{(}\DataTypeTok{x=}\DecValTok{18}\NormalTok{, }\DataTypeTok{y =}\DecValTok{500}\NormalTok{, }\DataTypeTok{shape=}\DecValTok{22}\NormalTok{, }\DataTypeTok{size=}\DecValTok{5}\NormalTok{, }\DataTypeTok{alpha=}\NormalTok{.}\DecValTok{95}\NormalTok{,}\DataTypeTok{fill=}\StringTok{'lightblue'}\NormalTok{,}\DataTypeTok{color=}\StringTok{'lightblue4'}\NormalTok{)}\OperatorTok{+}
\KeywordTok{geom_point}\NormalTok{(}\DataTypeTok{x=}\DecValTok{18}\NormalTok{, }\DataTypeTok{y =}\DecValTok{400}\NormalTok{, }\DataTypeTok{shape=}\DecValTok{22}\NormalTok{, }\DataTypeTok{size=}\DecValTok{5}\NormalTok{, }\DataTypeTok{alpha=}\NormalTok{.}\DecValTok{3}\NormalTok{,}\DataTypeTok{fill=}\StringTok{'pink'}\NormalTok{,}\DataTypeTok{color=}\StringTok{'red'}\NormalTok{)}\OperatorTok{+}
\KeywordTok{annotate}\NormalTok{(}\StringTok{"text"}\NormalTok{,}\DataTypeTok{label=}\StringTok{"Distribución de la velocidad del viento a 50 metros"}\NormalTok{, }\DataTypeTok{x =} \DecValTok{30}\NormalTok{, }\DataTypeTok{y =} \DecValTok{500}\NormalTok{)}\OperatorTok{+}
\StringTok{  }\KeywordTok{annotate}\NormalTok{(}\StringTok{"text"}\NormalTok{,}\DataTypeTok{label=}\StringTok{"Distribución de la velocidad del viento a 10 metros"}\NormalTok{, }\DataTypeTok{x =} \DecValTok{30}\NormalTok{, }\DataTypeTok{y =} \DecValTok{400}\NormalTok{)}\OperatorTok{+}
\StringTok{  }\KeywordTok{theme_bw}\NormalTok{()}

\NormalTok{path_here<-}\KeywordTok{paste0}\NormalTok{(}\KeywordTok{here}\NormalTok{(),}\StringTok{"/barplot/"}\NormalTok{)   }
\KeywordTok{dir.create}\NormalTok{(path_here)}

\KeywordTok{ggplot}\NormalTok{(frame_barplot)}\OperatorTok{+}
\StringTok{  }\KeywordTok{geom_bar}\NormalTok{(}\KeywordTok{aes}\NormalTok{(}\DataTypeTok{x=}\KeywordTok{as.numeric}\NormalTok{(}\KeywordTok{row.names}\NormalTok{(frame_barplot)),}\DataTypeTok{y=}\NormalTok{Dist_}\DecValTok{50}\NormalTok{),}\DataTypeTok{stat =} \StringTok{"identity"}\NormalTok{,}\DataTypeTok{alpha=}\NormalTok{.}\DecValTok{95}\NormalTok{,}\DataTypeTok{fill=}\StringTok{'lightblue'}\NormalTok{,}\DataTypeTok{color=}\StringTok{'lightblue4'}\NormalTok{, }\DataTypeTok{show.legend =}\NormalTok{ T)}\OperatorTok{+}
\StringTok{  }\KeywordTok{geom_bar}\NormalTok{(}\KeywordTok{aes}\NormalTok{(}\DataTypeTok{x=}\KeywordTok{as.numeric}\NormalTok{(}\KeywordTok{row.names}\NormalTok{(frame_barplot)),}\DataTypeTok{y=}\NormalTok{Dist_}\DecValTok{10}\NormalTok{),}\DataTypeTok{stat =} \StringTok{"identity"}\NormalTok{, }\DataTypeTok{alpha=}\NormalTok{.}\DecValTok{3}\NormalTok{,}\DataTypeTok{fill=}\StringTok{'pink'}\NormalTok{,}\DataTypeTok{color=}\StringTok{'red'}\NormalTok{,}\DataTypeTok{show.legend =}\NormalTok{ T)}\OperatorTok{+}
\StringTok{  }\KeywordTok{xlab}\NormalTok{(}\StringTok{"Velocidad del viento (m/s)"}\NormalTok{)}\OperatorTok{+}
\StringTok{  }\KeywordTok{ylab}\NormalTok{(}\StringTok{"Horas anuales"}\NormalTok{) }\OperatorTok{+}
\StringTok{  }\KeywordTok{geom_point}\NormalTok{(}\DataTypeTok{x=}\DecValTok{18}\NormalTok{, }\DataTypeTok{y =}\DecValTok{500}\NormalTok{, }\DataTypeTok{shape=}\DecValTok{22}\NormalTok{, }\DataTypeTok{size=}\DecValTok{5}\NormalTok{, }\DataTypeTok{alpha=}\NormalTok{.}\DecValTok{95}\NormalTok{,}\DataTypeTok{fill=}\StringTok{'lightblue'}\NormalTok{,}\DataTypeTok{color=}\StringTok{'lightblue4'}\NormalTok{)}\OperatorTok{+}
\StringTok{  }\KeywordTok{geom_point}\NormalTok{(}\DataTypeTok{x=}\DecValTok{18}\NormalTok{, }\DataTypeTok{y =}\DecValTok{400}\NormalTok{, }\DataTypeTok{shape=}\DecValTok{22}\NormalTok{, }\DataTypeTok{size=}\DecValTok{5}\NormalTok{, }\DataTypeTok{alpha=}\NormalTok{.}\DecValTok{3}\NormalTok{,}\DataTypeTok{fill=}\StringTok{'pink'}\NormalTok{,}\DataTypeTok{color=}\StringTok{'red'}\NormalTok{)}\OperatorTok{+}
\StringTok{  }\KeywordTok{annotate}\NormalTok{(}\StringTok{"text"}\NormalTok{,}\DataTypeTok{label=}\StringTok{"Distribución de la velocidad del viento a 50 metros"}\NormalTok{, }\DataTypeTok{x =} \DecValTok{30}\NormalTok{, }\DataTypeTok{y =} \DecValTok{500}\NormalTok{)}\OperatorTok{+}
\StringTok{  }\KeywordTok{annotate}\NormalTok{(}\StringTok{"text"}\NormalTok{,}\DataTypeTok{label=}\StringTok{"Distribución de la velocidad del viento a 10 metros"}\NormalTok{, }\DataTypeTok{x =} \DecValTok{30}\NormalTok{, }\DataTypeTok{y =} \DecValTok{400}\NormalTok{)}\OperatorTok{+}
\StringTok{  }\KeywordTok{theme_bw}\NormalTok{()}

\KeywordTok{ggsave}\NormalTok{(}\KeywordTok{paste0}\NormalTok{(path_here,}\StringTok{"barplotcomparativo.tiff"}\NormalTok{), }\DataTypeTok{device =} \StringTok{"tiff"}\NormalTok{, }\DataTypeTok{dpi=}\DecValTok{1200}\NormalTok{,}\DataTypeTok{width =}\DecValTok{8}\NormalTok{, }\DataTypeTok{height =}\DecValTok{7}\NormalTok{, }\DataTypeTok{units =} \StringTok{'in'}\NormalTok{)}


 


\NormalTok{tabla_localizacion_NO<-tabla_localizacion_altura[tabla_localizacion_altura}\OperatorTok{$}\NormalTok{wd }\OperatorTok{<}\StringTok{ }\DecValTok{350} \OperatorTok{&}\StringTok{ }\NormalTok{tabla_localizacion_altura}\OperatorTok{$}\NormalTok{wd }\OperatorTok{>}\StringTok{ }\DecValTok{314}\NormalTok{,]}
\NormalTok{distribuciones_velocidad_NO<-}\StringTok{ }\KeywordTok{table}\NormalTok{(tabla_localizacion_NO}\OperatorTok{$}\NormalTok{grup_vel)}
\NormalTok{dist_total_NO<-}\KeywordTok{sum}\NormalTok{(distribuciones_velocidad_NO)}
\NormalTok{distribuciones_velocidad_porcentaje_NO<-}\StringTok{ }\NormalTok{distribuciones_velocidad_NO}\OperatorTok{/}\NormalTok{dist_total}
\NormalTok{distribuciones_velocidad_anual_NO<-}\StringTok{ }\NormalTok{distribuciones_velocidad_porcentaje_NO}\OperatorTok{*}\DecValTok{8600}
\NormalTok{tabla_NO<-}\KeywordTok{as.data.frame}\NormalTok{( }\KeywordTok{cbind}\NormalTok{(distribuciones_velocidad_anual_NO))}
\KeywordTok{names}\NormalTok{(tabla_NO)<-}\StringTok{ "distribucion"}

\KeywordTok{ggplot}\NormalTok{(tabla_NO)}\OperatorTok{+}
\StringTok{  }\KeywordTok{geom_bar}\NormalTok{(}\KeywordTok{aes}\NormalTok{(}\DataTypeTok{x=}\KeywordTok{as.numeric}\NormalTok{(}\KeywordTok{row.names}\NormalTok{(tabla_NO)),}\DataTypeTok{y=}\NormalTok{distribucion),}
           \DataTypeTok{stat =} \StringTok{"identity"}\NormalTok{,}\DataTypeTok{alpha=}\NormalTok{.}\DecValTok{95}\NormalTok{,}\DataTypeTok{fill=}\StringTok{'lightblue'}\NormalTok{,}\DataTypeTok{color=}\StringTok{'lightblue4'}\NormalTok{)}\OperatorTok{+}
\StringTok{  }\KeywordTok{xlab}\NormalTok{(}\StringTok{"Velocidad del viento (m/s)"}\NormalTok{)}\OperatorTok{+}
\StringTok{  }\KeywordTok{ylab}\NormalTok{(}\StringTok{"Horas anuales"}\NormalTok{) }\OperatorTok{+}
\StringTok{  }\KeywordTok{ggtitle}\NormalTok{(}\StringTok{"Distribución de la velocidad del viento  }\CharTok{\textbackslash{}n}\StringTok{ dirección Noroeste"}\NormalTok{)}\OperatorTok{+}
\StringTok{  }\KeywordTok{theme_bw}\NormalTok{()}\OperatorTok{+}
\StringTok{  }\KeywordTok{theme}\NormalTok{(}\DataTypeTok{plot.title =} \KeywordTok{element_text}\NormalTok{(}\DataTypeTok{hjust =} \FloatTok{0.5}\NormalTok{))}
 
\KeywordTok{ggsave}\NormalTok{(}\KeywordTok{paste0}\NormalTok{(path_here,}\StringTok{"barplotNO.tiff"}\NormalTok{), }\DataTypeTok{device =} \StringTok{"tiff"}\NormalTok{, }\DataTypeTok{dpi=}\DecValTok{1200}\NormalTok{,}\DataTypeTok{width =}\DecValTok{8}\NormalTok{, }\DataTypeTok{height =}\DecValTok{7}\NormalTok{, }\DataTypeTok{units =} \StringTok{'in'}\NormalTok{)}
       







\NormalTok{###Creamos un barplot comparativo entre todas las direcciones y la direccion noroeste}

\NormalTok{frame_barplot_NO<-}\StringTok{ }\KeywordTok{as.data.frame}\NormalTok{(}\KeywordTok{add.col}\NormalTok{(distribuciones_velocidad_anual,distribuciones_velocidad_anual_NO))}
\NormalTok{frame_barplot_NO<-}\StringTok{ }\KeywordTok{as.data.frame}\NormalTok{(}\KeywordTok{cbind}\NormalTok{(frame_barplot_NO}\OperatorTok{$}\NormalTok{df,}\KeywordTok{ifelse}\NormalTok{(}\KeywordTok{is.na}\NormalTok{(frame_barplot_NO}\OperatorTok{$}\NormalTok{new.col), }\DecValTok{0}\NormalTok{,frame_barplot_NO}\OperatorTok{$}\NormalTok{new.col)))}
\KeywordTok{names}\NormalTok{(frame_barplot_NO)<-}\StringTok{ }\KeywordTok{c}\NormalTok{(}\StringTok{"Dist_total"}\NormalTok{,}\StringTok{"Dist_NO"}\NormalTok{)}
\KeywordTok{row.names}\NormalTok{(frame_barplot_NO)<-}\StringTok{ }\KeywordTok{names}\NormalTok{(distribuciones_velocidad_anual)}







\KeywordTok{ggplot}\NormalTok{(frame_barplot_NO)}\OperatorTok{+}
\StringTok{  }\KeywordTok{geom_bar}\NormalTok{(}\KeywordTok{aes}\NormalTok{(}\DataTypeTok{x=}\KeywordTok{as.numeric}\NormalTok{(}\KeywordTok{row.names}\NormalTok{(frame_barplot_NO)),}\DataTypeTok{y=}\NormalTok{Dist_total),}\DataTypeTok{stat =} \StringTok{"identity"}\NormalTok{,}\DataTypeTok{alpha=}\NormalTok{.}\DecValTok{95}\NormalTok{,}\DataTypeTok{fill=}\StringTok{'lightblue'}\NormalTok{,}\DataTypeTok{color=}\StringTok{'lightblue4'}\NormalTok{, }\DataTypeTok{show.legend =}\NormalTok{ T)}\OperatorTok{+}
\StringTok{  }\KeywordTok{geom_bar}\NormalTok{(}\KeywordTok{aes}\NormalTok{(}\DataTypeTok{x=}\KeywordTok{as.numeric}\NormalTok{(}\KeywordTok{row.names}\NormalTok{(frame_barplot_NO)),}\DataTypeTok{y=}\NormalTok{Dist_NO),}\DataTypeTok{stat =} \StringTok{"identity"}\NormalTok{, }\DataTypeTok{alpha=}\NormalTok{.}\DecValTok{4}\NormalTok{,}\DataTypeTok{fill=}\StringTok{'pink'}\NormalTok{,}\DataTypeTok{color=}\StringTok{'red'}\NormalTok{,}\DataTypeTok{show.legend =}\NormalTok{ T)}\OperatorTok{+}
\StringTok{  }\KeywordTok{xlab}\NormalTok{(}\StringTok{"Velocidad del viento (m/s)"}\NormalTok{)}\OperatorTok{+}
\StringTok{  }\KeywordTok{ylab}\NormalTok{(}\StringTok{"Horas anuales"}\NormalTok{) }\OperatorTok{+}
\StringTok{  }\KeywordTok{geom_point}\NormalTok{(}\DataTypeTok{x=}\DecValTok{22}\NormalTok{, }\DataTypeTok{y =}\DecValTok{300}\NormalTok{, }\DataTypeTok{shape=}\DecValTok{22}\NormalTok{, }\DataTypeTok{size=}\DecValTok{5}\NormalTok{, }\DataTypeTok{alpha=}\NormalTok{.}\DecValTok{95}\NormalTok{,}\DataTypeTok{fill=}\StringTok{'lightblue'}\NormalTok{,}\DataTypeTok{color=}\StringTok{'lightblue4'}\NormalTok{)}\OperatorTok{+}
\StringTok{  }\KeywordTok{geom_point}\NormalTok{(}\DataTypeTok{x=}\DecValTok{22}\NormalTok{, }\DataTypeTok{y =}\DecValTok{200}\NormalTok{, }\DataTypeTok{shape=}\DecValTok{22}\NormalTok{, }\DataTypeTok{size=}\DecValTok{5}\NormalTok{, }\DataTypeTok{alpha=}\NormalTok{.}\DecValTok{3}\NormalTok{,}\DataTypeTok{fill=}\StringTok{'pink'}\NormalTok{,}\DataTypeTok{color=}\StringTok{'red'}\NormalTok{)}\OperatorTok{+}
\StringTok{  }\KeywordTok{annotate}\NormalTok{(}\StringTok{"text"}\NormalTok{,}\DataTypeTok{label=}\StringTok{"Distribución de la velocidad del }\CharTok{\textbackslash{}n}\StringTok{ viento en todas las direcciones"}\NormalTok{, }\DataTypeTok{x =} \DecValTok{30}\NormalTok{, }\DataTypeTok{y =} \DecValTok{300}\NormalTok{)}\OperatorTok{+}
\StringTok{  }\KeywordTok{annotate}\NormalTok{(}\StringTok{"text"}\NormalTok{,}\DataTypeTok{label=}\StringTok{"Distribución de la velocidad del }\CharTok{\textbackslash{}n}\StringTok{ viento en la dirección Noroeste"}\NormalTok{, }\DataTypeTok{x =} \DecValTok{30}\NormalTok{, }\DataTypeTok{y =} \DecValTok{200}\NormalTok{)}\OperatorTok{+}
\StringTok{  }\KeywordTok{ggtitle}\NormalTok{(}\StringTok{"Comparativa de las distribuciones del viento }\CharTok{\textbackslash{}n}\StringTok{ en todas las direcciones y en la dirección aprovechable"}\NormalTok{)}\OperatorTok{+}
\StringTok{  }\KeywordTok{theme_bw}\NormalTok{()}\OperatorTok{+}
\StringTok{  }\KeywordTok{theme}\NormalTok{(}\DataTypeTok{plot.title =} \KeywordTok{element_text}\NormalTok{(}\DataTypeTok{hjust =} \FloatTok{0.5}\NormalTok{))}


\KeywordTok{ggsave}\NormalTok{(}\KeywordTok{paste0}\NormalTok{(path_here,}\StringTok{"barplotNO_comparativa.tiff"}\NormalTok{), }\DataTypeTok{device =} \StringTok{"tiff"}\NormalTok{, }\DataTypeTok{dpi=}\DecValTok{1200}\NormalTok{,}\DataTypeTok{width =}\DecValTok{8}\NormalTok{, }\DataTypeTok{height =}\DecValTok{7}\NormalTok{, }\DataTypeTok{units =} \StringTok{'in'}\NormalTok{)}






\NormalTok{#### ya nos ponemos al calculo de la energia anual producida. Empleando los coeficien}
\NormalTok{## la formula de ajuste es y ~ b + a*x^3 }
\NormalTok{V_viento<-}\KeywordTok{seq}\NormalTok{(}\DecValTok{0}\NormalTok{,}\KeywordTok{max}\NormalTok{(tabla_localizacion_altura}\OperatorTok{$}\NormalTok{ws),}\DataTypeTok{by=}\FloatTok{0.5}\NormalTok{)}
\NormalTok{select_groups <-}\StringTok{ }\ControlFlowTok{function}\NormalTok{(data, groups) \{}
\NormalTok{  data[}\KeywordTok{sort}\NormalTok{(}\KeywordTok{unlist}\NormalTok{(}\KeywordTok{attr}\NormalTok{(data, }\StringTok{"indices"}\NormalTok{)[ groups ])) }\OperatorTok{+}\StringTok{ }\DecValTok{1}\NormalTok{, ]}
\NormalTok{\}}
\NormalTok{group_number<-}\KeywordTok{length}\NormalTok{(}\KeywordTok{attr}\NormalTok{(}\KeywordTok{group_by}\NormalTok{(df,experimento,angulo), }\StringTok{"group"}\NormalTok{))}

\NormalTok{coeficientes_Curva_P_V_medida<-}\StringTok{ }\KeywordTok{grafica_Potencia_V}\NormalTok{(df,limitex,limitey,}\DecValTok{1}\NormalTok{)}
\NormalTok{coeficientes_Curva_P_V_estandar<-}\StringTok{ }\KeywordTok{grafica_Potencia_V}\NormalTok{(df,limitex,limitey,}\DecValTok{2}\NormalTok{)}
\NormalTok{coeficientes_Curva_P_V_alfa<-}\StringTok{ }\KeywordTok{grafica_Potencia_V_alfa}\NormalTok{(df,limitex,limitey)}

\NormalTok{lista_energias<-}\StringTok{ }\KeywordTok{list}\NormalTok{()}


\ControlFlowTok{for}\NormalTok{ (i }\ControlFlowTok{in} \DecValTok{1}\OperatorTok{:}\NormalTok{group_number) \{}
\NormalTok{  coefs_medido<-}\StringTok{ }\NormalTok{coeficientes_Curva_P_V_alfa }\OperatorTok{%>%}\StringTok{ }\KeywordTok{group_by}\NormalTok{(., Experimento,Angulo) }\OperatorTok{%>%}\StringTok{ }\KeywordTok{select_groups}\NormalTok{(i)}
\NormalTok{  coefs_estandar<-}\StringTok{  }\NormalTok{coeficientes_Curva_P_V_estandar }\OperatorTok{%>%}\StringTok{ }\KeywordTok{group_by}\NormalTok{(., Experimento,Angulo) }\OperatorTok{%>%}\StringTok{ }\KeywordTok{select_groups}\NormalTok{(i)}
  
\NormalTok{  Curva_de_potencia_medida<-}\StringTok{ }\NormalTok{coefs_medido}\OperatorTok{$}\NormalTok{b}\OperatorTok{+}\NormalTok{coefs_medido}\OperatorTok{$}\NormalTok{a}\OperatorTok{*}\NormalTok{V_viento}\OperatorTok{^}\DecValTok{3}
\NormalTok{  Curva_de_potencia_medida<-}\KeywordTok{replace}\NormalTok{(Curva_de_potencia_medida,}\KeywordTok{which}\NormalTok{(Curva_de_potencia_medida}\OperatorTok{<}\DecValTok{0}\NormalTok{),}\DecValTok{0}\NormalTok{)}
\NormalTok{  Curva_de_potencia_medida<-}\StringTok{ }\NormalTok{Curva_de_potencia_medida[}\DecValTok{2}\OperatorTok{:}\DecValTok{80}\NormalTok{]}
  
\NormalTok{  Curva_de_potencia_estandar<-}\StringTok{ }\NormalTok{coefs_estandar}\OperatorTok{$}\NormalTok{b}\OperatorTok{+}\NormalTok{coefs_estandar}\OperatorTok{$}\NormalTok{a}\OperatorTok{*}\NormalTok{V_viento}\OperatorTok{^}\DecValTok{3}
\NormalTok{  Curva_de_potencia_estandar<-}\KeywordTok{replace}\NormalTok{(Curva_de_potencia_estandar,}\KeywordTok{which}\NormalTok{(Curva_de_potencia_estandar}\OperatorTok{<}\DecValTok{0}\NormalTok{),}\DecValTok{0}\NormalTok{)}
\NormalTok{  Curva_de_potencia_estandar<-}\StringTok{ }\NormalTok{Curva_de_potencia_estandar[}\DecValTok{2}\OperatorTok{:}\DecValTok{80}\NormalTok{]}
  
  
\NormalTok{  tabla_dist_pot<-}\StringTok{ }\KeywordTok{as.data.frame}\NormalTok{(}\KeywordTok{cbind}\NormalTok{(tabla_NO, Curva_de_potencia_estandar,Curva_de_potencia_medida))}
  \KeywordTok{names}\NormalTok{(tabla_dist_pot)<-}\StringTok{ }\KeywordTok{c}\NormalTok{(}\StringTok{"horas"}\NormalTok{, }\StringTok{"est"}\NormalTok{,}\StringTok{"med"}\NormalTok{)}
\NormalTok{  energias<-}\StringTok{ }\NormalTok{tabla_dist_pot }\OperatorTok{%>%}\StringTok{ }\KeywordTok{mutate}\NormalTok{(}\DataTypeTok{energia_est=}\NormalTok{ est}\OperatorTok{*}\NormalTok{horas, }\DataTypeTok{energia_med=}\NormalTok{med}\OperatorTok{*}\NormalTok{horas)}
  
\NormalTok{  lista_energias[[i]]<-}\StringTok{ }\NormalTok{energias}
  
\NormalTok{  \}}

\KeywordTok{names}\NormalTok{(lista_energias)<-}\StringTok{ }\KeywordTok{paste0}\NormalTok{(coeficientes_Curva_P_V_medida[,}\DecValTok{1}\NormalTok{],coeficientes_Curva_P_V_medida[,}\DecValTok{2}\NormalTok{])}




\CommentTok{#barplot_energias_estandar<-function()\{}
\NormalTok{  tabla_energia_est<-}\KeywordTok{as.data.frame}\NormalTok{(}\KeywordTok{matrix}\NormalTok{(}\KeywordTok{unlist}\NormalTok{(}\KeywordTok{lapply}\NormalTok{(lista_energias,}\StringTok{"["}\NormalTok{,,}\DecValTok{4}\NormalTok{), }\DataTypeTok{use.names =}\NormalTok{ F), }\DataTypeTok{byrow =}\NormalTok{ F,}\DataTypeTok{ncol =} \DecValTok{5}\NormalTok{))}
  \KeywordTok{names}\NormalTok{(tabla_energia_est)<-}\StringTok{ }\KeywordTok{names}\NormalTok{(lista_energias)}
  \KeywordTok{row.names}\NormalTok{(tabla_energia_est)<-}\StringTok{ }\KeywordTok{names}\NormalTok{(distribuciones_velocidad_anual)}
  
\NormalTok{  path_here<-}\KeywordTok{paste0}\NormalTok{(}\KeywordTok{here}\NormalTok{(),}\StringTok{"/barplot/"}\NormalTok{)}
  
  
  
  
  \KeywordTok{ggplot}\NormalTok{(tabla_energia_est)}\OperatorTok{+}
\StringTok{    }\KeywordTok{geom_bar}\NormalTok{(}\KeywordTok{aes}\NormalTok{(}\DataTypeTok{x=}\KeywordTok{as.numeric}\NormalTok{(}\KeywordTok{row.names}\NormalTok{(tabla_energia_est)),}\DataTypeTok{y=}\NormalTok{concentrador30),}\DataTypeTok{stat =} \StringTok{"identity"}\NormalTok{,}\DataTypeTok{alpha=}\NormalTok{.}\DecValTok{9}\NormalTok{,}\DataTypeTok{fill=}\StringTok{'lightblue'}\NormalTok{,}\DataTypeTok{color=}\StringTok{'lightblue4'}\NormalTok{, }\DataTypeTok{show.legend =}\NormalTok{ T)}\OperatorTok{+}
\StringTok{    }\KeywordTok{geom_bar}\NormalTok{(}\KeywordTok{aes}\NormalTok{(}\DataTypeTok{x=}\KeywordTok{as.numeric}\NormalTok{(}\KeywordTok{row.names}\NormalTok{(tabla_energia_est)),}\DataTypeTok{y=}\NormalTok{concentrador45),}\DataTypeTok{stat =} \StringTok{"identity"}\NormalTok{, }\DataTypeTok{alpha=}\NormalTok{.}\DecValTok{8}\NormalTok{,}\DataTypeTok{fill=}\StringTok{'pink'}\NormalTok{,}\DataTypeTok{color=}\StringTok{'red'}\NormalTok{,}\DataTypeTok{show.legend =}\NormalTok{ T)}\OperatorTok{+}
\StringTok{    }\KeywordTok{geom_bar}\NormalTok{(}\KeywordTok{aes}\NormalTok{(}\DataTypeTok{x=}\KeywordTok{as.numeric}\NormalTok{(}\KeywordTok{row.names}\NormalTok{(tabla_energia_est)),}\DataTypeTok{y=}\NormalTok{concentrador70),}\DataTypeTok{stat =} \StringTok{"identity"}\NormalTok{,}\DataTypeTok{alpha=}\NormalTok{.}\DecValTok{7}\NormalTok{,}\DataTypeTok{fill=}\StringTok{'green2'}\NormalTok{,}\DataTypeTok{color=}\StringTok{'green4'}\NormalTok{, }\DataTypeTok{show.legend =}\NormalTok{ T)}\OperatorTok{+}
\StringTok{    }\KeywordTok{geom_bar}\NormalTok{(}\KeywordTok{aes}\NormalTok{(}\DataTypeTok{x=}\KeywordTok{as.numeric}\NormalTok{(}\KeywordTok{row.names}\NormalTok{(tabla_energia_est)),}\DataTypeTok{y=}\NormalTok{paredNA),}\DataTypeTok{stat =} \StringTok{"identity"}\NormalTok{, }\DataTypeTok{alpha=}\NormalTok{.}\DecValTok{6}\NormalTok{,}\DataTypeTok{fill=}\StringTok{'mediumorchid1'}\NormalTok{,}\DataTypeTok{color=}\StringTok{'mediumorchid4'}\NormalTok{,}\DataTypeTok{show.legend =}\NormalTok{ T)}\OperatorTok{+}
\StringTok{    }\KeywordTok{geom_bar}\NormalTok{(}\KeywordTok{aes}\NormalTok{(}\DataTypeTok{x=}\KeywordTok{as.numeric}\NormalTok{(}\KeywordTok{row.names}\NormalTok{(tabla_energia_est)),}\DataTypeTok{y=}\NormalTok{pilotoNA),}\DataTypeTok{stat =} \StringTok{"identity"}\NormalTok{,}\DataTypeTok{alpha=}\NormalTok{.}\DecValTok{5}\NormalTok{,}\DataTypeTok{fill=}\StringTok{'orange'}\NormalTok{,}\DataTypeTok{color=}\StringTok{'orange4'}\NormalTok{, }\DataTypeTok{show.legend =}\NormalTok{ T)}\OperatorTok{+}
\StringTok{    }\KeywordTok{xlab}\NormalTok{(}\StringTok{"Velocidad del viento (m/s)"}\NormalTok{)}\OperatorTok{+}
\StringTok{    }\KeywordTok{ylab}\NormalTok{(}\StringTok{"Energía (W/h)"}\NormalTok{) }\OperatorTok{+}
\StringTok{    }\KeywordTok{geom_point}\NormalTok{(}\DataTypeTok{x=}\DecValTok{25}\NormalTok{, }\DataTypeTok{y =}\DecValTok{200}\NormalTok{, }\DataTypeTok{shape=}\DecValTok{22}\NormalTok{, }\DataTypeTok{size=}\DecValTok{5}\NormalTok{, }\DataTypeTok{alpha=}\NormalTok{.}\DecValTok{5}\NormalTok{,}\DataTypeTok{fill=}\StringTok{'lightblue'}\NormalTok{,}\DataTypeTok{color=}\StringTok{'lightblue4'}\NormalTok{)}\OperatorTok{+}
\StringTok{    }\KeywordTok{geom_point}\NormalTok{(}\DataTypeTok{x=}\DecValTok{25}\NormalTok{, }\DataTypeTok{y =}\DecValTok{180}\NormalTok{, }\DataTypeTok{shape=}\DecValTok{22}\NormalTok{, }\DataTypeTok{size=}\DecValTok{5}\NormalTok{, }\DataTypeTok{alpha=}\NormalTok{.}\DecValTok{4}\NormalTok{,}\DataTypeTok{fill=}\StringTok{'pink'}\NormalTok{,}\DataTypeTok{color=}\StringTok{'red'}\NormalTok{)}\OperatorTok{+}
\StringTok{    }\KeywordTok{geom_point}\NormalTok{(}\DataTypeTok{x=}\DecValTok{25}\NormalTok{, }\DataTypeTok{y =}\DecValTok{160}\NormalTok{, }\DataTypeTok{shape=}\DecValTok{22}\NormalTok{, }\DataTypeTok{size=}\DecValTok{5}\NormalTok{, }\DataTypeTok{alpha=}\NormalTok{.}\DecValTok{3}\NormalTok{,}\DataTypeTok{fill=}\StringTok{'green2'}\NormalTok{,}\DataTypeTok{color=}\StringTok{'green4'}\NormalTok{)}\OperatorTok{+}
\StringTok{    }\KeywordTok{geom_point}\NormalTok{(}\DataTypeTok{x=}\DecValTok{25}\NormalTok{, }\DataTypeTok{y =}\DecValTok{140}\NormalTok{, }\DataTypeTok{shape=}\DecValTok{22}\NormalTok{, }\DataTypeTok{size=}\DecValTok{5}\NormalTok{, }\DataTypeTok{alpha=}\NormalTok{.}\DecValTok{2}\NormalTok{,}\DataTypeTok{fill=}\StringTok{'mediumorchid1'}\NormalTok{,}\DataTypeTok{color=}\StringTok{'mediumorchid4'}\NormalTok{)}\OperatorTok{+}\StringTok{ }
\StringTok{    }\KeywordTok{geom_point}\NormalTok{(}\DataTypeTok{x=}\DecValTok{25}\NormalTok{, }\DataTypeTok{y =}\DecValTok{120}\NormalTok{, }\DataTypeTok{shape=}\DecValTok{22}\NormalTok{, }\DataTypeTok{size=}\DecValTok{5}\NormalTok{,}\DataTypeTok{alpha=}\NormalTok{.}\DecValTok{1}\NormalTok{,}\DataTypeTok{fill=}\StringTok{'orange'}\NormalTok{,}\DataTypeTok{color=}\StringTok{'orange4'}\NormalTok{)}\OperatorTok{+}
\StringTok{    }\KeywordTok{annotate}\NormalTok{(}\StringTok{"text"}\NormalTok{,}\DataTypeTok{label=}\StringTok{"Concentrador 30º", x = 30, y = 200)+}
\StringTok{    annotate("}\NormalTok{text}\StringTok{",label="}\NormalTok{Concentrador }\DecValTok{45}\NormalTok{º}\StringTok{", x = 30, y = 180)+}
\StringTok{    annotate("}\NormalTok{text}\StringTok{",label="}\NormalTok{Concentrador }\DecValTok{70}\NormalTok{º}\StringTok{", x = 30, y = 160)+}
\StringTok{    annotate("}\NormalTok{text}\StringTok{",label="}\NormalTok{Pared}\StringTok{", x = 27.5, y = 140)+}
\StringTok{    annotate("}\NormalTok{text}\StringTok{",label="}\NormalTok{Piloto}\StringTok{", x = 27.5, y = 120)+}
\StringTok{    ggtitle("}\NormalTok{Comparativa de las energías anuales producidas empleando las }\DecValTok{5}\NormalTok{ configuraciones \textbackslash{}n usando las curvas de potencia generadas con la velocidad estándar}\StringTok{")+}
\StringTok{    theme_bw()+}
\StringTok{    theme(plot.title = element_text(hjust = 0.5))}
\StringTok{  }
\StringTok{  ggsave(paste0(path_here,"}\NormalTok{barplotenergíacomparativa_estandar.tiff}\StringTok{"), device = "}\NormalTok{tiff}\StringTok{", dpi=1200,width =8, height =7, units = 'in')}
\StringTok{  }
\StringTok{  return(as.data.frame(colSums(tabla_energia_est)))}
\StringTok{  }
\StringTok{  }
\StringTok{  }
\StringTok{\}}

\StringTok{barplot_energias_medida<-function()\{}
\StringTok{  tabla_energia_est<-as.data.frame(matrix(unlist(lapply(lista_energias,"}\NormalTok{[}\StringTok{",,5), use.names = F), byrow = F,ncol = 5))}
\StringTok{  names(tabla_energia_est)<- names(lista_energias)}
\StringTok{  row.names(tabla_energia_est)<- names(distribuciones_velocidad_anual)}
\StringTok{  }
\StringTok{  path_here<-paste0(here(),"}\OperatorTok{/}\NormalTok{barplot}\OperatorTok{/}\StringTok{")}
\StringTok{  }
\StringTok{  }
\StringTok{  }
\StringTok{  }
\StringTok{  ggplot(tabla_energia_est)+}
\StringTok{    geom_bar(aes(x=as.numeric(row.names(tabla_energia_est)),y=concentrador45),stat = "}\NormalTok{identity}\StringTok{", alpha=.8,fill='pink',color='red',show.legend = T)+}
\StringTok{    geom_bar(aes(x=as.numeric(row.names(tabla_energia_est)),y=concentrador30),stat = "}\NormalTok{identity}\StringTok{",alpha=.9,fill='lightblue',color='lightblue4', show.legend = T)+}
\StringTok{    geom_bar(aes(x=as.numeric(row.names(tabla_energia_est)),y=concentrador70),stat = "}\NormalTok{identity}\StringTok{",alpha=.7,fill='green2',color='green4', show.legend = T)+}
\StringTok{    geom_bar(aes(x=as.numeric(row.names(tabla_energia_est)),y=paredNA),stat = "}\NormalTok{identity}\StringTok{", alpha=.6,fill='mediumorchid1',color='mediumorchid4',show.legend = T)+}
\StringTok{    geom_bar(aes(x=as.numeric(row.names(tabla_energia_est)),y=pilotoNA),stat = "}\NormalTok{identity}\StringTok{",alpha=.5,fill='orange',color='orange4', show.legend = T)+}
\StringTok{    xlab("}\NormalTok{Velocidad del }\KeywordTok{viento}\NormalTok{ (m}\OperatorTok{/}\NormalTok{s)}\StringTok{")+}
\StringTok{    ylab("}\NormalTok{Energí}\KeywordTok{a}\NormalTok{ (W}\OperatorTok{/}\NormalTok{h)}\StringTok{") +    }
\StringTok{    geom_point(x=30, y =1000, shape=22, size=5, alpha=.1,fill='pink',color='red')+}
\StringTok{    geom_point(x=30, y =850, shape=22, size=5, alpha=.9,fill='lightblue',color='lightblue4')+}
\StringTok{    geom_point(x=30, y =700, shape=22, size=5, alpha=.3,fill='green2',color='green4')+}
\StringTok{    geom_point(x=30, y =550, shape=22, size=5, alpha=.2,fill='mediumorchid1',color='mediumorchid4')+ }
\StringTok{    geom_point(x=30, y =400, shape=22, size=5,alpha=.1,fill='orange',color='orange4')+}
\StringTok{    annotate("}\NormalTok{text}\StringTok{",label="}\NormalTok{Concentrador }\DecValTok{30}\NormalTok{º}\StringTok{", x = 35, y = 850)+}
\StringTok{    annotate("}\NormalTok{text}\StringTok{",label="}\NormalTok{Concentrador }\DecValTok{45}\NormalTok{º}\StringTok{", x = 35, y = 1000)+}
\StringTok{    annotate("}\NormalTok{text}\StringTok{",label="}\NormalTok{Concentrador }\DecValTok{70}\NormalTok{º}\StringTok{", x = 35, y = 700)+}
\StringTok{    annotate("}\NormalTok{text}\StringTok{",label="}\NormalTok{Pared}\StringTok{", x = 32.5, y = 550)+}
\StringTok{    annotate("}\NormalTok{text}\StringTok{",label="}\NormalTok{Piloto}\StringTok{", x = 32.5, y = 400)+}
\StringTok{    ggtitle("}\NormalTok{Comparativa de las energías anuales producidas empleando las }\DecValTok{5}\NormalTok{ configuraciones}\StringTok{")+}
\StringTok{    theme_bw()+}
\StringTok{    theme(plot.title = element_text(hjust = 0.5))}
\StringTok{  }
\StringTok{  ggsave(paste0(path_here,"}\NormalTok{barplotenergíacomparativa_medida.tiff}\StringTok{"), device = "}\NormalTok{tiff}\StringTok{", dpi=1200,width =8, height =7, units = 'in')}
\StringTok{  }
\StringTok{  return(as.data.frame(colSums(tabla_energia_est)))}
\StringTok{  }
\StringTok{  }
\StringTok{\}}


\StringTok{#Obtención de la energía anual esperada}
\StringTok{energia_anual_med<-barplot_energias_medida()}
\end{Highlighting}
\end{Shaded}


\end{document}
